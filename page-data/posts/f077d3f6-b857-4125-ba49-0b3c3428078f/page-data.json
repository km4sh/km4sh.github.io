{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/f077d3f6-b857-4125-ba49-0b3c3428078f","result":{"data":{"markdownRemark":{"id":"c0d61b55-c7c2-52e9-a87c-525c95566cb5","html":"<p>說白了，這也是一篇關於開機啓動的筆記。</p>\n<p>BusyBox這東西更體現了一切皆文件的這個僞科學。只要把鏈接Wifi（或者其他你想讓他做的工作）的.sh寫好，放在正確的啓動.sh裏面就沒問題了。</p>\n<p>先說如何讓開發板鏈接Wi-Fi，然後我們再討論如何自行啓動鏈接。</p>\n<h1 id=\"wi-fi網路界面配置\" style=\"position:relative;\"><a href=\"#wi-fi%E7%B6%B2%E8%B7%AF%E7%95%8C%E9%9D%A2%E9%85%8D%E7%BD%AE\" aria-label=\"wi fi網路界面配置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wi-Fi網路界面配置</h1>\n<h2 id=\"配置wpa_supplicantconf\" style=\"position:relative;\"><a href=\"#%E9%85%8D%E7%BD%AEwpa_supplicantconf\" aria-label=\"配置wpa_supplicantconf permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>配置<code class=\"language-text\">wpa_supplicant.conf</code></h2>\n<p>這個文件通常在<code class=\"language-text\">/etc/wpa_supplicant</code>或者<code class=\"language-text\">/etc/wireless</code>下面，如果沒有的話可以找一找其他類似的文件夾，或者直接用<code class=\"language-text\">find</code>搜一下<code class=\"language-text\">name</code>。</p>\n<p>暫且可以不用關心這東西的原理，修改<code class=\"language-text\">ssid</code>和<code class=\"language-text\">psk</code>就好了。這裏面的<code class=\"language-text\">key_mgmt</code>個人測試發現不用擔心是WPA還是WPA2/WPA3，都用這個<code class=\"language-text\">WPA-PSK</code>就好啦。</p>\n<p>下面是我的開發板配置，請你參考你自己的默認配置來修改。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># /etc/wireless/wpa_supplicatn.conf</span>\n<span class=\"token assign-left variable\">country</span><span class=\"token operator\">=</span>GB\n<span class=\"token assign-left variable\">ctrl_interface</span><span class=\"token operator\">=</span>/var/wpa_supplicant\n<span class=\"token assign-left variable\">ctrl_interface_group</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n<span class=\"token assign-left variable\">ap_scan</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n<span class=\"token assign-left variable\">update_config</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\n<span class=\"token assign-left variable\">network</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n  <span class=\"token assign-left variable\">ssid</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;WIFI-SSID>\"</span>\n  <span class=\"token assign-left variable\">psk</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;WIFI-PASSWORD>\"</span>\n  <span class=\"token assign-left variable\">key_mgmt</span><span class=\"token operator\">=</span>WPA-PSK\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"啓動wi-fi\" style=\"position:relative;\"><a href=\"#%E5%95%93%E5%8B%95wi-fi\" aria-label=\"啓動wi fi permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>啓動Wi-Fi</h2>\n<p>第一步需要啓用Wi-Fi界面，這裏的名字叫做<code class=\"language-text\">wlan0</code>。如果不需要其他網路界面的話，可以在啓用Wi-Fi界面之後關閉其他的界面。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">ifconfig</span> wlan0 up\n<span class=\"token function\">ifconfig</span> eth0 down\n<span class=\"token function\">ifconfig</span> ppp0 down</code></pre></div>\n<p>配置好了<code class=\"language-text\">wpa_supplicant.conf</code>之後，就需要利用<code class=\"language-text\">wpa_supplicant</code>工具來參考這個conf文件進行WiFi鏈接。並且利用<code class=\"language-text\">dhcpcd</code>來獲取IP。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wpa_supplicant -i wlan0 -Dnl80211 -c /etc/wireless/wpa_supplicant.conf -B\ndhcpcd wlan0</code></pre></div>\n<h1 id=\"開機啓動\" style=\"position:relative;\"><a href=\"#%E9%96%8B%E6%A9%9F%E5%95%93%E5%8B%95\" aria-label=\"開機啓動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>開機啓動</h1>\n<p>把上面的指令保存在某一個文件夾，例如<code class=\"language-text\">/usr/script/start-wifi.sh</code>。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># /usr/script/start-wifi.sh</span>\n<span class=\"token function\">ifconfig</span> wlan0 up\n<span class=\"token function\">ifconfig</span> eth0 down\n<span class=\"token function\">ifconfig</span> ppp0 down\n\nwpa_supplicant -i wlan0 -Dnl80211 -c /etc/wireless/wpa_supplicant.conf -B\ndhcpcd wlan0</code></pre></div>\n<p>這樣執行這個文件，就可以啓動Wi-Fi界面、鏈接並獲取IP。 </p>\n<p>對於基於BusyBox的開發板，啓動的腳本是<code class=\"language-text\">/etc/init.d/rcS</code>，我們可以根據其中執行的順序根據需求放置在特定的任務後面。通常来说，對於啓動Wi-Fi這種任務，我們把啓動腳本放置在最後就好了。</p>\n<p>例如，在我用的這塊開發板上面，<code class=\"language-text\">/etc/init.d/rcS</code>最後指示它執行了<code class=\"language-text\">source /usr/script/boot-script.sh</code>這個指令。爲了使流程更加簡潔，我選擇把我的<code class=\"language-text\">start-wifi.sh</code>寫到這個<code class=\"language-text\">boot-script.sh</code>的最後來執行。另外，如果你的啓動流程當中需要進行手動確認的話，也請儘可能取消這些項目或者設置成延遲繼續，否則沒有辦法進行到你在最後添加的啓動任務。</p>","fields":{"slug":"/posts/f077d3f6-b857-4125-ba49-0b3c3428078f","tagSlugs":["/tag/automatic/"]},"frontmatter":{"date":"2021-06-28T11:00:00.121Z","description":"對於開發板上面的基於BusyBox的系統，如果能讓他在上電的時候自動鏈接Wi-Fi，就可以擺脫串口，更方便的進行調試了。本文記錄了如何讓開發板鏈接Wi-Fi以及如何配置上電自啓動。","tags":["Automatic"],"title":"基於BusyBox的開發板如何上電自動鏈接WiFi","socialImage":null}}},"pageContext":{"slug":"/posts/f077d3f6-b857-4125-ba49-0b3c3428078f"}},"staticQueryHashes":["251939775","401334301","825871152"]}