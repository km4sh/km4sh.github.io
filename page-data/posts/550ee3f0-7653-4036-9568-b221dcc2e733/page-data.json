{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/550ee3f0-7653-4036-9568-b221dcc2e733","result":{"data":{"markdownRemark":{"id":"a6705586-050e-5db6-9afa-adf400ff33c8","html":"<h1 id=\"寫在前面\" style=\"position:relative;\"><a href=\"#%E5%AF%AB%E5%9C%A8%E5%89%8D%E9%9D%A2\" aria-label=\"寫在前面 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>寫在前面</h1>\n<h2 id=\"看完這篇文章（出於學術目的，僅對下載youtube的技術比較好奇從來不想做別的違反youtube用戶協議事情的你）能收穫什麼\" style=\"position:relative;\"><a href=\"#%E7%9C%8B%E5%AE%8C%E9%80%99%E7%AF%87%E6%96%87%E7%AB%A0%EF%BC%88%E5%87%BA%E6%96%BC%E5%AD%B8%E8%A1%93%E7%9B%AE%E7%9A%84%EF%BC%8C%E5%83%85%E5%B0%8D%E4%B8%8B%E8%BC%89youtube%E7%9A%84%E6%8A%80%E8%A1%93%E6%AF%94%E8%BC%83%E5%A5%BD%E5%A5%87%E5%BE%9E%E4%BE%86%E4%B8%8D%E6%83%B3%E5%81%9A%E5%88%A5%E7%9A%84%E9%81%95%E5%8F%8Dyoutube%E7%94%A8%E6%88%B6%E5%8D%94%E8%AD%B0%E4%BA%8B%E6%83%85%E7%9A%84%E4%BD%A0%EF%BC%89%E8%83%BD%E6%94%B6%E7%A9%AB%E4%BB%80%E9%BA%BC\" aria-label=\"看完這篇文章（出於學術目的，僅對下載youtube的技術比較好奇從來不想做別的違反youtube用戶協議事情的你）能收穫什麼 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>看完這篇文章（出於學術目的，僅對下載YouTube的技術比較好奇從來不想做別的違反YouTube用戶協議事情的你）能收穫什麼</h2>\n<ul>\n<li>\n<p>包括但不限於解決以上問題的一些方法，比如：</p>\n<ul>\n<li>youtube-dl的使用方法</li>\n<li>利用FFmpeg進行轉碼的方法</li>\n<li>利用sox剪輯你喜歡的音頻的方法</li>\n<li>利用Numpy編輯音頻的方法</li>\n<li>建立Python和Shell的合作友誼的方法</li>\n</ul>\n</li>\n<li>\n<p>還有一個會不斷吐出以下內容的Python腳本</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">July <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span> @<span class=\"token number\">35396</span> INFO     <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span>mP0bdHdXLyo_1000<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span>\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span> @<span class=\"token number\">35396</span> INFO      <span class=\"token operator\">></span> download_video\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Downloaded<span class=\"token punctuation\">:</span> \tmP0bdHdXLyo_1000<span class=\"token punctuation\">.</span>m4a\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Duration<span class=\"token punctuation\">:</span> \tconverted audio<span class=\"token punctuation\">:</span> 11s\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO      <span class=\"token operator\">></span> convert_to_audio\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Converted<span class=\"token punctuation\">:</span> \tmP0bdHdXLyo_1000<span class=\"token punctuation\">.</span>m4a to mP0bdHdXLyo_1000_temp<span class=\"token punctuation\">.</span>wav\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> WARNING  Removed<span class=\"token punctuation\">:</span> \tmP0bdHdXLyo_1000<span class=\"token punctuation\">.</span>m4a\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Duration<span class=\"token punctuation\">:</span> \tconverted audio<span class=\"token punctuation\">:</span> 11s\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO      <span class=\"token operator\">></span> trim_audio\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Trimmed<span class=\"token punctuation\">:</span> \tmP0bdHdXLyo_1000_temp<span class=\"token punctuation\">.</span>wav to mP0bdHdXLyo_1000<span class=\"token punctuation\">.</span>wav\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> WARNING  Removed<span class=\"token punctuation\">:</span> \tmP0bdHdXLyo_1000_temp<span class=\"token punctuation\">.</span>wav\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> WARNING   <span class=\"token operator\">></span> padding\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> WARNING  Diff<span class=\"token punctuation\">:</span> <span class=\"token number\">6892</span>\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> WARNING  Removed<span class=\"token punctuation\">:</span> \t<span class=\"token operator\">/</span>AudioSet<span class=\"token operator\">/</span>strong_label_train<span class=\"token operator\">/</span>mP0bdHdXLyo_1000<span class=\"token punctuation\">.</span>wav\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO      <span class=\"token operator\">></span> checking\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Checking<span class=\"token punctuation\">:</span> \t<span class=\"token operator\">/</span>AudioSet<span class=\"token operator\">/</span>strong_label_train_padded<span class=\"token operator\">/</span>mP0bdHdXLyo_1000<span class=\"token punctuation\">.</span>wav\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Checking<span class=\"token punctuation\">:</span> \tchannels<span class=\"token punctuation\">:</span>\t<span class=\"token number\">1</span>\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Checking<span class=\"token punctuation\">:</span> \tsamplerate<span class=\"token punctuation\">:</span>\t<span class=\"token number\">44100</span>\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Checking<span class=\"token punctuation\">:</span> \tprecision<span class=\"token punctuation\">:</span>\t<span class=\"token number\">16</span><span class=\"token operator\">-</span>bit\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Checking<span class=\"token punctuation\">:</span> \tduration<span class=\"token punctuation\">:</span>\t<span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">10.00</span>\nJuly <span class=\"token number\">06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">21</span><span class=\"token punctuation\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> @<span class=\"token number\">35396</span> INFO     Finished<span class=\"token punctuation\">:</span> \tmP0bdHdXLyo_1000</code></pre></div>\n</li>\n</ul>\n<h2 id=\"先來說說如何下載audioset\" style=\"position:relative;\"><a href=\"#%E5%85%88%E4%BE%86%E8%AA%AA%E8%AA%AA%E5%A6%82%E4%BD%95%E4%B8%8B%E8%BC%89audioset\" aria-label=\"先來說說如何下載audioset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>先來說說如何下載AudioSet</h2>\n<p>包括Google釋放的AudioSet數據集的tsv文檔在內的Github Repo可以訪問：</p>\n<p><a href=\"https://github.com/km4sh/fetch-audioset\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GitHub - km4sh/fetch-audioset</a></p>\n<p>這裏包括了所需的所有代碼。</p>\n<p>下載AudioSet主要用的是下載神器<code class=\"language-text\">youtube-dl</code>來實現的。最核心的代碼在我Github的Repo當中，可以<a href=\"https://github.com/km4sh/fetch-audioset/blob/development/scripts/download_audioset.py\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">點擊這裏</a>直達。由於接口原因，貌似沒有可以直接下載音頻的方式，所以需要先下載視頻，再提取音頻。所以主要流程如下：</p>\n<ul>\n<li><code class=\"language-text\">split_samplename()</code> 將輸入參數處理爲視頻ID <code class=\"language-text\">ytid</code> 和開始時間 <code class=\"language-text\">start</code> ；</li>\n<li><code class=\"language-text\">download_video()</code> 利用ytid將整段視頻下載下來；</li>\n<li><code class=\"language-text\">convert_to_audio()</code> 利用FFmpeg將視頻中的音頻提取出來，順便完成通道壓縮（僅單通道）、採樣率調整（統一44100Hz）以及格式轉換（WAV）等任務。</li>\n<li>\n<p><code class=\"language-text\">trim_audio()</code> 利用sox工具進行音頻剪切。</p>\n<ul>\n<li>這裏需要說明的是，雖然FFmpeg也可以一同完成剪切任務，單我在之前的下載當中，發現一些利用FFmpeg剪切後的文件長度並不是嚴格的<code class=\"language-text\">SampleRate * Duration</code>個樣點。後來發現部分AudioSet的樣本可能不足十秒，原因是原視頻就不足十秒。不過我也不確定FFmpeg剪切是完全魯棒的，所以我用了更保險的sox工具來進行剪切。</li>\n</ul>\n</li>\n<li><code class=\"language-text\">padding_zeros()</code> 如上一步的說明，如果有一些樣本不足十秒，則補零到十秒。這一步可以根據自己的需求選用。</li>\n<li><code class=\"language-text\">checking()</code> 檢查當前文件是否符合要求，主要檢查通道數、採樣率、採樣深度、採樣時間、總樣點數。也是利用sox來獲取的文檔信息，確保準確可讀。</li>\n</ul>\n<p>對於下載當中由於網絡等原因出現下載失敗的情況，我們可以用<a href=\"https://github.com/km4sh/fetch-audioset/blob/development/scripts/clean.py\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">clean.py</code></a>來清理一下臨時文件，以及不符合我們設定格式的文件。</p>\n<h2 id=\"下載audioset的幾個問題\" style=\"position:relative;\"><a href=\"#%E4%B8%8B%E8%BC%89audioset%E7%9A%84%E5%B9%BE%E5%80%8B%E5%95%8F%E9%A1%8C\" aria-label=\"下載audioset的幾個問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>下載AudioSet的幾個問題</h2>\n<ul>\n<li>\n<p>來自YouTube的問題</p>\n<ul>\n<li>訪問次數限制</li>\n<li>視頻下架</li>\n<li>視頻地區限制</li>\n<li>視頻年齡限制</li>\n</ul>\n</li>\n<li>\n<p>來自AudioSet的問題</p>\n<ul>\n<li>數據量較大</li>\n<li>10s時長問題</li>\n<li>音頻格式、通道數、採樣率以及採樣位數</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"解決方案\" style=\"position:relative;\"><a href=\"#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88\" aria-label=\"解決方案 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>解決方案</h1>\n<h2 id=\"來自youtube的問題\" style=\"position:relative;\"><a href=\"#%E4%BE%86%E8%87%AAyoutube%E7%9A%84%E5%95%8F%E9%A1%8C\" aria-label=\"來自youtube的問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>來自YouTube的問題</h2>\n<p>來自YouTube的問題基本上都是源於YouTube用戶使用協議產生的。這裏僅對此進行技術討論，且目的僅限於進行學術活動。作者並不鼓勵任何違反協議的行爲。</p>\n<h3 id=\"訪問次數限制\" style=\"position:relative;\"><a href=\"#%E8%A8%AA%E5%95%8F%E6%AC%A1%E6%95%B8%E9%99%90%E5%88%B6\" aria-label=\"訪問次數限制 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>訪問次數限制</h3>\n<p>對於訪問次數的限制，可以通過直連節點代理的方式來規避。具體方法可以利用youtube-dl內的proxy相關參數來實現；也可以通過終端內對當前shell的環境變量進行設置來實現，這意味着整個運行過程都通過這個代理來下載。</p>\n<p>如果利用代理之後依然會出現訪問次數限制，請嘗試：</p>\n<ul>\n<li>使用不那麼擁擠的代理</li>\n<li>每隔一段時間就更換一下代理</li>\n<li>下載慢一點</li>\n</ul>\n<p>由於我不需要頻繁切換代理，即可以保證穩定下載，所以我利用如下命令設置了環境變量：</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">https_proxy</span><span class=\"token operator\">=</span>http://127.0.0.1:8234<span class=\"token punctuation\">;</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">http_proxy</span><span class=\"token operator\">=</span>http://127.0.0.1:8234<span class=\"token punctuation\">;</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">all_proxy</span><span class=\"token operator\">=</span>socks5://127.0.0.1:8235<span class=\"token punctuation\">;</span></code></pre></div>\n<p>這裏的具體IP和端口請根據自己的網絡情況和代理軟件進行設置，在此不做過多討論。</p>\n<p>如果需要頻繁切換代理的話，利用youtube-dl的option來設置proxy或許更好，因爲甚至可以設置爲每個下載的代理都不同。不過前提是你要有滿足你需求的代理地址。</p>\n<h2 id=\"視頻下架\" style=\"position:relative;\"><a href=\"#%E8%A6%96%E9%A0%BB%E4%B8%8B%E6%9E%B6\" aria-label=\"視頻下架 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>視頻下架</h2>\n<p>請聯繫作者，或者學術社區內其他在視頻還健在的時候下載過的人。</p>\n<h2 id=\"地區限制\" style=\"position:relative;\"><a href=\"#%E5%9C%B0%E5%8D%80%E9%99%90%E5%88%B6\" aria-label=\"地區限制 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>地區限制</h2>\n<p>利用訪問次數限制這裏提到的方法，選取一個出口地點爲可用的地區/國家的代理。我的做法是，選取一個較穩定的代理進行下載之後，再用幾個不同的位置的代理對之前未能下載的列表進行嘗試。</p>\n<p>具體去哪裡弄這些代理，請聯繫身邊有經驗的人。</p>\n<h2 id=\"年齡限制\" style=\"position:relative;\"><a href=\"#%E5%B9%B4%E9%BD%A1%E9%99%90%E5%88%B6\" aria-label=\"年齡限制 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>年齡限制</h2>\n<p>解決年齡限制的問題，需要登錄Google帳號來讓YouTube確認你的年齡。youtube-dl提供兩種登錄方式：帳號密碼和Cookie。我比較習慣提供Cookie給軟件使用。當然，如果覺得OK的話提供帳號密碼也可以，請參考youtube-dl的文檔。</p>\n<p>Cookie文件的獲取可以利用瀏覽器的插件很方便的進行。我利用的是EditThisCookie這個插件，可以在Chrome Web Store獲取。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/243dde66e47c91582a2eb7c5482b4238/218a4/5583f90dc8244dc99aff56094538ff91df055ef1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQY042PXU6DQBSFWZFLdAe+uBZffDFugAcE2thYGgVKRf7lp8wwfA4kJZqQ2JN8OZMzNyf3Giwa+U/jOP7xNRn753tK3yLJSkzTxHFcbNthu91w8DxeLAvXdRiVWsourJUbj7c3vD7c0QjYbFyiKCIII3aej/cestt/8HYIaDo53/C7cA3jZD/RphFiUKRpSlHkVLr9WEBcwWcJWQNFrbhGxuVRVZXe7qS3C+fipq74LnPqTuAngkBzTCVhJmnaljj+0nOZ9pg8z0mSlLbrMJQapjuQUtLpYAr7XiCE1GiXivas6RVnMTEyDIOe6ef/xTVT/gPCT82L4AGXGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/243dde66e47c91582a2eb7c5482b4238/8ac56/5583f90dc8244dc99aff56094538ff91df055ef1.webp 240w,\n/static/243dde66e47c91582a2eb7c5482b4238/d3be9/5583f90dc8244dc99aff56094538ff91df055ef1.webp 480w,\n/static/243dde66e47c91582a2eb7c5482b4238/e46b2/5583f90dc8244dc99aff56094538ff91df055ef1.webp 960w,\n/static/243dde66e47c91582a2eb7c5482b4238/c18de/5583f90dc8244dc99aff56094538ff91df055ef1.webp 1052w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/243dde66e47c91582a2eb7c5482b4238/8ff5a/5583f90dc8244dc99aff56094538ff91df055ef1.png 240w,\n/static/243dde66e47c91582a2eb7c5482b4238/e85cb/5583f90dc8244dc99aff56094538ff91df055ef1.png 480w,\n/static/243dde66e47c91582a2eb7c5482b4238/d9199/5583f90dc8244dc99aff56094538ff91df055ef1.png 960w,\n/static/243dde66e47c91582a2eb7c5482b4238/218a4/5583f90dc8244dc99aff56094538ff91df055ef1.png 1052w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/243dde66e47c91582a2eb7c5482b4238/d9199/5583f90dc8244dc99aff56094538ff91df055ef1.png\"\n            alt=\"5583f90dc8244dc99aff56094538ff91df055ef1.png\"\n            title=\"5583f90dc8244dc99aff56094538ff91df055ef1.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>不過需要注意的是，youtube-dl需要滿足Netscape格式的Cookie文件。在插件選項當中設置一下即可（我這裏默認的是JSON）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/62ed8b7e48e75b7720b72374889e2cbc/7960f/649e60721f3e49b54cbe8d784fb936554471b3dc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7klEQVQoz5VRSQqEQBDr/7/HV+hV0Jvgvu8LrhlSUDA3ZwqC6bY6nUqb4zjQti2KokDTNCjLElVVCbjfdR3u+wbreZ5XmH3f5XCapiKaZRniOJY1vxT8p8y2bRjHEcuyYJ5n4dM0YV1X8N95nriuSzin0TW5gqY4BfcNReiQQjqyig7DIA7J2aOcUXAC9uZ5LlNxn5caKvMgxQg2K6dA3/eIogie5yFJEomBa8ajF6oRyfCXXIIggGVZcBwHtm0LXNeF7/sIwxB1XYtTjm7eXo1FB3RIdzysoCs6ZGx0Kxm+uVNRlgb/DT4SH4ac9QFv4me+RQ6coQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/62ed8b7e48e75b7720b72374889e2cbc/8ac56/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 240w,\n/static/62ed8b7e48e75b7720b72374889e2cbc/d3be9/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 480w,\n/static/62ed8b7e48e75b7720b72374889e2cbc/e46b2/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 960w,\n/static/62ed8b7e48e75b7720b72374889e2cbc/15a27/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 1274w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/62ed8b7e48e75b7720b72374889e2cbc/8ff5a/649e60721f3e49b54cbe8d784fb936554471b3dc.png 240w,\n/static/62ed8b7e48e75b7720b72374889e2cbc/e85cb/649e60721f3e49b54cbe8d784fb936554471b3dc.png 480w,\n/static/62ed8b7e48e75b7720b72374889e2cbc/d9199/649e60721f3e49b54cbe8d784fb936554471b3dc.png 960w,\n/static/62ed8b7e48e75b7720b72374889e2cbc/7960f/649e60721f3e49b54cbe8d784fb936554471b3dc.png 1274w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/62ed8b7e48e75b7720b72374889e2cbc/d9199/649e60721f3e49b54cbe8d784fb936554471b3dc.png\"\n            alt=\"649e60721f3e49b54cbe8d784fb936554471b3dc.png\"\n            title=\"649e60721f3e49b54cbe8d784fb936554471b3dc.png\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"來自audioset的問題\" style=\"position:relative;\"><a href=\"#%E4%BE%86%E8%87%AAaudioset%E7%9A%84%E5%95%8F%E9%A1%8C\" aria-label=\"來自audioset的問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>來自AudioSet的問題</h1>\n<h2 id=\"數據量較大\" style=\"position:relative;\"><a href=\"#%E6%95%B8%E6%93%9A%E9%87%8F%E8%BC%83%E5%A4%A7\" aria-label=\"數據量較大 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>數據量較大</h2>\n<p>確實，因爲我們需要逐個視頻進行下載，再按照對應時間轉換爲音頻。對於AudioSet的百萬級別數據來說，這樣的方式需要蠻久的時間。我們可以利用多進程腳本來加速數據下載。不過這和YouTube的訪問次數保護是衝突的，如果你的出口帶寬不受YouTube的限制，那可以盡情使用多進程腳本。或者，也可以在不同的進程當中設置不同的代理進行下載，這樣即使利用了多進程加速，也和之前的單進程下載沒有什麼區別。</p>\n<p>多進程的第一步就是拆分任務，讀tsv文件進入Python之後，對列表進行拆分。我下載的是Strong Label的子集，所以tsv文件當中對同一樣本也進行了多個不同標註，所以還需要去重一下。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> multiprocessing <span class=\"token keyword\">import</span> Pool\n\n<span class=\"token comment\"># 讀取tsv到列表</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>tsv_file<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n    meta <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>readlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span>\nmeta <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>line<span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> meta<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># 去重</span>\nmeta <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span>meta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 設置進程數</span>\nnum_proc <span class=\"token operator\">=</span> <span class=\"token number\">8</span>\n\n<span class=\"token comment\"># 切分列表</span>\nsplit_input <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">(</span>\n        meta<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>meta<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> num_proc <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>meta<span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> num_proc<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        save_dir<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>num_proc<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># 啓動進程池</span>\n<span class=\"token keyword\">with</span> Pool<span class=\"token punctuation\">(</span>num_proc<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> p<span class=\"token punctuation\">:</span>\n    p<span class=\"token punctuation\">.</span>starmap<span class=\"token punctuation\">(</span>\n        download_tsv<span class=\"token punctuation\">,</span>\n        star_input<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"10秒時長的問題\" style=\"position:relative;\"><a href=\"#10%E7%A7%92%E6%99%82%E9%95%B7%E7%9A%84%E5%95%8F%E9%A1%8C\" aria-label=\"10秒時長的問題 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10秒時長的問題</h2>\n<p>我一直誤認爲AudioSet裏都是10秒的音頻片段。但後來發現，有兩種情況會讓音頻不足10秒：</p>\n<ul>\n<li>視頻都不到10秒</li>\n<li>標註的時間節點在視頻結束前~10秒，但是差一點</li>\n</ul>\n<p>所以我意識到一件事情，有的音頻片段就是不足十秒，甚至只有兩三秒的長度。不過這種文件的數量不算很多，大概所有Strong Label樣本的10%左右。我在這裏進行了補零處理。最後所有的樣本都是10秒的時間長度。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">waveform<span class=\"token punctuation\">,</span> samplerate <span class=\"token operator\">=</span> soundfile<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span>\ndiff <span class=\"token operator\">=</span> samplerate <span class=\"token operator\">*</span> duration <span class=\"token operator\">-</span> waveform<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\nwaveform <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>concatenate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>waveform<span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>diff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> axis<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token string\">\"wb\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n    soundfile<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> waveform<span class=\"token punctuation\">,</span> samplerate<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"音頻格式、通道數、採樣率以及採樣位數\" style=\"position:relative;\"><a href=\"#%E9%9F%B3%E9%A0%BB%E6%A0%BC%E5%BC%8F%E3%80%81%E9%80%9A%E9%81%93%E6%95%B8%E3%80%81%E6%8E%A1%E6%A8%A3%E7%8E%87%E4%BB%A5%E5%8F%8A%E6%8E%A1%E6%A8%A3%E4%BD%8D%E6%95%B8\" aria-label=\"音頻格式、通道數、採樣率以及採樣位數 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>音頻格式、通道數、採樣率以及採樣位數</h2>\n<p>因爲我採用的方法是將視頻轉換爲音頻，所以目標格式就是常用的wav，避免進一步的編碼損失。但是源數據可能是雙通道，導致轉換後的數據集混雜了兩種通道數的數據。對於聲事件檢測任務，我認爲雙通道意義並不很明確。所以在轉換時都使其變爲單通道。對於採樣率，我這裏統一設置了比較高的44.1kHz，基本可以覆蓋全部的YouTube視頻中的音頻頻段。</p>\n<p>我們可以利用FFmpeg進行轉換。在Python當中，執行Shell中的命令可以利用os.system()或者os.popen()。下面代碼示例的寫法，方便進行不同參數的調試、增刪與順序調整。不過需要注意參數之前的空格。</p>\n<p>F-strings的寫法可以方便的傳入參數的值，我比較推薦。這個方法是由PEP 498引入的，需要Python≥3.6。</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">ffmpeg_command <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"ffmpeg -i </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>filename<span class=\"token punctuation\">}</span></span><span class=\"token string\"> -hide_banner\"</span></span>\nffmpeg_command <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\" -acodec </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>codec<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\nffmpeg_command <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\" -ac </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>num_channels<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\nffmpeg_command <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\" -ar </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>sampelrate<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\nffmpeg_command <span class=\"token operator\">+=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\" </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>output_file<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n<span class=\"token keyword\">if</span> silent<span class=\"token punctuation\">:</span>\n    ffmpeg_command <span class=\"token operator\">+=</span> <span class=\"token string\">\" 2> /dev/null\"</span>\nos<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">(</span>ffmpeg_command<span class=\"token punctuation\">)</span></code></pre></div>","fields":{"slug":"/posts/550ee3f0-7653-4036-9568-b221dcc2e733","tagSlugs":["/tag/dataset/","/tag/parse/"]},"frontmatter":{"date":"2021-08-12T13:45:00.121Z","description":"如何利用Python下載龐大的AudioSet數據集，並且進行數據驗證於後處理。","tags":["Dataset","Parse"],"title":"如何下載AudioSet數據集的音頻文件","socialImage":null}}},"pageContext":{"slug":"/posts/550ee3f0-7653-4036-9568-b221dcc2e733"}},"staticQueryHashes":["251939775","401334301","825871152"]}