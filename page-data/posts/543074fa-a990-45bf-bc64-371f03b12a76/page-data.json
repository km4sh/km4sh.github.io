{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/543074fa-a990-45bf-bc64-371f03b12a76","result":{"data":{"markdownRemark":{"id":"0f398655-c470-5125-ace1-303b7b76852f","html":"<h1 id=\"背景介紹\" style=\"position:relative;\"><a href=\"#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%B4%B9\" aria-label=\"背景介紹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>背景介紹</h1>\n<p>我有FRP和Clash這兩個程序需要一直在後台運行，並且都與網絡相關：</p>\n<ol>\n<li>要在網絡啟動之後再運行</li>\n<li>網絡重啟的話也跟著重啟</li>\n<li>失敗了之後也重啟</li>\n</ol>\n<h1 id=\"部署細節\" style=\"position:relative;\"><a href=\"#%E9%83%A8%E7%BD%B2%E7%B4%B0%E7%AF%80\" aria-label=\"部署細節 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>部署細節</h1>\n<h2 id=\"文件放在哪裏\" style=\"position:relative;\"><a href=\"#%E6%96%87%E4%BB%B6%E6%94%BE%E5%9C%A8%E5%93%AA%E8%A3%8F\" aria-label=\"文件放在哪裏 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>文件放在哪裏</h2>\n<h3 id=\"主要的linux系統\" style=\"position:relative;\"><a href=\"#%E4%B8%BB%E8%A6%81%E7%9A%84linux%E7%B3%BB%E7%B5%B1\" aria-label=\"主要的linux系統 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>主要的Linux系統</h3>\n<p>文件的位置在目錄<code class=\"language-text\">/lib/systemd/system</code> 下，创建一个叫做<code class=\"language-text\">frpc.service</code>另一個叫做<code class=\"language-text\">clash.ini</code>的文件就好了。</p>\n<p>OpenWRT之類的系統通常都利用WebUI來進行交互。在WebUI當中，我們可以利用<strong>LuCI → System → Startup</strong>這個頁面來進行啓動服務的設置。當然，對這類可能是用來做特定事情的操作系統，像Frp之類的工具或許都有一些高級的封裝，所以也可以直接安裝相應的包，Enable之後他們也會達成相應的需求。</p>\n<h3 id=\"macos系統\" style=\"position:relative;\"><a href=\"#macos%E7%B3%BB%E7%B5%B1\" aria-label=\"macos系統 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MacOS系統</h3>\n<p>MacOS下面常用有兩種方式：<strong>LaunchAgents</strong>和<strong>Login Items</strong>。其中<strong>LaunchAgents</strong>和Linux下面的Service比較類似，而<strong>Login Items</strong>則是相對更加圖形化的做法。</p>\n<p>對於<strong>LaunchAgents</strong>，有系統層面和当前用戶和全用户不同的放置路徑，分別是</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">/Library/LaunchAgents  <span class=\"token comment\"># for all users</span>\n~/Library/LaunchAgents  <span class=\"token comment\"># for specific user</span>\n/System/Library/LaunchAgents  <span class=\"token comment\"># for system</span></code></pre></div>\n<p>在這裏，我們就可以根據不同的運行要求來將一個<code class=\"language-text\">plist</code>文件放在不同的位置。</p>\n<p>對於<strong>Login Items</strong>，可以在<strong>System Preference</strong>面板當中的<strong>Users &#x26; Groups</strong>頁找到。我們可以在這裏添加完成對應任務的script文件。</p>\n<p>這裏，爲了能夠讓進程在後臺守護運行，我選擇利用<code class=\"language-text\">LaunchAgents</code>的方法來實現。</p>\n<h2 id=\"文件詳解\" style=\"position:relative;\"><a href=\"#%E6%96%87%E4%BB%B6%E8%A9%B3%E8%A7%A3\" aria-label=\"文件詳解 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>文件詳解</h2>\n<h3 id=\"macos下面的plist文件\" style=\"position:relative;\"><a href=\"#macos%E4%B8%8B%E9%9D%A2%E7%9A%84plist%E6%96%87%E4%BB%B6\" aria-label=\"macos下面的plist文件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>macOS下面的<code class=\"language-text\">.plist</code>文件</h3>\n<p>這個文件描述了我設置的可以運行frpc的agent的細節。其中<code class=\"language-text\">ProgramArguments</code>鍵中記載運行frpc的指令，如果有很多參數的話，可以按照<strong>string array</strong>的方式來記錄。在<code class=\"language-text\">KeepAlive</code>鍵當中，我們可以將其設置爲<code class=\"language-text\">&lt;true/&gt;</code>來保證其持續運行。其他內容可以參考<code class=\"language-text\">&lt;key&gt; &lt;/key&gt;</code>當中所描述的功能來判斷。更多功能請<a href=\"https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">參考文檔</a>。</p>\n<p>⚠️  <strong>注意：請將</strong><strong><code class=\"language-text\">&lt;ABSOLUTE_PATH&gt;</code></strong> <strong>替换对应的绝对路径。</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">plist</span> <span class=\"token name\">PUBLIC</span> <span class=\"token name\">-//Apple</span> <span class=\"token name\">Computer//DTD</span> <span class=\"token name\">PLIST</span> <span class=\"token name\">1.0//EN</span>\n  <span class=\"token name\">http://www.apple.com/DTDs/PropertyList-1.0.dtd</span> <span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plist</span> <span class=\"token attr-name\">version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dict</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>key</span><span class=\"token punctuation\">></span></span>Label<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>key</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>frpc<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>key</span><span class=\"token punctuation\">></span></span>ProgramArguments<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>key</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>array</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ABSOLUTE_PATH</span><span class=\"token punctuation\">></span></span>/frpc<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>-c<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ABSOLUTE_PATH</span><span class=\"token punctuation\">></span></span>/frpc.ini<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>array</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>key</span><span class=\"token punctuation\">></span></span>KeepAlive<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>key</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>true</span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>key</span><span class=\"token punctuation\">></span></span>RunAtLoad<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>key</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>true</span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dict</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plist</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3 id=\"linux下面的service文件\" style=\"position:relative;\"><a href=\"#linux%E4%B8%8B%E9%9D%A2%E7%9A%84service%E6%96%87%E4%BB%B6\" aria-label=\"linux下面的service文件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Linux下面的<code class=\"language-text\">.service</code>文件</h3>\n<p>Linux下面的Service描述文件則更加直觀，也方便進行更精細的控制。</p>\n<p>例如在<strong>Unit</strong>下的<code class=\"language-text\">After</code>和<code class=\"language-text\">Wants</code>鍵則對應任務執行的順序和對前序任務的要求。在<strong>Service</strong>當中的<code class=\"language-text\">ExecStart</code>就是我們要執行的指令，<code class=\"language-text\">Restart</code>和<code class=\"language-text\">RestartSec</code>則指定了如果進程發生意外結束之後是否重啓以及經過多久之後重啓。</p>\n<p>這裏提供了我所需要的兩項服務的Service描述。由於都是網絡相關的應用，所以前序任務都是<strong>網絡服務啓動</strong>並且<strong>網絡在線</strong>。</p>\n<p>⚠️  <strong>注意：請將</strong><strong><code class=\"language-text\">&lt;ABSOLUTE_PATH&gt;</code></strong> <strong>替换对应的绝对路径。</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>frpc <span class=\"token function\">service</span>\n<span class=\"token assign-left variable\">After</span><span class=\"token operator\">=</span>network.target network-online.target\n<span class=\"token assign-left variable\">Wants</span><span class=\"token operator\">=</span>network-online.target\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>simple\n<span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>ABSOLUTE_PATH<span class=\"token operator\">></span>/frp/frpc -c <span class=\"token operator\">&lt;</span>ABSOLUTE_PATH<span class=\"token operator\">></span>/frp/frpc.ini\n<span class=\"token assign-left variable\">Restart</span><span class=\"token operator\">=</span>always\n<span class=\"token assign-left variable\">RestartSec</span><span class=\"token operator\">=</span><span class=\"token number\">42</span>\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>clash proxy <span class=\"token function\">service</span>\n<span class=\"token assign-left variable\">After</span><span class=\"token operator\">=</span>network.target network-online.target\n<span class=\"token assign-left variable\">Wants</span><span class=\"token operator\">=</span>network-online.target\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>simple\n<span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>ABSOLUTE_PATH<span class=\"token operator\">></span>/clash -f <span class=\"token operator\">&lt;</span>ABSOLUTE_PATH<span class=\"token operator\">></span>/config.yaml\n<span class=\"token assign-left variable\">Restart</span><span class=\"token operator\">=</span>always\n<span class=\"token assign-left variable\">RestartSec</span><span class=\"token operator\">=</span><span class=\"token number\">42</span>\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</code></pre></div>\n<h2 id=\"如何運行\" style=\"position:relative;\"><a href=\"#%E5%A6%82%E4%BD%95%E9%81%8B%E8%A1%8C\" aria-label=\"如何運行 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>如何運行</h2>\n<h3 id=\"對於linux操作系統\" style=\"position:relative;\"><a href=\"#%E5%B0%8D%E6%96%BClinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%B5%B1\" aria-label=\"對於linux操作系統 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>對於Linux操作系統</h3>\n<p>在Linux操作系統下，可以利用<code class=\"language-text\">systemctl</code>來對服務進行控制。<code class=\"language-text\">systemctl enable</code>可以啓用服務，但默認是要在下一次滿足前序任務之後才會運行。如果想要立即運行，可以利用<code class=\"language-text\">systemctl start</code>來直接運行服務。<code class=\"language-text\">systemctl status</code>則可以看到服務的運行狀態以及服務進程的std輸出。</p>\n<p><strong>在本例當中</strong><strong><code class=\"language-text\">$SERVICE_NAME</code></strong> <strong>是</strong><strong><code class=\"language-text\">clash</code></strong> <strong>或者</strong><strong><code class=\"language-text\">frpc</code></strong> <strong>。</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 啟動指令</span>\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> <span class=\"token variable\">$SERVICE_NAME</span>\n<span class=\"token function\">sudo</span> systemctl start <span class=\"token variable\">$SERVICE_NAME</span>\n<span class=\"token function\">sudo</span> systemctl restart <span class=\"token variable\">$SERVICE_NAME</span>\n\n<span class=\"token comment\"># 終止指令</span>\n<span class=\"token function\">sudo</span> systemctl disable <span class=\"token variable\">$SERVICE_NAME</span>\n<span class=\"token function\">sudo</span> systemctl stop <span class=\"token variable\">$SERVICE_NAME</span>\n\n<span class=\"token comment\"># 查看狀態指令</span>\nsystemctl status <span class=\"token variable\">$SERVICE_NAME</span></code></pre></div>\n<h3 id=\"對於macos操作系統\" style=\"position:relative;\"><a href=\"#%E5%B0%8D%E6%96%BCmacos%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%B5%B1\" aria-label=\"對於macos操作系統 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>對於macOS操作系統</h3>\n<p>在macOS操作系統下，利用<code class=\"language-text\">launchctl</code>來管理<strong>LaunchAgents</strong>。如果在<code class=\"language-text\">.plist</code>當中配置了<code class=\"language-text\">RunAtLoad</code>的話，則可以在<code class=\"language-text\">launchctl load</code>之後直接運行。如果要查看狀態，需要在<code class=\"language-text\">launchctl list</code>當中利用<code class=\"language-text\">grep</code>查找對應服務的所在行，如果第一項<code class=\"language-text\">pid</code>是數字而非橫線符的話，則表明進程已經啓動。</p>\n<p><strong>在本例當中</strong><strong><code class=\"language-text\">$SERVICE_NAME</code></strong> <strong>是</strong><strong><code class=\"language-text\">clash.plist</code></strong> <strong>。</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 啟動指令</span>\nlaunchctl load <span class=\"token variable\">$SERVICE_NAME</span>\n\n<span class=\"token comment\"># 終止指令</span>\nlaunchctl unload <span class=\"token variable\">$SERVICE_NAME</span>\n\n<span class=\"token comment\"># 查看狀態指令</span>\nlaunchctl list <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token variable\">$SERVICE_NAME</span></code></pre></div>","fields":{"slug":"/posts/543074fa-a990-45bf-bc64-371f03b12a76","tagSlugs":["/tag/automatic/"]},"frontmatter":{"date":"2021-06-18T11:43:00.121Z","description":"有些時候，我需要讓一些網絡工具在機器啓動的時候自動運行。例如，讓端口轉發自動運行的話，也就可以在機器斷電重啓之後自動上線，這樣可以實現實驗室的無人值守。那麼如何在Linux以及macOS下面實現自動運行一些腳本呢？這篇文章介紹了利用類似服務的方法的一些實現。","tags":["Automatic"],"title":"如何在Linux和macOS下配置啓動項","socialImage":null}}},"pageContext":{"slug":"/posts/543074fa-a990-45bf-bc64-371f03b12a76"}},"staticQueryHashes":["251939775","401334301","825871152"]}