<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Blog by er1yaaruma]]></title><description><![CDATA[Pellentesque odio nisi, euismod in, pharetra a, ultricies in, diam. Sed arcu.]]></description><link>https://lumen.netlify.com</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 05 Aug 2021 00:15:32 GMT</lastBuildDate><item><title><![CDATA[如何下載AudioSet數據集的音頻文件]]></title><description><![CDATA[如何利用Python下載龐大的AudioSet數據集，並且進行數據驗證於後處理。]]></description><link>https://lumen.netlify.com/posts/550ee3f0-7653-4036-9568-b221dcc2e733</link><guid isPermaLink="false">https://lumen.netlify.com/posts/550ee3f0-7653-4036-9568-b221dcc2e733</guid><pubDate>Tue, 06 Jul 2021 14:49:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;寫在前面&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AF%AB%E5%9C%A8%E5%89%8D%E9%9D%A2&quot; aria-label=&quot;寫在前面 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;寫在前面&lt;/h1&gt;
&lt;h2 id=&quot;下載audioset的幾個問題&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%8B%E8%BC%89audioset%E7%9A%84%E5%B9%BE%E5%80%8B%E5%95%8F%E9%A1%8C&quot; aria-label=&quot;下載audioset的幾個問題 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;下載AudioSet的幾個問題&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;來自YouTube的問題&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;訪問次數限制&lt;/li&gt;
&lt;li&gt;視頻下架&lt;/li&gt;
&lt;li&gt;視頻地區限制&lt;/li&gt;
&lt;li&gt;視頻年齡限制&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;來自AudioSet的問題&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;數據量較大&lt;/li&gt;
&lt;li&gt;10s時長問題&lt;/li&gt;
&lt;li&gt;音頻格式、通道數、採樣率以及採樣位數&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;看完這篇文章（出於學術目的，僅對下載youtube的技術比較好奇從來不想做別的違反youtube用戶協議事情的你）能收穫什麼&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%9C%8B%E5%AE%8C%E9%80%99%E7%AF%87%E6%96%87%E7%AB%A0%EF%BC%88%E5%87%BA%E6%96%BC%E5%AD%B8%E8%A1%93%E7%9B%AE%E7%9A%84%EF%BC%8C%E5%83%85%E5%B0%8D%E4%B8%8B%E8%BC%89youtube%E7%9A%84%E6%8A%80%E8%A1%93%E6%AF%94%E8%BC%83%E5%A5%BD%E5%A5%87%E5%BE%9E%E4%BE%86%E4%B8%8D%E6%83%B3%E5%81%9A%E5%88%A5%E7%9A%84%E9%81%95%E5%8F%8Dyoutube%E7%94%A8%E6%88%B6%E5%8D%94%E8%AD%B0%E4%BA%8B%E6%83%85%E7%9A%84%E4%BD%A0%EF%BC%89%E8%83%BD%E6%94%B6%E7%A9%AB%E4%BB%80%E9%BA%BC&quot; aria-label=&quot;看完這篇文章（出於學術目的，僅對下載youtube的技術比較好奇從來不想做別的違反youtube用戶協議事情的你）能收穫什麼 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;看完這篇文章（出於學術目的，僅對下載YouTube的技術比較好奇從來不想做別的違反YouTube用戶協議事情的你）能收穫什麼&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;包括但不限於解決以上問題的一些方法，比如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;youtube-dl的使用方法&lt;/li&gt;
&lt;li&gt;利用FFmpeg進行轉碼的方法&lt;/li&gt;
&lt;li&gt;利用sox剪輯你喜歡的音頻的方法&lt;/li&gt;
&lt;li&gt;如何利用Numpy編輯音頻的方法&lt;/li&gt;
&lt;li&gt;建立Python和Shell的合作友誼的方法&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;還有一個會不斷吐出以下內容的Python腳本&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;mP0bdHdXLyo_1000&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO      &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; download_video
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Downloaded&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	mP0bdHdXLyo_1000&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m4a
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Duration&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	converted audio&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 11s
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO      &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; convert_to_audio
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Converted&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	mP0bdHdXLyo_1000&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m4a to mP0bdHdXLyo_1000_temp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wav
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; WARNING  Removed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	mP0bdHdXLyo_1000&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m4a
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Duration&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	converted audio&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 11s
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO      &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; trim_audio
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Trimmed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	mP0bdHdXLyo_1000_temp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wav to mP0bdHdXLyo_1000&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wav
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; WARNING  Removed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	mP0bdHdXLyo_1000_temp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wav
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; WARNING   &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; padding
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; WARNING  Diff&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6892&lt;/span&gt;
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; WARNING  Removed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;AudioSet&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;strong_label_train&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;mP0bdHdXLyo_1000&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wav
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO      &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; checking
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Checking&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;AudioSet&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;strong_label_train_padded&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;mP0bdHdXLyo_1000&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wav
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Checking&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	channels&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Checking&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	samplerate&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;44100&lt;/span&gt;
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Checking&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	precision&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;bit
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Checking&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	duration&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;	&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.00&lt;/span&gt;
July &lt;span class=&quot;token number&quot;&gt;06&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; @&lt;span class=&quot;token number&quot;&gt;35396&lt;/span&gt; INFO     Finished&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 	mP0bdHdXLyo_1000&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;解決方案&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88&quot; aria-label=&quot;解決方案 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解決方案&lt;/h1&gt;
&lt;h2 id=&quot;來自youtube的問題&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BE%86%E8%87%AAyoutube%E7%9A%84%E5%95%8F%E9%A1%8C&quot; aria-label=&quot;來自youtube的問題 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;來自YouTube的問題&lt;/h2&gt;
&lt;p&gt;來自YouTube的問題基本上都是源於YouTube用戶使用協議產生的。這裏僅對此進行技術討論，且目的僅限於進行學術活動。作者並不鼓勵任何違反協議的行爲。&lt;/p&gt;
&lt;h3 id=&quot;訪問次數限制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A8%AA%E5%95%8F%E6%AC%A1%E6%95%B8%E9%99%90%E5%88%B6&quot; aria-label=&quot;訪問次數限制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;訪問次數限制&lt;/h3&gt;
&lt;p&gt;對於訪問次數的限制，可以通過直連節點代理的方式來規避。具體方法可以利用youtube-dl內的proxy相關參數來實現；也可以通過終端內對當前shell的環境變量進行設置來實現，這意味着整個運行過程都通過這個代理來下載。&lt;/p&gt;
&lt;p&gt;如果利用代理之後依然會出現訪問次數限制，請嘗試：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用不那麼擁擠的代理&lt;/li&gt;
&lt;li&gt;每隔一段時間就更換一下代理&lt;/li&gt;
&lt;li&gt;下載慢一點&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;由於我不需要頻繁切換代理，即可以保證穩定下載，所以我利用如下命令設置了環境變量：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;https_proxy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://127.0.0.1:8234&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;http_proxy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://127.0.0.1:8234&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;all_proxy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;socks5://127.0.0.1:8235&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這裏的具體IP和端口請根據自己的網絡情況和代理軟件進行設置，在此不做過多討論。&lt;/p&gt;
&lt;p&gt;如果需要頻繁切換代理的話，利用youtube-dl的option來設置proxy或許更好，因爲甚至可以設置爲每個下載的代理都不同。不過前提是你要有滿足你需求的代理地址。&lt;/p&gt;
&lt;h2 id=&quot;視頻下架&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%A6%96%E9%A0%BB%E4%B8%8B%E6%9E%B6&quot; aria-label=&quot;視頻下架 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;視頻下架&lt;/h2&gt;
&lt;p&gt;請聯繫作者，或者學術社區內其他在視頻還健在的時候下載過的人。&lt;/p&gt;
&lt;h2 id=&quot;地區限制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%B0%E5%8D%80%E9%99%90%E5%88%B6&quot; aria-label=&quot;地區限制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;地區限制&lt;/h2&gt;
&lt;p&gt;利用訪問次數限制這裏提到的方法，選取一個出口地點爲可用的地區/國家的代理。我的做法是，選取一個較穩定的代理進行下載之後，再用幾個不同的位置的代理對之前未能下載的列表進行嘗試。&lt;/p&gt;
&lt;p&gt;具體去哪裡弄這些代理，請聯繫身邊有經驗的人。&lt;/p&gt;
&lt;h2 id=&quot;年齡限制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B9%B4%E9%BD%A1%E9%99%90%E5%88%B6&quot; aria-label=&quot;年齡限制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;年齡限制&lt;/h2&gt;
&lt;p&gt;解決年齡限制的問題，需要登錄Google帳號來讓YouTube確認你的年齡。youtube-dl提供兩種登錄方式：帳號密碼和Cookie。我比較習慣提供Cookie給軟件使用。當然，如果覺得OK的話提供帳號密碼也可以，請參考youtube-dl的文檔。&lt;/p&gt;
&lt;p&gt;Cookie文件的獲取可以利用瀏覽器的插件很方便的進行。我利用的是EditThisCookie這個插件，可以在Chrome Web Store獲取。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/243dde66e47c91582a2eb7c5482b4238/218a4/5583f90dc8244dc99aff56094538ff91df055ef1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQY042PXU6DQBSFWZFLdAe+uBZffDFugAcE2thYGgVKRf7lp8wwfA4kJZqQ2JN8OZMzNyf3Giwa+U/jOP7xNRn753tK3yLJSkzTxHFcbNthu91w8DxeLAvXdRiVWsourJUbj7c3vD7c0QjYbFyiKCIII3aej/cestt/8HYIaDo53/C7cA3jZD/RphFiUKRpSlHkVLr9WEBcwWcJWQNFrbhGxuVRVZXe7qS3C+fipq74LnPqTuAngkBzTCVhJmnaljj+0nOZ9pg8z0mSlLbrMJQapjuQUtLpYAr7XiCE1GiXivas6RVnMTEyDIOe6ef/xTVT/gPCT82L4AGXGwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/243dde66e47c91582a2eb7c5482b4238/8ac56/5583f90dc8244dc99aff56094538ff91df055ef1.webp 240w,
/static/243dde66e47c91582a2eb7c5482b4238/d3be9/5583f90dc8244dc99aff56094538ff91df055ef1.webp 480w,
/static/243dde66e47c91582a2eb7c5482b4238/e46b2/5583f90dc8244dc99aff56094538ff91df055ef1.webp 960w,
/static/243dde66e47c91582a2eb7c5482b4238/c18de/5583f90dc8244dc99aff56094538ff91df055ef1.webp 1052w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/243dde66e47c91582a2eb7c5482b4238/8ff5a/5583f90dc8244dc99aff56094538ff91df055ef1.png 240w,
/static/243dde66e47c91582a2eb7c5482b4238/e85cb/5583f90dc8244dc99aff56094538ff91df055ef1.png 480w,
/static/243dde66e47c91582a2eb7c5482b4238/d9199/5583f90dc8244dc99aff56094538ff91df055ef1.png 960w,
/static/243dde66e47c91582a2eb7c5482b4238/218a4/5583f90dc8244dc99aff56094538ff91df055ef1.png 1052w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/243dde66e47c91582a2eb7c5482b4238/d9199/5583f90dc8244dc99aff56094538ff91df055ef1.png&quot;
            alt=&quot;5583f90dc8244dc99aff56094538ff91df055ef1.png&quot;
            title=&quot;5583f90dc8244dc99aff56094538ff91df055ef1.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;不過需要注意的是，youtube-dl需要滿足Netscape格式的Cookie文件。在插件選項當中設置一下即可（我這裏默認的是JSON）。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/62ed8b7e48e75b7720b72374889e2cbc/7960f/649e60721f3e49b54cbe8d784fb936554471b3dc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7klEQVQoz5VRSQqEQBDr/7/HV+hV0Jvgvu8LrhlSUDA3ZwqC6bY6nUqb4zjQti2KokDTNCjLElVVCbjfdR3u+wbreZ5XmH3f5XCapiKaZRniOJY1vxT8p8y2bRjHEcuyYJ5n4dM0YV1X8N95nriuSzin0TW5gqY4BfcNReiQQjqyig7DIA7J2aOcUXAC9uZ5LlNxn5caKvMgxQg2K6dA3/eIogie5yFJEomBa8ajF6oRyfCXXIIggGVZcBwHtm0LXNeF7/sIwxB1XYtTjm7eXo1FB3RIdzysoCs6ZGx0Kxm+uVNRlgb/DT4SH4ac9QFv4me+RQ6coQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/62ed8b7e48e75b7720b72374889e2cbc/8ac56/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 240w,
/static/62ed8b7e48e75b7720b72374889e2cbc/d3be9/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 480w,
/static/62ed8b7e48e75b7720b72374889e2cbc/e46b2/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 960w,
/static/62ed8b7e48e75b7720b72374889e2cbc/15a27/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 1274w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/62ed8b7e48e75b7720b72374889e2cbc/8ff5a/649e60721f3e49b54cbe8d784fb936554471b3dc.png 240w,
/static/62ed8b7e48e75b7720b72374889e2cbc/e85cb/649e60721f3e49b54cbe8d784fb936554471b3dc.png 480w,
/static/62ed8b7e48e75b7720b72374889e2cbc/d9199/649e60721f3e49b54cbe8d784fb936554471b3dc.png 960w,
/static/62ed8b7e48e75b7720b72374889e2cbc/7960f/649e60721f3e49b54cbe8d784fb936554471b3dc.png 1274w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/62ed8b7e48e75b7720b72374889e2cbc/d9199/649e60721f3e49b54cbe8d784fb936554471b3dc.png&quot;
            alt=&quot;649e60721f3e49b54cbe8d784fb936554471b3dc.png&quot;
            title=&quot;649e60721f3e49b54cbe8d784fb936554471b3dc.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&quot;來自audioset的問題&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BE%86%E8%87%AAaudioset%E7%9A%84%E5%95%8F%E9%A1%8C&quot; aria-label=&quot;來自audioset的問題 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;來自AudioSet的問題&lt;/h1&gt;
&lt;h2 id=&quot;數據量較大&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B8%E6%93%9A%E9%87%8F%E8%BC%83%E5%A4%A7&quot; aria-label=&quot;數據量較大 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;數據量較大&lt;/h2&gt;
&lt;p&gt;確實，因爲我們需要逐個視頻進行下載，再按照對應時間轉換爲音頻。對於AudioSet的百萬級別數據來說，這樣的方式需要蠻久的時間。我們可以利用多進程腳本來加速數據下載。不過這和YouTube的訪問次數保護是衝突的，如果你的出口帶寬不受YouTube的限制，那可以盡情使用多進程腳本。或者，也可以在不同的進程當中設置不同的代理進行下載，這樣即使利用了多進程加速，也和之前的單進程下載沒有什麼區別。&lt;/p&gt;
&lt;p&gt;多進程的第一步就是拆分任務，讀tsv文件進入Python之後，對列表進行拆分。我下載的是Strong Label的子集，所以tsv文件當中對同一樣本也進行了多個不同標註，所以還需要去重一下。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; multiprocessing &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Pool

&lt;span class=&quot;token comment&quot;&gt;# 讀取tsv到列表&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tsv_file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    meta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;readlines&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
meta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;line&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\t&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; line &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; meta&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 去重&lt;/span&gt;
meta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;meta&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 設置進程數&lt;/span&gt;
num_proc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 切分列表&lt;/span&gt;
split_input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        meta&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;meta&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;//&lt;/span&gt; num_proc &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;meta&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;//&lt;/span&gt; num_proc&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        save_dir&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;num_proc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 啓動進程池&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; Pool&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;num_proc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;starmap&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        download_tsv&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        star_input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;10秒時長的問題&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#10%E7%A7%92%E6%99%82%E9%95%B7%E7%9A%84%E5%95%8F%E9%A1%8C&quot; aria-label=&quot;10秒時長的問題 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;10秒時長的問題&lt;/h2&gt;
&lt;p&gt;我一直誤認爲AudioSet裏都是10秒的音頻片段。但後來發現，有兩種情況會讓音頻不足10秒：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;視頻都不到10秒&lt;/li&gt;
&lt;li&gt;標註的時間節點在視頻結束前~10秒，但是差一點&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以我意識到一件事情，有的音頻片段就是不足十秒，甚至只有兩三秒的長度。不過這種文件的數量不算很多，大概所有Strong Label樣本的10%左右。我在這裏進行了補零處理。最後所有的樣本都是10秒的時間長度。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;waveform&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; samplerate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; soundfile&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filename&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
diff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; samplerate &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; duration &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; waveform&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;shape&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
waveform &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; np&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;concatenate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;waveform&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; np&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;zeros&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; axis&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filename&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wb&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    soundfile&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; waveform&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; samplerate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;音頻格式、通道數、採樣率以及採樣位數&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9F%B3%E9%A0%BB%E6%A0%BC%E5%BC%8F%E3%80%81%E9%80%9A%E9%81%93%E6%95%B8%E3%80%81%E6%8E%A1%E6%A8%A3%E7%8E%87%E4%BB%A5%E5%8F%8A%E6%8E%A1%E6%A8%A3%E4%BD%8D%E6%95%B8&quot; aria-label=&quot;音頻格式、通道數、採樣率以及採樣位數 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;音頻格式、通道數、採樣率以及採樣位數&lt;/h2&gt;
&lt;p&gt;因爲我採用的方法是將視頻轉換爲音頻，所以目標格式就是常用的wav，避免進一步的編碼損失。但是源數據可能是雙通道，導致轉換後的數據集混雜了兩種通道數的數據。對於聲事件檢測任務，我認爲雙通道意義並不很明確。所以在轉換時都使其變爲單通道。對於採樣率，我這裏統一設置了比較高的44.1kHz，基本可以覆蓋全部的YouTube視頻中的音頻頻段。&lt;/p&gt;
&lt;p&gt;我們可以利用FFmpeg進行轉換。在Python當中，執行Shell中的命令可以利用os.system()或者os.popen()。下面代碼示例的寫法，方便進行不同參數的調試、增刪與順序調整。不過需要注意參數之前的空格。&lt;/p&gt;
&lt;p&gt;F-strings的寫法可以方便的傳入參數的值，我比較推薦。這個方法是由PEP 498引入的，需要Python≥3.6。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;ffmpeg_command &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot;ffmpeg -i &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;filename&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; -hide_banner&quot;&lt;/span&gt;&lt;/span&gt;
ffmpeg_command &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot; -acodec &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;codec&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
ffmpeg_command &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot; -ac &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;num_channels&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
ffmpeg_command &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot; -ar &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;sampelrate&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
ffmpeg_command &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token string-interpolation&quot;&gt;&lt;span class=&quot;token string&quot;&gt;f&quot; &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;output_file&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; silent&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    ffmpeg_command &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; 2&gt; /dev/null&quot;&lt;/span&gt;
os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;system&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ffmpeg_command&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[基於BusyBox的開發板如何上電自動鏈接WiFi]]></title><description><![CDATA[對於開發板上面的基於BusyBox的系統，如果能讓他在上電的時候自動鏈接Wi-Fi，就可以擺脫串口，更方便的進行調試了。本文記錄了如何讓開發板鏈接Wi-Fi以及如何配置上電自啓動。]]></description><link>https://lumen.netlify.com/posts/f077d3f6-b857-4125-ba49-0b3c3428078f</link><guid isPermaLink="false">https://lumen.netlify.com/posts/f077d3f6-b857-4125-ba49-0b3c3428078f</guid><pubDate>Mon, 28 Jun 2021 11:00:00 GMT</pubDate><content:encoded>&lt;p&gt;說白了，這也是一篇關於開機啓動的筆記。&lt;/p&gt;
&lt;p&gt;BusyBox這東西更體現了一切皆文件的這個僞科學。只要把鏈接Wifi（或者其他你想讓他做的工作）的.sh寫好，放在正確的啓動.sh裏面就沒問題了。&lt;/p&gt;
&lt;p&gt;先說如何讓開發板鏈接Wi-Fi，然後我們再討論如何自行啓動鏈接。&lt;/p&gt;
&lt;h1 id=&quot;wi-fi網路界面配置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#wi-fi%E7%B6%B2%E8%B7%AF%E7%95%8C%E9%9D%A2%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;wi fi網路界面配置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Wi-Fi網路界面配置&lt;/h1&gt;
&lt;h2 id=&quot;配置wpa_supplicantconf&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AEwpa_supplicantconf&quot; aria-label=&quot;配置wpa_supplicantconf permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置&lt;code class=&quot;language-text&quot;&gt;wpa_supplicant.conf&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這個文件通常在&lt;code class=&quot;language-text&quot;&gt;/etc/wpa_supplicant&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;/etc/wireless&lt;/code&gt;下面，如果沒有的話可以找一找其他類似的文件夾，或者直接用&lt;code class=&quot;language-text&quot;&gt;find&lt;/code&gt;搜一下&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;暫且可以不用關心這東西的原理，修改&lt;code class=&quot;language-text&quot;&gt;ssid&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;psk&lt;/code&gt;就好了。這裏面的&lt;code class=&quot;language-text&quot;&gt;key_mgmt&lt;/code&gt;個人測試發現不用擔心是WPA還是WPA2/WPA3，都用這個&lt;code class=&quot;language-text&quot;&gt;WPA-PSK&lt;/code&gt;就好啦。&lt;/p&gt;
&lt;p&gt;下面是我的開發板配置，請你參考你自己的默認配置來修改。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# /etc/wireless/wpa_supplicatn.conf&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;country&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;GB
&lt;span class=&quot;token assign-left variable&quot;&gt;ctrl_interface&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/var/wpa_supplicant
&lt;span class=&quot;token assign-left variable&quot;&gt;ctrl_interface_group&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;ap_scan&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;update_config&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;ssid&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;WIFI-SSID&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;psk&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;WIFI-PASSWORD&gt;&quot;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;key_mgmt&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;WPA-PSK
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;啓動wi-fi&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%95%93%E5%8B%95wi-fi&quot; aria-label=&quot;啓動wi fi permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;啓動Wi-Fi&lt;/h2&gt;
&lt;p&gt;第一步需要啓用Wi-Fi界面，這裏的名字叫做&lt;code class=&quot;language-text&quot;&gt;wlan0&lt;/code&gt;。如果不需要其他網路界面的話，可以在啓用Wi-Fi界面之後關閉其他的界面。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; wlan0 up
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; eth0 down
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; ppp0 down&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置好了&lt;code class=&quot;language-text&quot;&gt;wpa_supplicant.conf&lt;/code&gt;之後，就需要利用&lt;code class=&quot;language-text&quot;&gt;wpa_supplicant&lt;/code&gt;工具來參考這個conf文件進行WiFi鏈接。並且利用&lt;code class=&quot;language-text&quot;&gt;dhcpcd&lt;/code&gt;來獲取IP。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;wpa_supplicant -i wlan0 -Dnl80211 -c /etc/wireless/wpa_supplicant.conf -B
dhcpcd wlan0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;開機啓動&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%96%8B%E6%A9%9F%E5%95%93%E5%8B%95&quot; aria-label=&quot;開機啓動 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;開機啓動&lt;/h1&gt;
&lt;p&gt;把上面的指令保存在某一個文件夾，例如&lt;code class=&quot;language-text&quot;&gt;/usr/script/start-wifi.sh&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# /usr/script/start-wifi.sh&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; wlan0 up
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; eth0 down
&lt;span class=&quot;token function&quot;&gt;ifconfig&lt;/span&gt; ppp0 down

wpa_supplicant -i wlan0 -Dnl80211 -c /etc/wireless/wpa_supplicant.conf -B
dhcpcd wlan0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這樣執行這個文件，就可以啓動Wi-Fi界面、鏈接並獲取IP。 &lt;/p&gt;
&lt;p&gt;對於基於BusyBox的開發板，啓動的腳本是&lt;code class=&quot;language-text&quot;&gt;/etc/init.d/rcS&lt;/code&gt;，我們可以根據其中執行的順序根據需求放置在特定的任務後面。通常来说，對於啓動Wi-Fi這種任務，我們把啓動腳本放置在最後就好了。&lt;/p&gt;
&lt;p&gt;例如，在我用的這塊開發板上面，&lt;code class=&quot;language-text&quot;&gt;/etc/init.d/rcS&lt;/code&gt;最後指示它執行了&lt;code class=&quot;language-text&quot;&gt;source /usr/script/boot-script.sh&lt;/code&gt;這個指令。爲了使流程更加簡潔，我選擇把我的&lt;code class=&quot;language-text&quot;&gt;start-wifi.sh&lt;/code&gt;寫到這個&lt;code class=&quot;language-text&quot;&gt;boot-script.sh&lt;/code&gt;的最後來執行。另外，如果你的啓動流程當中需要進行手動確認的話，也請儘可能取消這些項目或者設置成延遲繼續，否則沒有辦法進行到你在最後添加的啓動任務。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[如何在Linux和macOS下配置啓動項]]></title><description><![CDATA[有些時候，我需要讓一些網絡工具在機器啓動的時候自動運行。例如，讓端口轉發自動運行的話，也就可以在機器斷電重啓之後自動上線，這樣可以實現實驗室的無人值守。那麼如何在Linux以及macOS下面實現自動運行一些腳本呢？這篇文章介紹了利用類似服務的方法的一些實現。]]></description><link>https://lumen.netlify.com/posts/543074fa-a990-45bf-bc64-371f03b12a76</link><guid isPermaLink="false">https://lumen.netlify.com/posts/543074fa-a990-45bf-bc64-371f03b12a76</guid><pubDate>Fri, 18 Jun 2021 11:43:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;背景介紹&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%B4%B9&quot; aria-label=&quot;背景介紹 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;背景介紹&lt;/h1&gt;
&lt;p&gt;我有FRP和Clash這兩個程序需要一直在後台運行，並且都與網絡相關：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要在網絡啟動之後再運行&lt;/li&gt;
&lt;li&gt;網絡重啟的話也跟著重啟&lt;/li&gt;
&lt;li&gt;失敗了之後也重啟&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;部署細節&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%83%A8%E7%BD%B2%E7%B4%B0%E7%AF%80&quot; aria-label=&quot;部署細節 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;部署細節&lt;/h1&gt;
&lt;h2 id=&quot;文件放在哪裏&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%87%E4%BB%B6%E6%94%BE%E5%9C%A8%E5%93%AA%E8%A3%8F&quot; aria-label=&quot;文件放在哪裏 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文件放在哪裏&lt;/h2&gt;
&lt;h3 id=&quot;主要的linux系統&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BB%E8%A6%81%E7%9A%84linux%E7%B3%BB%E7%B5%B1&quot; aria-label=&quot;主要的linux系統 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;主要的Linux系統&lt;/h3&gt;
&lt;p&gt;文件的位置在目錄&lt;code class=&quot;language-text&quot;&gt;/lib/systemd/system&lt;/code&gt; 下，创建一个叫做&lt;code class=&quot;language-text&quot;&gt;frpc.service&lt;/code&gt;另一個叫做&lt;code class=&quot;language-text&quot;&gt;clash.ini&lt;/code&gt;的文件就好了。&lt;/p&gt;
&lt;p&gt;OpenWRT之類的系統通常都利用WebUI來進行交互。在WebUI當中，我們可以利用&lt;strong&gt;LuCI → System → Startup&lt;/strong&gt;這個頁面來進行啓動服務的設置。當然，對這類可能是用來做特定事情的操作系統，像Frp之類的工具或許都有一些高級的封裝，所以也可以直接安裝相應的包，Enable之後他們也會達成相應的需求。&lt;/p&gt;
&lt;h3 id=&quot;macos系統&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#macos%E7%B3%BB%E7%B5%B1&quot; aria-label=&quot;macos系統 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MacOS系統&lt;/h3&gt;
&lt;p&gt;MacOS下面常用有兩種方式：&lt;strong&gt;LaunchAgents&lt;/strong&gt;和&lt;strong&gt;Login Items&lt;/strong&gt;。其中&lt;strong&gt;LaunchAgents&lt;/strong&gt;和Linux下面的Service比較類似，而&lt;strong&gt;Login Items&lt;/strong&gt;則是相對更加圖形化的做法。&lt;/p&gt;
&lt;p&gt;對於&lt;strong&gt;LaunchAgents&lt;/strong&gt;，有系統層面和当前用戶和全用户不同的放置路徑，分別是&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;/Library/LaunchAgents  &lt;span class=&quot;token comment&quot;&gt;# for all users&lt;/span&gt;
~/Library/LaunchAgents  &lt;span class=&quot;token comment&quot;&gt;# for specific user&lt;/span&gt;
/System/Library/LaunchAgents  &lt;span class=&quot;token comment&quot;&gt;# for system&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在這裏，我們就可以根據不同的運行要求來將一個&lt;code class=&quot;language-text&quot;&gt;plist&lt;/code&gt;文件放在不同的位置。&lt;/p&gt;
&lt;p&gt;對於&lt;strong&gt;Login Items&lt;/strong&gt;，可以在&lt;strong&gt;System Preference&lt;/strong&gt;面板當中的&lt;strong&gt;Users &amp;#x26; Groups&lt;/strong&gt;頁找到。我們可以在這裏添加完成對應任務的script文件。&lt;/p&gt;
&lt;p&gt;這裏，爲了能夠讓進程在後臺守護運行，我選擇利用&lt;code class=&quot;language-text&quot;&gt;LaunchAgents&lt;/code&gt;的方法來實現。&lt;/p&gt;
&lt;h2 id=&quot;文件詳解&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%96%87%E4%BB%B6%E8%A9%B3%E8%A7%A3&quot; aria-label=&quot;文件詳解 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文件詳解&lt;/h2&gt;
&lt;h3 id=&quot;macos下面的plist文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#macos%E4%B8%8B%E9%9D%A2%E7%9A%84plist%E6%96%87%E4%BB%B6&quot; aria-label=&quot;macos下面的plist文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;macOS下面的&lt;code class=&quot;language-text&quot;&gt;.plist&lt;/code&gt;文件&lt;/h3&gt;
&lt;p&gt;這個文件描述了我設置的可以運行frpc的agent的細節。其中&lt;code class=&quot;language-text&quot;&gt;ProgramArguments&lt;/code&gt;鍵中記載運行frpc的指令，如果有很多參數的話，可以按照&lt;strong&gt;string array&lt;/strong&gt;的方式來記錄。在&lt;code class=&quot;language-text&quot;&gt;KeepAlive&lt;/code&gt;鍵當中，我們可以將其設置爲&lt;code class=&quot;language-text&quot;&gt;&amp;lt;true/&amp;gt;&lt;/code&gt;來保證其持續運行。其他內容可以參考&lt;code class=&quot;language-text&quot;&gt;&amp;lt;key&amp;gt; &amp;lt;/key&amp;gt;&lt;/code&gt;當中所描述的功能來判斷。更多功能請&lt;a href=&quot;https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;參考文檔&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;⚠️  &lt;strong&gt;注意：請將&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;ABSOLUTE_PATH&amp;gt;&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;替换对应的绝对路径。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token prolog&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;/span&gt;
&lt;span class=&quot;token doctype&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;!&lt;/span&gt;&lt;span class=&quot;token doctype-tag&quot;&gt;DOCTYPE&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;plist&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;PUBLIC&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;-//Apple&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;Computer//DTD&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;PLIST&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;1.0//EN&lt;/span&gt;
  &lt;span class=&quot;token name&quot;&gt;http://www.apple.com/DTDs/PropertyList-1.0.dtd&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;plist&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1.0&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Label&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;frpc&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;ProgramArguments&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ABSOLUTE_PATH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/frpc&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;-c&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ABSOLUTE_PATH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;/frpc.ini&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;KeepAlive&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;RunAtLoad&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;plist&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;linux下面的service文件&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#linux%E4%B8%8B%E9%9D%A2%E7%9A%84service%E6%96%87%E4%BB%B6&quot; aria-label=&quot;linux下面的service文件 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Linux下面的&lt;code class=&quot;language-text&quot;&gt;.service&lt;/code&gt;文件&lt;/h3&gt;
&lt;p&gt;Linux下面的Service描述文件則更加直觀，也方便進行更精細的控制。&lt;/p&gt;
&lt;p&gt;例如在&lt;strong&gt;Unit&lt;/strong&gt;下的&lt;code class=&quot;language-text&quot;&gt;After&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Wants&lt;/code&gt;鍵則對應任務執行的順序和對前序任務的要求。在&lt;strong&gt;Service&lt;/strong&gt;當中的&lt;code class=&quot;language-text&quot;&gt;ExecStart&lt;/code&gt;就是我們要執行的指令，&lt;code class=&quot;language-text&quot;&gt;Restart&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;RestartSec&lt;/code&gt;則指定了如果進程發生意外結束之後是否重啓以及經過多久之後重啓。&lt;/p&gt;
&lt;p&gt;這裏提供了我所需要的兩項服務的Service描述。由於都是網絡相關的應用，所以前序任務都是&lt;strong&gt;網絡服務啓動&lt;/strong&gt;並且&lt;strong&gt;網絡在線&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;⚠️  &lt;strong&gt;注意：請將&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;ABSOLUTE_PATH&amp;gt;&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;替换对应的绝对路径。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;frpc &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network.target network-online.target
&lt;span class=&quot;token assign-left variable&quot;&gt;Wants&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network-online.target

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Service&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;simple
&lt;span class=&quot;token assign-left variable&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ABSOLUTE_PATH&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/frp/frpc -c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ABSOLUTE_PATH&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/frp/frpc.ini
&lt;span class=&quot;token assign-left variable&quot;&gt;Restart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;always
&lt;span class=&quot;token assign-left variable&quot;&gt;RestartSec&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Install&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;multi-user.target&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;clash proxy &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network.target network-online.target
&lt;span class=&quot;token assign-left variable&quot;&gt;Wants&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network-online.target

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Service&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;simple
&lt;span class=&quot;token assign-left variable&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ABSOLUTE_PATH&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/clash -f &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ABSOLUTE_PATH&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;/config.yaml
&lt;span class=&quot;token assign-left variable&quot;&gt;Restart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;always
&lt;span class=&quot;token assign-left variable&quot;&gt;RestartSec&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Install&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;multi-user.target&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;如何運行&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E9%81%8B%E8%A1%8C&quot; aria-label=&quot;如何運行 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何運行&lt;/h2&gt;
&lt;h3 id=&quot;對於linux操作系統&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B0%8D%E6%96%BClinux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%B5%B1&quot; aria-label=&quot;對於linux操作系統 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;對於Linux操作系統&lt;/h3&gt;
&lt;p&gt;在Linux操作系統下，可以利用&lt;code class=&quot;language-text&quot;&gt;systemctl&lt;/code&gt;來對服務進行控制。&lt;code class=&quot;language-text&quot;&gt;systemctl enable&lt;/code&gt;可以啓用服務，但默認是要在下一次滿足前序任務之後才會運行。如果想要立即運行，可以利用&lt;code class=&quot;language-text&quot;&gt;systemctl start&lt;/code&gt;來直接運行服務。&lt;code class=&quot;language-text&quot;&gt;systemctl status&lt;/code&gt;則可以看到服務的運行狀態以及服務進程的std輸出。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在本例當中&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;$SERVICE_NAME&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;是&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;clash&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;或者&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;frpc&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 啟動指令&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl start &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl restart &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 終止指令&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl disable &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl stop &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 查看狀態指令&lt;/span&gt;
systemctl status &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;對於macos操作系統&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B0%8D%E6%96%BCmacos%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%B5%B1&quot; aria-label=&quot;對於macos操作系統 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;對於macOS操作系統&lt;/h3&gt;
&lt;p&gt;在macOS操作系統下，利用&lt;code class=&quot;language-text&quot;&gt;launchctl&lt;/code&gt;來管理&lt;strong&gt;LaunchAgents&lt;/strong&gt;。如果在&lt;code class=&quot;language-text&quot;&gt;.plist&lt;/code&gt;當中配置了&lt;code class=&quot;language-text&quot;&gt;RunAtLoad&lt;/code&gt;的話，則可以在&lt;code class=&quot;language-text&quot;&gt;launchctl load&lt;/code&gt;之後直接運行。如果要查看狀態，需要在&lt;code class=&quot;language-text&quot;&gt;launchctl list&lt;/code&gt;當中利用&lt;code class=&quot;language-text&quot;&gt;grep&lt;/code&gt;查找對應服務的所在行，如果第一項&lt;code class=&quot;language-text&quot;&gt;pid&lt;/code&gt;是數字而非橫線符的話，則表明進程已經啓動。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在本例當中&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;$SERVICE_NAME&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;是&lt;/strong&gt;&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;clash.plist&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 啟動指令&lt;/span&gt;
launchctl load &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 終止指令&lt;/span&gt;
launchctl unload &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 查看狀態指令&lt;/span&gt;
launchctl list &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$SERVICE_NAME&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Forwarding the Lab Power：在任意位置鏈接你的算力]]></title><description><![CDATA[這篇文章是我疫情期間在加爲了鏈接實驗室的算力而做的嘗試，當時主要利用的ssh的端口轉發功能。現在實現同樣功能我用的是Frp，但是SSH的端口轉發支持廣泛、配置容易、而且兼容性也更好，依然處在不可替代的地位。將當時採用的方法記錄在這裏。]]></description><link>https://lumen.netlify.com/posts/facf277e-1429-41fd-a168-c684eb945e07</link><guid isPermaLink="false">https://lumen.netlify.com/posts/facf277e-1429-41fd-a168-c684eb945e07</guid><pubDate>Mon, 31 May 2021 11:14:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;狀況假設&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%8B%80%E6%B3%81%E5%81%87%E8%A8%AD&quot; aria-label=&quot;狀況假設 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;狀況假設&lt;/h1&gt;
&lt;p&gt;假設我們有如下這些設備，我用&lt;code class=&quot;language-text&quot;&gt;&amp;lt;user&amp;gt;@&amp;lt;ip&amp;gt;&lt;/code&gt;來表示對應用戶名和其主要網卡的IP：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;GPU算力集羣，叫&lt;code class=&quot;language-text&quot;&gt;gpu_cluster&lt;/code&gt;：&lt;code class=&quot;language-text&quot;&gt;&amp;lt;gpu_cluster&amp;gt;@&amp;lt;gpu_server_ip&amp;gt;&lt;/code&gt;
（位置：實驗室的局域網內，不可鏈接互聯網）&lt;/li&gt;
&lt;li&gt;實驗室PC，叫&lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt;&lt;/code&gt;: &lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt;@&amp;lt;lab_pc_ip&amp;gt;&lt;/code&gt;
（位置：實驗室的局域網內，可以鏈接互聯網）&lt;/li&gt;
&lt;li&gt;終端機，叫&lt;code class=&quot;language-text&quot;&gt;mac&lt;/code&gt;：&lt;code class=&quot;language-text&quot;&gt;&amp;lt;my_mac&amp;gt;@&amp;lt;mac_ip&amp;gt;&lt;/code&gt; &lt;em&gt;（是你要執行登錄用的機器）&lt;/em&gt;
（位置：你公司/家裏/咖啡館的某個網絡之中，可能沒有公網IP，不過無所謂啦。）&lt;/li&gt;
&lt;li&gt;互聯網雲服務器，叫&lt;code class=&quot;language-text&quot;&gt;cloud_server&lt;/code&gt;：&lt;code class=&quot;language-text&quot;&gt;&amp;lt;cloud_server&amp;gt;@&amp;lt;cloud_server_ip&amp;gt;&lt;/code&gt;
（位置：互聯網中，不可直接誒訪問實驗室局域網，&lt;strong&gt;❗️️有一個公網獨立IP&lt;/strong&gt;）&lt;/li&gt;
&lt;li&gt;實驗室PC，叫&lt;code class=&quot;language-text&quot;&gt;lab_pc&lt;/code&gt;：&lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt;@&amp;lt;lab_pc_ip&amp;gt;&lt;/code&gt;  &lt;em&gt;（也就是SSH跳板機）&lt;/em&gt;
（位置：實驗室局域網內，可鏈接互聯網）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;那這個時候，&lt;strong&gt;我突然想用我的終端機在咖啡館訪問到實驗室的GPU算力集羣&lt;/strong&gt;。由於GPU算力集羣不能鏈接公網，所以我們可能直覺上就會說，通過我在實驗室的工作機來訪問GPU算力集羣。但是你在咖啡館也&lt;code class=&quot;language-text&quot;&gt;ping&lt;/code&gt;不到你在實驗室的PC機。這時有公網獨立IP的一個服務器就非常重要，因爲你的便攜機Mac和實驗室的PC在公網都沒有屬於自己的IP，但他們都有鏈接上互聯網。如果有一個他們都能直接訪問到的IP，就可以通過這個中轉站進行通訊。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c8fa83b18c4803cf7dfeb32a8d5e453b/d10dd/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACD0lEQVQoz3VTXWvTYBTO//DSv+CNP8ALf4BX3nvlneCNguCFoFfC7gaiiB+IsqFzyGQOh23HWJexdq1tk0rTZVnTNEmTpknz+Xjed03NCh445OXlnOd9nuecCKDIsgzFb5qmiKMIQeDD9aZwKMMwRER3juPQfYA4jlGMvFdYBouo8KyvoFL7jUcbB7jxfAMr20cIPRfGaIQ4SagmgTuZwHVdqKq6AGcYHJAxYjF1xpA6HShdGeu7+7jzZhe3Vr/jZakBc6jjTNMgd9rwbJPXM9BmswnTNLkCzrBI+0e1jqHjsae45OpxHeVaCwe1xqKhp1t48WUbQZxekuz7Pk9BUfoYDTT8bCq4+vAdvtZ6jDxMy8aMvMriCBPm2+wC8NnWEa4/XcfxqYHI92DZNjzP474yf4WBPoSln+OzKOHK/VcoSdrFi8GMS4rIs6Lx9z6WcXNlE6/LDfS6EiRJppQgiiJ0Xf8n2ScJa1s7SOZ+shElBBbTpENKZCkcP8Td979we/UbHm8ezh8Bt4OxZLPgQ0nmLFSarmEYC0YMunVu4Y9uY0oNMcl3xzZ2SnsY0yoFPq0UTZrJvbQ2PPn+Zeh2u5ApbWMIUe7j2pNPeLBWQTLzyVcLp7QmCQFHxCofVNESYXkx+S5SoaoN8KFSx9v9NtqaiRmx8YnJciwI5QyX/xTGMo/Dkxb2quJ/AYp9+fkvtRw6blWOKiQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/c8fa83b18c4803cf7dfeb32a8d5e453b/8ac56/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.webp 240w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/d3be9/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.webp 480w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/e46b2/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.webp 960w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/f992d/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.webp 1440w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/61421/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.webp 1749w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/c8fa83b18c4803cf7dfeb32a8d5e453b/8ff5a/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png 240w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/e85cb/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png 480w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/d9199/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png 960w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/07a9c/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png 1440w,
/static/c8fa83b18c4803cf7dfeb32a8d5e453b/d10dd/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png 1749w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/c8fa83b18c4803cf7dfeb32a8d5e453b/d9199/8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png&quot;
            alt=&quot;8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png&quot;
            title=&quot;8d251cc1ddff6d80cc3f65e814b91b8e1a232dbd.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;可是，如何實現呢？&lt;/p&gt;
&lt;h1 id=&quot;透過安全外殼協議ssh的端口轉發&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%80%8F%E9%81%8E%E5%AE%89%E5%85%A8%E5%A4%96%E6%AE%BC%E5%8D%94%E8%AD%B0ssh%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%BD%89%E7%99%BC&quot; aria-label=&quot;透過安全外殼協議ssh的端口轉發 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;透過安全外殼協議SSH的端口轉發&lt;/h1&gt;
&lt;p&gt;SSH是通常我們用來登錄位於網絡當中的某個機器的外殼所用的協議。最常用的方法大概是這樣：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -p &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;user&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;@&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ip&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# port is 22 by default&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這就是最簡單的正向鏈接，參數&lt;code class=&quot;language-text&quot;&gt;-p&lt;/code&gt;告訴工具要透過某個端口鏈接，默認是&lt;code class=&quot;language-text&quot;&gt;22&lt;/code&gt;號端口。那麼除了-p參數，我再列舉幾個手冊中的參數說明在這裏。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-R&lt;/code&gt; ：將遠端指定的端口&lt;strong&gt;轉發至本機&lt;/strong&gt;的某一個端口
&lt;em&gt;Specifies that connections to the given TCP port or Unix socket on the remote (server) host are&lt;/em&gt; &lt;strong&gt;&lt;em&gt;to be forwarded to&lt;/em&gt;&lt;/strong&gt; &lt;em&gt;the&lt;/em&gt; &lt;strong&gt;&lt;em&gt;local&lt;/em&gt;&lt;/strong&gt; &lt;em&gt;side.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-L&lt;/code&gt;：將本地指定的端口&lt;strong&gt;轉發至遠端&lt;/strong&gt;的某一個端口
&lt;em&gt;Specifies that connections to the given TCP port or Unix socket on the local (client) host are&lt;/em&gt; &lt;strong&gt;&lt;em&gt;to be forwarded to&lt;/em&gt;&lt;/strong&gt; &lt;em&gt;the given host and port, or Unix socket, on the&lt;/em&gt; &lt;strong&gt;&lt;em&gt;remote&lt;/em&gt;&lt;/strong&gt; &lt;em&gt;side.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-f&lt;/code&gt;：後臺形式保持鏈接
&lt;em&gt;Run SSH as daemon progress&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;看到&lt;code class=&quot;language-text&quot;&gt;-R&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;-L&lt;/code&gt;兩個參數，貌似与我们的需求有点关系。他們比較常用的用法大概是這樣&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# -R&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -R -N &lt;span class=&quot;token variable&quot;&gt;$TO_REMOTE_PORT&lt;/span&gt;:localhost:&lt;span class=&quot;token variable&quot;&gt;$FROM_LOCAL_PORT&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$REMOTE_USER&lt;/span&gt;@&lt;span class=&quot;token variable&quot;&gt;$REMOTE_HOST&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# -L&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -L -N *:&lt;span class=&quot;token variable&quot;&gt;$TO_LOCAL_PORT&lt;/span&gt;:localhost:&lt;span class=&quot;token variable&quot;&gt;$FROM_LOCAL_PORT&lt;/span&gt; localhost&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在本文當中，我們通過&lt;code class=&quot;language-text&quot;&gt;-L&lt;/code&gt;來進行本地和本地端口轉發，通過&lt;code class=&quot;language-text&quot;&gt;-R&lt;/code&gt;來進行機器之間的端口轉發。而另外的参数&lt;code class=&quot;language-text&quot;&gt;-N&lt;/code&gt;则是告訴SSH不要登錄Shell，不執行指令，僅作端口轉發。&lt;/p&gt;
&lt;h2 id=&quot;僅內網機器和跳板機之間的鏈接&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%83%85%E5%85%A7%E7%B6%B2%E6%A9%9F%E5%99%A8%E5%92%8C%E8%B7%B3%E6%9D%BF%E6%A9%9F%E4%B9%8B%E9%96%93%E7%9A%84%E9%8F%88%E6%8E%A5&quot; aria-label=&quot;僅內網機器和跳板機之間的鏈接 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;僅內網機器和跳板機之間的鏈接&lt;/h2&gt;
&lt;p&gt;最重要的就是內網機器（內網當中可以訪問網絡的機器）和跳板機（實驗室內可以訪問公網的機器）之間的鏈接，因爲這個鏈接解決了內網和公網之間的隔閡。如果說沒時間完善更多的鏈接，甚至都可以直接建立好這個鏈接之後透過公網服務器登錄到內網機器，再通過內網IP來尋找到你的目標服務器（GPU算力集羣），雖然麻煩了些，但是起碼已經可以連通了。&lt;/p&gt;
&lt;p&gt;本例當中，我們首先要在內網的機器上進行操作。在內網可以鏈接互聯網的機器&lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt;&lt;/code&gt;上面將自己的&lt;code class=&quot;language-text&quot;&gt;22&lt;/code&gt;端口轉發到服務器上的某個端口 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;port_on_server&amp;gt;&lt;/code&gt; ，然後就可以在服務器上通過這個端口進行訪問了。&lt;/p&gt;
&lt;p&gt;具體鏈接指令寫在這裏，注意：&lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt; $&lt;/code&gt; 表示你是在 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt;&lt;/code&gt;上執行的操作。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;__&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
&lt;span class=&quot;token variable&quot;&gt;$__&lt;/span&gt; autossh -M &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;monitor_port&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; -R -N &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port_on_server&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;:localhost:22 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;cloud_server&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;@&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;cloud_server_ip&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這裏使用了&lt;code class=&quot;language-text&quot;&gt;autossh&lt;/code&gt;，實際上他和&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;最大的區別就是多了個監視端口參數&lt;code class=&quot;language-text&quot;&gt;-M &amp;lt;monitor_port&amp;gt;&lt;/code&gt;，利用這個監視端口，我們可以監控鏈接有沒有意外發生broken pipeline。斷線則自動重連，在遠端長時間轉發當中十分實用。&lt;/p&gt;
&lt;p&gt;現在就可以透過以下指令鏈接內網機器了，然後進入內網之後，你想鏈接算力集羣或者其他機器就都不成問題了。注意這裏的用戶名應該是我們最終到達機器的用戶名。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;**&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my_mac&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$*&lt;/span&gt;* &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -p &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port_on_server&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;@&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;cloud_server_ip&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;算力集羣與跳板機之間的鏈接&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%AE%97%E5%8A%9B%E9%9B%86%E7%BE%A3%E8%88%87%E8%B7%B3%E6%9D%BF%E6%A9%9F%E4%B9%8B%E9%96%93%E7%9A%84%E9%8F%88%E6%8E%A5&quot; aria-label=&quot;算力集羣與跳板機之間的鏈接 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;算力集羣與跳板機之間的鏈接&lt;/h2&gt;
&lt;p&gt;由於本例當中算力集羣並不能訪問互聯網，所以我們要把算力集羣先鏈接至可以訪問公網的內網機器，然後在通過上面講述的方法鏈接到公網服務器上。大多數情況下，局域網內網絡應該都還不錯，不太會出現斷線，所以也可以不使用&lt;code class=&quot;language-text&quot;&gt;autossh&lt;/code&gt;來進行監控鏈接狀況，直接&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;鏈接即可。這時登錄要鏈接的GPU算力集羣，我們將他的&lt;code class=&quot;language-text&quot;&gt;22&lt;/code&gt;端口轉發到實驗室PC上來。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;**&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;gpu_cluster&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$*&lt;/span&gt;* &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -R -N &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port_on_lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;:localhost:22 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;@&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc_ip&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;由於接下來我們需要把&lt;code class=&quot;language-text&quot;&gt;&amp;lt;lab_pc&amp;gt;&lt;/code&gt;上面&lt;code class=&quot;language-text&quot;&gt;&amp;lt;port_on_lab_pc&amp;gt;&lt;/code&gt;的鏈接轉發出去，但這裏要注意一個問題，如果繼續轉發&lt;code class=&quot;language-text&quot;&gt;&amp;lt;port_on_lab_pc&amp;gt;&lt;/code&gt;到公網服務器的話，在我的實踐當中會出莫名失敗，所以這裏更推薦的方法是再加一層本機上的端口轉發（或許是起到了detach之用），這就要用到之前提到的-L參數了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;**&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$*&lt;/span&gt;* &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -L -N *:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;reassign_port&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;:localhost:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port_on_lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; localhost&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這時我們再利用上一節當中所用的&lt;code class=&quot;language-text&quot;&gt;autossh -R&lt;/code&gt;將這個本地轉發過端口繼續轉發到公網服務器上面去。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;**&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 
&lt;span class=&quot;token variable&quot;&gt;$*&lt;/span&gt;* autossh -M &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;monitor_port&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; -R -N &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port_on_server&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;:localhost:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;reassign_port&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;cloud_server&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;@&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;cloud_server_ip&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;這時我們就可以依舊直接&lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt;服務器上的對應端口，就可以直接連線到GPU算力集羣上面了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;**&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my_mac&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$*&lt;/span&gt;* &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; -p &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;port_on_server&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;lab_pc&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;@&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;cloud_server_ip&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;恭喜您。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Catalyst：基於PyTorch的深度學習研發催化劑]]></title><description><![CDATA[翻译了一篇Scitator的博客。他是Catalyst团队Lead，开发了Catalyst这个基于PyTorch的深度学习研发框架。这篇文章简单介绍了这个框架的一些概念和思路。个人认为十分容易上手。]]></description><link>https://lumen.netlify.com/posts/61941d3c-0be0-4cc2-9e9c-fa0d784d8a29</link><guid isPermaLink="false">https://lumen.netlify.com/posts/61941d3c-0be0-4cc2-9e9c-fa0d784d8a29</guid><pubDate>Sun, 30 May 2021 09:12:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;譯者按&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;我平時在訓練神經網絡的時候，幾乎每次都要重新寫很多內容。倒也不是不能在之前的腳本上面改，主要是覺得改起來不如寫起來方便，況且不同的實驗也或多或少有不一樣的地方；就算改，每次或多或少都會遇到些問題，例如在某個不知名的角落裏寫死了一個變量。
一直都有個想寫個兼容各種實驗的代碼庫的想法，但是後來發現工作量不小，遂作罷。最近在網絡上發現了Catalyst這個庫，簡單看了下內容，發現與我之前的代碼庫思路比較一致，很多地方幫助我們造好了不錯的輪子。現在把前一段時間這個項目作者Lead寫在medium上面的一篇博客翻譯給大家，希望能幫助到有需要的人。&lt;/p&gt;
&lt;!--TOC--&gt;
&lt;blockquote&gt;
&lt;p&gt;Sergey Kolesnikov &lt;/p&gt;
&lt;p&gt;km4sh[譯]&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/pytorch/catalyst-a-pytorch-framework-for-accelerated-deep-learning-r-d-ad9621e4ca88&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;medium.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在過去的十幾年當中，隨着深度學習的發展，各式各樣相關的開源項目和框架也逐漸被人所熟知。例如PyTorch就可以說是當中最被研究人員青睞的項目之一。得益於符合Python哲學的設計與良好的底層實現，許多研究團隊都選用Pytorch作爲工具。但是，能力愈強，責任愈大，由於涉及很多與底層密切相關的函數，PyTorch的用戶們常常在研究過程中會遇到不少Bug。另外，隨着硬件加速訓練的崛起，一個能夠在不同硬件平臺上適配的簡單API成爲了當下一個迫切的需要。&lt;/p&gt;
&lt;p&gt;最近三年，Catalyst-Team一直在研發Catalyst。這是一個基於PyTorch的深度學習研發框架。這個框架致力於改善實驗的可復現性、開發速度以及代碼重用率，因此，用戶們在設計新的實驗時可以把造輪子的時間用來實現一些新的想法。在Catalyst當中，你可以輕易的實現不同的度量函數、模型存檔、多種多樣的日誌方式以及分佈式訓練，並且可以極大避免翻來覆去都差不多的代碼和根本不知所云的底層Bug。&lt;/p&gt;
&lt;p&gt;在這篇文章當中，我將分享一些我們對於這種高級深度學習框架API的思考，並且利用各種各樣的例子來展示這個項目當前的开发进展。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;deep-learning-recap-深度學習覆盤&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#deep-learning-recap-%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E8%A6%86%E7%9B%A4&quot; aria-label=&quot;deep learning recap 深度學習覆盤 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deep Learning recap 深度學習覆盤&lt;/h1&gt;
&lt;p&gt;在我們開始之前，我們先來看看在我們用隨機梯度下降法訓練深度學習模型的時候，都在做些什麼：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/71c1d/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABI0lEQVQoz53Qz4qCQBwH8HmECArUSFNJVrq4ubkhrCdBD75Rf+gtOncuX6BbLyGoXewSHsSLXb/xG+oQrEvs4TMzDPP7N+x2u4FrHvtD0zRve76v6xrseDxiv9/jcDi8iOP4bfT+dDqhqiow78eDMTag6zoURcFoNOIkSeIGg8GfhsMhut0uoijC9XoFc2YOTOMD89kcX582HMeB67owTZMnfga1oSZ6vR7CMMT5fAazbRuCIGCsjzG1ppg736AinufxxJPJhAfKsvwrKtrv9xEEAdI0BbMsi1cQRIGPqKoqNE3jX0DoLIpiK5qg0+nA933keQ623W6x2WywXq+xWq2wXC6xWCxe0H0biqP43W6HoijAaKFWkyT5tyzLcLlcUJYl7tQQgAZyVHOjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/8ac56/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 240w,
/static/9c3ba3e018c50cd28559cf115880c00d/d3be9/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 480w,
/static/9c3ba3e018c50cd28559cf115880c00d/e46b2/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 960w,
/static/9c3ba3e018c50cd28559cf115880c00d/f992d/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 1440w,
/static/9c3ba3e018c50cd28559cf115880c00d/0abaa/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 1536w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/8ff5a/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 240w,
/static/9c3ba3e018c50cd28559cf115880c00d/e85cb/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 480w,
/static/9c3ba3e018c50cd28559cf115880c00d/d9199/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 960w,
/static/9c3ba3e018c50cd28559cf115880c00d/07a9c/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 1440w,
/static/9c3ba3e018c50cd28559cf115880c00d/71c1d/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 1536w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/d9199/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
            alt=&quot;cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
            title=&quot;cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;當我們開始一個實驗的時候，可能先定義了一些訓練階段、Epoch數以及數據集的處理。在這之後，我們一遍又一遍的把數據採樣成Batch，然後推理，根據誤差函數算出距離，再利用梯度下降進行參數更新。沒錯，就是這麼簡單。但是，隨着項目的發展和更多Tricks的加入，例如加入了更多不同的誤差函數和更新策略，或者我們要在新的硬件加速平臺上進行訓練，代碼和邏輯可能就不如上面這樣直觀了。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;catalyst&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#catalyst&quot; aria-label=&quot;catalyst permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Catalyst&lt;/h1&gt;
&lt;p&gt;爲了解決上面遇到的這類問題，我們創造了Catalyst，一個致力於改善實驗的可復現性、開發速度以及代碼復用的PyTorch深度學習研發框架。這個框架提供了一些在實驗過程當中實用的抽象概念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt; 運行抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt; 推理引擎抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt; 回調函數抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt; 度量抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Logger&lt;/code&gt; 日誌抽象&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;runner-運行抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#runner-%E9%81%8B%E8%A1%8C%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;runner 運行抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt; 運行抽象&lt;/h2&gt;
&lt;p&gt;第一個要介紹的抽象就是&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt; ，在這個抽象當中，包含了一切你所需要的實驗邏輯：數據集、模型、每個Batch的預處理以及後處理、誤差函數甚至包括監控系統的指定。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d3365c149e4465d2406b9c90419fcd14/5f78c/daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 155%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsSAAALEgHS3X78AAAEfklEQVRIx5VWy1LjVhT0DwSqeCS2JettvSXrZRuMsYdM5UvCkHwFWz5ggPwAu8mfABsMFCzYwIZiNrCDVaevjBnPDK8sTl3dKqnVp0+fc2/l9vYW9/f3eHh4eFr/T0x/c3d3h8rXrzf48uVffN7ewc7uP9jmur29/RQ7Ozuvxu7ubvne3t4erq+vUbm4uMDq4APmJQmqZ0JW6qhJNdTkKqr1KhYXFrGwsID5+fkyFuYXnvZiXVxcxOzsLIIgwOnpKSrHx8dYW1uDommIWz4jgBeF8HwXURzCtV3ougaNUa7a96HrOmRZRp7nODw8RGU0OsJwOIRqNVF0W2WEeYKwyGHHAfzYQ5GGSGMfnmvBsQy4pgFTN6CrOhqNBur1OpIkwf7+/hhwMBhAcyJ8WOvh97UldPuryPofES/34acpev0h+r0+8ixDt9NBN+8giiIEXoCmaUGqS1OAR2OGkqIiYspR5MILPNh+AJu6GI4NJ0rg8DkIQziuC5/PIWURoL7nQ1f0b4BHj4CyqhDI4cs23MBFkxo2uVoiTVtH6FtwHZGqCtvQuOrQFK3Ur1ar/QA4GKKhqQioVxA5cEMfDgHNZhOaYcDm2jRMGKIQqgpDFKh81qBy/4yGLIodYEj9Pv7RRyb0WlpGe2UVBfVLO0tI0h5CviORkSjEJH4CnKQsqQbSLEKWxUw5ghu1yDSG38qgN5m+SwtZTgmiKMpTvAhYk2SEFLvdySl4QrtkiBJaKOYzgRsNieykMTMCvcmwWq3B8xykaYQ4jqlljBZfCghoUUODWmoshErdplk+ryEB67KCdtpCErr0l1u2UhwGyFsxmXtIInYQLaIZ1uuA31Ju0FOsMq1iO7SLJViZaDBNRQCUKcplKK+mPBoRcMBBIMFPCvR6PSwv99Bpt5EmKTLqaJrmT8WYgL6sYa0OyxEMffi+TxM7NLTN1jKfiiDLj3Z5tM6rKddltaxou9tG0emW7CIWpjR106aZda4mdMpgsn9FkV5gOBoz/O1XtllMqxRYXelxAGRIWAzBVgBalslpQ10ta7x/lOHlopChx3SFbbyAQ4CFEex0pVH2q8QBXKfOYpVfS3n0yLBGDb0gQZK3WZQlZBxbYRjRLiEM04bteqULPIYYqm9qWK1WYdj8iC2XM92s1YLTtJiawQ9VqFMTWuzfLkqDRWER8iJFnGRkFzL8kpXD3rY5TA2bGvIHBnt70jEvpiwYhmGGVr5UTvB+bxmZOFOYqksw0TkuwQVLwfBdPjRtDljfIzA/pgdFygJAFGJ6ZE3iHT7kIcWUi4KTJhQjntOGFW+WOirv65TRaMqHPKjCtI0Vtl9BY/tMVwyHpvV9670xbUbludzgkRim1JBRZAk6SQyPKQt2phhdmvZsTJ/LJaA46NscBL/MzPJDB7rplC+q/Pscbwdzc3NlTG4OP4a4PczMzMCm5gcHB+OryNbWFjY+fcLfG39hY2MD6+vr+JMhnt8bm5ubODs7Q+Xm5gZXV1c4Pz/HyclJGeKOImKyfysE0OXlZXlZ+g+7VnTCowp8MAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/d3365c149e4465d2406b9c90419fcd14/8ac56/daefec0b6c5a30c9490eb453411410fd12078795.webp 240w,
/static/d3365c149e4465d2406b9c90419fcd14/d3be9/daefec0b6c5a30c9490eb453411410fd12078795.webp 480w,
/static/d3365c149e4465d2406b9c90419fcd14/e46b2/daefec0b6c5a30c9490eb453411410fd12078795.webp 960w,
/static/d3365c149e4465d2406b9c90419fcd14/f992d/daefec0b6c5a30c9490eb453411410fd12078795.webp 1440w,
/static/d3365c149e4465d2406b9c90419fcd14/0ace6/daefec0b6c5a30c9490eb453411410fd12078795.webp 1606w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/d3365c149e4465d2406b9c90419fcd14/8ff5a/daefec0b6c5a30c9490eb453411410fd12078795.png 240w,
/static/d3365c149e4465d2406b9c90419fcd14/e85cb/daefec0b6c5a30c9490eb453411410fd12078795.png 480w,
/static/d3365c149e4465d2406b9c90419fcd14/d9199/daefec0b6c5a30c9490eb453411410fd12078795.png 960w,
/static/d3365c149e4465d2406b9c90419fcd14/07a9c/daefec0b6c5a30c9490eb453411410fd12078795.png 1440w,
/static/d3365c149e4465d2406b9c90419fcd14/5f78c/daefec0b6c5a30c9490eb453411410fd12078795.png 1606w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/d3365c149e4465d2406b9c90419fcd14/d9199/daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
            alt=&quot;daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
            title=&quot;daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;是最重要的一個抽象，因爲它鏈接了所有其他的接口，並且畢竟整個實驗的邏輯都寫在這裏面了。最重要的是，這個抽象並不強迫你按照Catalyst庫中預設的實驗邏輯來部署。它提供了一個靈活的方式來決定你要從這個框架的high-level API當中自定義到哪個程度。&lt;/p&gt;
&lt;p&gt;我們提供了幾個例子，供大家參考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;利用&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt;定義一切：&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;ML - 多分類任務&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;利用Catalyst的循環裝飾器自定義推理與反向傳播：&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;自定義&lt;/a&gt;&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;- PyTorch for循環解構&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;對不同方法的融合：&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;CV - MNIST GAN&lt;/a&gt; / &lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;CV - MNIST VAE&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另外指的一提的是，Runner的結構並不依賴於PyTorch，我們也提供了如何兼容Tensorflow2和JAX的一些思路。&lt;/p&gt;
&lt;p&gt;支持的&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;都列在文檔中Runner API一章的下面了。&lt;/p&gt;
&lt;h2 id=&quot;engine-推理引擎抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#engine-%E6%8E%A8%E7%90%86%E5%BC%95%E6%93%8E%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;engine 推理引擎抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt; 推理引擎抽象&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt; 推理抽象是 Runner 的主要組成部分。這個部分定義了硬件之間的通訊邏輯。例如分佈式訓練和混合精度訓練之類的訓練方法也是在這裏進行定義的。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/5f78c/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 143.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsSAAALEgHS3X78AAAD3ElEQVRIx51WS1IbSxDUDWxAws/MjObf0z0/CWz0dCM4A1vOAIR3LO1bQLBEsCEgYAnBApasgFU6q2fgyVjwsBcZPSOms7Oqsqrp3N3d4eHhAY/Ew/29ff4bPD4+Qrg6Nzc3+P79B7Z2drDz7Ru2t7f/GFtbW9jd3cX19TU6Z2dn+DoaY2HJgZOE+PTPZ/QWF9Ht9bDQ7T6jS/T420ss8tv5+XlEUYTJZILO8fExxuN/4fUDrC4PMaxr5LmGyRTyNIFRKYosRZbECAIfvv8rgiCA53nck+Pg4ACdyeEhRqMRXNdDoQ3iKEQcxwjDkAgQ2E2yuY9+fzYcx4HWGvv7+ySctIRUuFyXVFig4GmaqpI4QsYD0hYJIQSi6CVhlmXY29tD5/BJoedjWJUo88yepk0OQ2JTVPaAXGc2DdNET8QzCR3HxXJZIUtjKOYuY+40P0qS1OZRcigQApdE0ypnK/RDVKVBWTbqsrxARqVFUSCV3PKQwnBlXgX+/yqkbWpT8GPJVYSIq0BRVcpcSrF0KiojKL5Lsd4klKJUhWFRclRV3qgUq3Cj67p2s6ziBsGrIYttVker/KiPQVFCq5jJp//4geQzbJW8hpmEotDzA3wZlrRO3qgsS+SsqtjFSKgMU1OxhCu/ybMgpLGffPgih0vcmKHfnixJ99uQ7LPfwBp9CtItr1ZZTP1luUZB+xiGX1Y1qsEQVT3gBg2lcx7mvh3ydJVLboijwFZaQrFtGDYdYt9pl/d3ChWuDCuqNKxySTUGOVWKurzkwBA/ZgZ+GL2TkFUeshBGJU0fJwnStOkWWVWq7NDwg3DmcPitytLLX4c1avay+FE+kB62fcyuMayiIrEodJ2l1pPuW8b2ScTNRsEY9rCiMhaiQWZTIM+JIvgsEcRx0hCS+Hfb0P0rlXiPPasVJ3BsFYkXZdJUuWEva0sUUKUMVrGRRzKxnFUo8/CZkCGX3GR0apEq1ahk5WWNOHUi+jRmLhMWR96T9m/9kJ3FVp2hsGpySIiaXOZi1jyLWilOJNOcoQYcILKGjESuD800/FqUdmKXRYaaY0wxX1qKQcRst4TvQRy1ZAlDdWy4YqHnkPf2/yMUhQN6zdAyOXOYJqJI2Zw190uEvm01mtsPZt4pjUJefePxmHmIMVoZYnWl4jpAPRhgQCjdXAkJB4E/3ccsyhOEVG49e0kdHR2xGyp8/PABvuNhkXftJ4uuXXtyLy8s2Ht5FuRunpubs6SW8OLiApubm1hfX8fa2toU2nf+vv4ObGxs4OTkBJ3b21tcXV1BiOW/iNPT0z/G+fk5Li8vIf/W/ATnOR6ALPbzDwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/8ac56/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 240w,
/static/a7fab129f6c6739e597e80c8d46c6f21/d3be9/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 480w,
/static/a7fab129f6c6739e597e80c8d46c6f21/e46b2/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 960w,
/static/a7fab129f6c6739e597e80c8d46c6f21/f992d/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 1440w,
/static/a7fab129f6c6739e597e80c8d46c6f21/0ace6/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 1606w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/8ff5a/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 240w,
/static/a7fab129f6c6739e597e80c8d46c6f21/e85cb/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 480w,
/static/a7fab129f6c6739e597e80c8d46c6f21/d9199/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 960w,
/static/a7fab129f6c6739e597e80c8d46c6f21/07a9c/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 1440w,
/static/a7fab129f6c6739e597e80c8d46c6f21/5f78c/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 1606w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/d9199/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
            alt=&quot;76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
            title=&quot;76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;得益於Engine的這個抽象，我們可以直接將模型訓練的Pipeline在不同的硬件平臺上進行部署。比如說PyTorch的DDP分佈式、Apex混合精度、AMP混合精度等訓練方法。也可以在例如DeepSpeed、Horovod以及TPU等平臺上進行訓練。&lt;/p&gt;
&lt;p&gt;可以在文檔中Engine API章節下面看到各&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt;的開發進展。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;callback-回調函數抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#callback-%E5%9B%9E%E8%AA%BF%E5%87%BD%E6%95%B8%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;callback 回調函數抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt; 回調函數抽象&lt;/h2&gt;
&lt;p&gt;Callback 是一個定義Pipeline邏輯的地方。上面提到過，我們可以利用Catalyst作爲一個For循環的裝飾器來實現任何原生的PyTorch功能。但有了Callback之後，我們在利用例如數據增強、複雜損失函數計算等方法的時候就更加容易了。在下面的例子當中，定義所需要的誤差度量函數就變得非常簡便：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/61941d3c0be04cc29e9cfa0d784d8a29&quot;&gt;ML - 多分類任務&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;ML – 推薦系統&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Callback API在train循環當中不斷運行如下這些小的函數：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fe3d1024880194cf0c148a894aa3651b/7e21b/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 95.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACkElEQVQ4y5WUO0/cQBSFt6VBArz2bszanvfY+0S00AA/hodokJaNkoYuiSj5TVCFjodACAmogAYa2O7kzjiQLRIFF0dT7M7nc86dmdrz8zPG41e8vpJeXsq1osbjsV+fnp5Qu7m5wbfvPzAcfcbo6xcMd3cxHA7/ql0n+n1So9EIOzs7ODg4wP39PWrHxz9hiw5mogZinqIZNxGFdYRRhCCMUCdF9QAhKahHmJsLMDs7Q5r1CoIAU1NTWF5extXVFWpHR0cYLAzAucJiv49223rZdhvaFrB5jsIoGK0hdA7GBbIsexfnHM1mE2trazg9PUXt8PAQPQIlGUev04YxEpI2c6nAlYYRDJIzZFIjzRharXkkSfKuNE0RhiFWVlZwcnLyB5gygYV+D9ZKcmbJjSGRUymgBCe4of9wArY+BkzSDJ0ih9YCUkpwobxL504yikdR3UcrABm6rjcCKlXCOMXU5E4RlAmJrAowdR12O7DUoTYUVxkf20juIzNZMbL7+kLPdUgxXX8mp+iKOuQQNElGH0hoc8XIhQcqN2XnkLp0kYWPrH3PlYCdovAdCuqQuQ6F8P1xRseGhlTJoeuw320jzzUUdSgpshtO7iL7Y2OrAwfdLgxFFqqMLMmhO9iMl0NJCPYGfFv/47CDotB03QyUzf2UFfVonEM6NoyO0STsn8DBYED3kv8+hzQITZMml86ppJuiPVDQYJQHTIpRv41GA6urqyXQPQ6WrlrUjGEJxOnFadE057PyzPFWjDiO8SlhiOgFcm4m5WDT09NYWloqH4ezszPs7e1ha3MT21vbWF9fx8bGxoe1Sfvcur+/j+vra9QeHh5we3uLi4sLOPj5+XllXV5e4u7uDo+Pj/gFf8TZUtRHbgoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/fe3d1024880194cf0c148a894aa3651b/8ac56/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 240w,
/static/fe3d1024880194cf0c148a894aa3651b/d3be9/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 480w,
/static/fe3d1024880194cf0c148a894aa3651b/e46b2/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 960w,
/static/fe3d1024880194cf0c148a894aa3651b/f992d/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 1440w,
/static/fe3d1024880194cf0c148a894aa3651b/4dd3a/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 1626w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/fe3d1024880194cf0c148a894aa3651b/8ff5a/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 240w,
/static/fe3d1024880194cf0c148a894aa3651b/e85cb/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 480w,
/static/fe3d1024880194cf0c148a894aa3651b/d9199/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 960w,
/static/fe3d1024880194cf0c148a894aa3651b/07a9c/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 1440w,
/static/fe3d1024880194cf0c148a894aa3651b/7e21b/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 1626w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/fe3d1024880194cf0c148a894aa3651b/d9199/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
            alt=&quot;d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
            title=&quot;d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;你可以在文檔當中Callback API章節下面找到所有支持的回調函數。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;metric-度量抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#metric-%E5%BA%A6%E9%87%8F%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;metric 度量抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt; 度量抽象&lt;/h2&gt;
&lt;p&gt;除了對訓練邏輯和方法等可復用內容的抽象，Catalyst也提供了在實驗中可以幫助誤差計算的&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt;抽象。它的API非常簡單：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3960ba562733b9a50d006dc2fd447725/dca52/f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAC50lEQVQ4y5VUy07bQBTNng2VQh5OHL8942cch4QSNggQfwRJ/oAmQa3EhmVbic9BbBCJBBILWCDYsAJ2p3fGhGcp6eLoeq49x+fOuXNzt7e3uL+/l7i7u5OYrmfFw8ODjIIrd3V1hZ+/fmMw2sXujx/4ThgOhxgMvmE4GDximEXKv8VoNMLOzg4ODg5wc3OD3GQ8xtLXDr6UFKiWDtM0USorKCoVFCkWiiUsFAsyFgoF5PP5VxC5ubk5rK2t4fz8HLmjoyOsrHRQUTV4QYS0maKeNlFvtpAsttFotRE26rCZB8O0oGkadF1/gmEYKJVK2NzcxMnJCXKHh4dYXl6WhPU4RBzH8DwfjPswtBosQ4dNmyydiGhdq72G+IFQubGxgePj42fCMpUXewEcy4RtGgSTCDWYpEKSUk6ndbWqQlVVSSbilHB9ff01YaWmI01CRHEEzw/h+wGiJAX3PIS+B4sIBbHAlOylwneECpmQBCG4Y0uVzKZoW/LZpejaImdJpTMRVklhox4iCJgEo3N0BbgHHsZwXAbOGNQXZP8sWSmXsRQHqHsuEp8h5i4aPkfiMaQBR8QcuKRW+8CUvxAq8F3+zsVsU6amUq3+nymLDerDNIFPpcaBLxUJE4TTDp2dWIszNSn36RmWqeSIZyRZ2xhPLWQ+ts0Uhj4DoVAYxz61jEuN7YIFAUybzo2M0Mhxg1MkoiqVPVPJQmEr8qQJAsKUZuhJMzKTHHiOJSuYEn5iShkh4/K6Ceg1VcIQoGs3VfSS7MOr1+l0ZB+GVKbLORy6glw0Od0YJkBliyHwlmg6KIrF4jOhmDatVgv5hQI5G8JiAcKkiVa7DZ8aOmosopmmsCyLFNN00QxJJEjElFEUBfPz81hdXcWYRmHu7OwMe3t76HW76BK2t7tPz1tbW7TeRq/XQ7/fR7/XzyJB5LuP34n3+/v72Ty8vr7GxcUFTk9PMZlMPoT4u4yT8bt3QtTl5aWc2H8A3KEIzCwkjTgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/3960ba562733b9a50d006dc2fd447725/8ac56/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 240w,
/static/3960ba562733b9a50d006dc2fd447725/d3be9/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 480w,
/static/3960ba562733b9a50d006dc2fd447725/e46b2/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 960w,
/static/3960ba562733b9a50d006dc2fd447725/f992d/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 1440w,
/static/3960ba562733b9a50d006dc2fd447725/eb054/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 1550w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/3960ba562733b9a50d006dc2fd447725/8ff5a/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 240w,
/static/3960ba562733b9a50d006dc2fd447725/e85cb/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 480w,
/static/3960ba562733b9a50d006dc2fd447725/d9199/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 960w,
/static/3960ba562733b9a50d006dc2fd447725/07a9c/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 1440w,
/static/3960ba562733b9a50d006dc2fd447725/dca52/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 1550w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/3960ba562733b9a50d006dc2fd447725/d9199/f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
            alt=&quot;f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
            title=&quot;f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;你可以在文檔中Metric API章節下面找到所有支持的&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt;方法。&lt;/p&gt;
&lt;p&gt;Catalyst的Metric API中所有的誤差函數都支持更新和計算key-value形式的誤差結果。這種形式在訓練過程中會讓各種Loss的含義表達非常明確，並且也提供了一種可以存儲你想在日誌當中記錄任意數量Loss或者狀態值的規則。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;logger-日誌抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#logger-%E6%97%A5%E8%AA%8C%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;logger 日誌抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Logger&lt;/code&gt; 日誌抽象&lt;/h2&gt;
&lt;p&gt;最後，日誌系統。在Catalyst 21版本的Release當中，我們把各種監控系統的API整合到了一個類當中。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ac03af545f3101b796b2f294ec4799e/71c1d/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACKklEQVQ4y52TSW4aQRiF+wJBCmDopqGbnukB2sTJJVDAvgxDFmbacARW8Y7bIFgiMWwYhAQskGLYvvxVxHESOUjJ4qmquur/6lXVa+F4POJ0OuFMev72zPv/qvP5zMVYwuFwwNenJ1TrDXxpPqLeaKBWraJWq/1U/VfV668tqUHrq7S+1+thu91CWK1W+Fyu4N37G2QsHWlFhihJSEoyKQWJ+glRxI0kIpFMIpFI0DiFeDyOWCzG20gkAsdxMJlMIMxmMzw83BMkhbtCAZ9uA4R5H4Hv45bGd4UAlm0haxrQmXQduuUgq2nIZrPQqJVlGcViEaPRCMJ0OkWlUkZSlODmXNrJgm6Y0HQDKi3WTAuGYcC2LF6sEiRLc4qiIpPJQFVVfooCbT4cDl+BCQKGQYCP5DDve/BcF4HnwPd8mASzbRs6c8U3saGo14DlC5BBHNuEYZrcpWE75E7nRRdnJodk0mneKopyHcgdhnR3dIdhPkBA48BzEZLTHDnUDItDXnTVIXvRAgF814GTy8E0L3eZ/uHmT2fXHVYqFAkRgeshT24ccuM5NkHN3xy9pTeB9wSU5AzFJI8P7FFokj2G5bhUcCn6m1h0WGzCMLwA5/M5SqUSD6etUVxUOhotUNMyUizgFOZrEin00WgUObqm8XgMYblcYjAYoNvtotVq47HZRPNFrRZ9u652u41Op4N+vw/2kwj7/R6bzQaLxQLs+P8jdsr1eo3dbofvqalAfFt6XmcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/2ac03af545f3101b796b2f294ec4799e/8ac56/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 240w,
/static/2ac03af545f3101b796b2f294ec4799e/d3be9/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 480w,
/static/2ac03af545f3101b796b2f294ec4799e/e46b2/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 960w,
/static/2ac03af545f3101b796b2f294ec4799e/f992d/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 1440w,
/static/2ac03af545f3101b796b2f294ec4799e/0abaa/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 1536w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/2ac03af545f3101b796b2f294ec4799e/8ff5a/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 240w,
/static/2ac03af545f3101b796b2f294ec4799e/e85cb/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 480w,
/static/2ac03af545f3101b796b2f294ec4799e/d9199/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 960w,
/static/2ac03af545f3101b796b2f294ec4799e/07a9c/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 1440w,
/static/2ac03af545f3101b796b2f294ec4799e/71c1d/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 1536w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/2ac03af545f3101b796b2f294ec4799e/d9199/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
            alt=&quot;4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
            title=&quot;4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在這樣一個簡單的API下，我們已經提供了對MLFlow以及Tensorboard的整合。例如Neptune和WandB這種高級的Logger，我們團隊也正在開發當中。&lt;/p&gt;
&lt;p&gt;所有當下支持的&lt;code class=&quot;language-text&quot;&gt;Logger&lt;/code&gt;可以在文檔當中Logger API章節下找到。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apple語境中x86_64/arm64以及Universal的ncnn編譯]]></title><description><![CDATA[macOS上对App的编译自从Xcode 12以来就默认要求Universal了。但是我在使用ncnn的时候发现了一些可能会出错的前置库架构，所以根据ncnn的Github Workflow改了一下编译流程，在此记录。]]></description><link>https://lumen.netlify.com/posts/4031fd98-7051-4445-83b1-2198d453891b</link><guid isPermaLink="false">https://lumen.netlify.com/posts/4031fd98-7051-4445-83b1-2198d453891b</guid><pubDate>Sun, 30 May 2021 09:07:00 GMT</pubDate><content:encoded>&lt;p&gt;自從Apple Silicon的M1芯片搭載到新型Mac電腦上以來，我們在基於Intel的Mac上面所編譯的程序則需要通過Rosetta工具來轉譯實現在Apple Silicon平臺上的運行。Xcode自從12版本以來，從底層的工具鏈到macOS應用的默認架構，都顯示出對Apple Silicion + Intel多架構編譯的友好支持。爲了避免轉譯造成的兼容性以及性能的影響，我們要更多的讓應用本地運行，而非依賴轉譯。而一個通用的二進制包含了在ARM（Apple Silicon）和x86_64（Intel）上都可本地運行的可執行代碼。&lt;/p&gt;
&lt;p&gt;這裏記錄的是對於深度學習庫&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的編譯。包括了單獨編譯可本地運行的x86&lt;em&gt;64、arm64以及Universal（x86&lt;/em&gt;64 + arm64）版本的三種不同的庫。當然，如果只需要某一種編譯的話，可以直接編譯相應版本。&lt;/p&gt;
&lt;p&gt;最後的Universal部分有可直接編譯的方法，大家可以根據自己需求進行編譯。&lt;/p&gt;
&lt;p&gt;這個編譯過程是根據ncnn的Github CI流程來實現的。其中聲明了幾個CI風格的環境變量，但並沒有更改變量名稱。編譯後期需要注意區分其含義。&lt;/p&gt;
&lt;p&gt;在這一切之前，相對推薦將代碼庫切換至本文所寫時的版本。&lt;/p&gt;
&lt;p&gt;可以通過在&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;代碼庫下使用下述指令來實現：&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git checkout 20210507&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;adding-openmp-and-vulkan-to-workspace&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#adding-openmp-and-vulkan-to-workspace&quot; aria-label=&quot;adding openmp and vulkan to workspace permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Adding &lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt; to workspace&lt;/h2&gt;
&lt;p&gt;這裏寫明了編譯安裝OpenMP以及下載VulkanSDK的過程。注意，請修改&lt;code class=&quot;language-text&quot;&gt;GITHUB_WORKSPACE&lt;/code&gt;指向你的工作路徑。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GITHUB_WORKSPACE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your_workspace&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DEVELOPER_DIR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/Applications/Xcode.app/Contents/Developer/

&lt;span class=&quot;token comment&quot;&gt;# openmp&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://github.com/llvm/llvm-project/releases/download/llvmorg-11.0.0/openmp-11.0.0.src.tar.xz
&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -xf openmp-11.0.0.src.tar.xz
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; openmp-11.0.0.src
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;/.size __kmp_unnamed_critical_addr/d&apos;&lt;/span&gt; runtime/src/z_Linux_asm.S
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;s/__kmp_unnamed_critical_addr/___kmp_unnamed_critical_addr/g&apos;&lt;/span&gt; runtime/src/z_Linux_asm.S
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p build &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build
cmake -DCMAKE_BUILD_TYPE&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Release -DCMAKE_INSTALL_PREFIX&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;install -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;x86_64;arm64&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DLIBOMP_ENABLE_SHARED&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DLIBOMP_OMPT_SUPPORT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DLIBOMP_USE_HWLOC&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -r install/* &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install

&lt;span class=&quot;token comment&quot;&gt;# install openmp&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install/include/* &lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install/lib/libomp.a &lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib

&lt;span class=&quot;token comment&quot;&gt;# vulkansdk&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# change dir to a more accurate path.&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://sdk.lunarg.com/sdk/download/1.2.162.0/mac/vulkansdk-macos-1.2.162.0.dmg?Human&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true -O vulkansdk-macos-1.2.162.0.dmg
hdiutil attach vulkansdk-macos-1.2.162.0.dmg
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -r /Volumes/vulkansdk-macos-1.2.162.0 &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf vulkansdk-macos-1.2.162.0/Applications
&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; vulkansdk-macos-1.2.162.0 -type f &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; -v -E &lt;span class=&quot;token string&quot;&gt;&apos;vulkan|glslang|MoltenVK&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt;
hdiutil detach /Volumes/vulkansdk-macos-1.2.162.0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;macos-on-apple-silicon-with-vulkan&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#macos-on-apple-silicon-with-vulkan&quot; aria-label=&quot;macos on apple silicon with vulkan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;macOS on &lt;em&gt;Apple Silicon&lt;/em&gt; with &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;這裏寫明了對搭載了Apple M1處理器的Mac計算機，並且開啓Vulkan支持，繼而進行編譯ncnn的過程。&lt;/p&gt;
&lt;p&gt;這部分內容參考的是如下CI所用的yaml文件：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Tencent/ncnn/blob/master/.github/workflows/macos-arm64-gpu.yml&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Tencent/ncnn&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;building-ncnn&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#building-ncnn&quot; aria-label=&quot;building ncnn permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Building &lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這裏說明了在部署好&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;之後，對&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的編譯過程。請將&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的源碼放置在&lt;code class=&quot;language-text&quot;&gt;$GITHUB_WORKSPACE&lt;/code&gt;目錄下（當然，如果不的話也可以，修改相應路徑指向即可）。&lt;/p&gt;
&lt;h3 id=&quot;build-the-static-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-static-library&quot; aria-label=&quot;build the static library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the static library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p build-silicon &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-silicon  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;build&quot; to &quot;build-silicon&quot;&lt;/span&gt;
cmake -DCMAKE_CROSSCOMPILING&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DCMAKE_SYSTEM_PROCESSOR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_INCLUDE_DIR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/include &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/dylib/macOS/libMoltenVK.dylib &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TOOLS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_BUILD_EXAMPLES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;build-the-shared-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-shared-library&quot; aria-label=&quot;build the shared library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the shared library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon-shared&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; build-silicon-shared &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-silicon-shared  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;build-shared&quot; to &quot;build-silicon-shared&quot;&lt;/span&gt;
cmake -DCMAKE_CROSSCOMPILING&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DCMAKE_SYSTEM_PROCESSOR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_INCLUDE_DIR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/include &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/dylib/macOS/libMoltenVK.dylib &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TOOLS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_BUILD_EXAMPLES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_SHARED_LIB&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_ENABLE_LTO&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;macos-on-intel-with-vulkan&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#macos-on-intel-with-vulkan&quot; aria-label=&quot;macos on intel with vulkan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;macOS on &lt;em&gt;Intel&lt;/em&gt; with &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;這裏寫明了對搭載了Intel處理器的Mac計算機，並且開啓Vulkan支持，繼而進行編譯ncnn的過程。&lt;/p&gt;
&lt;p&gt;這部分內容參考的是如下CI所用的yaml文件：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Tencent/ncnn/blob/master/.github/workflows/macos-x64-gpu.yml&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Tencent/ncnn&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;build-the-static-library-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-static-library-1&quot; aria-label=&quot;build the static library 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the static library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; build-intel &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-intel
cmake -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TESTS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;brew-install-protobuf-opencv3&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#brew-install-protobuf-opencv3&quot; aria-label=&quot;brew install protobuf opencv3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Brew install &lt;code class=&quot;language-text&quot;&gt;protobuf&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;OpenCV@3&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這是和 &lt;strong&gt;arm64&lt;/strong&gt; 架構編譯不同的地方。我們需要利用&lt;code class=&quot;language-text&quot;&gt;brew&lt;/code&gt;安裝Protocol Buffer和OpenCV 3。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GITHUB_WORKSPACE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your_workspace&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DEVELOPER_DIR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/Applications/Xcode.app/Contents/Developer/

&lt;span class=&quot;token comment&quot;&gt;# install protobuf and opencv@3&lt;/span&gt;
brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; protobuf opencv3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;adding-openmp-and-vulkan-to-workspace-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#adding-openmp-and-vulkan-to-workspace-1&quot; aria-label=&quot;adding openmp and vulkan to workspace 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Adding &lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt; to workspace&lt;/h2&gt;
&lt;p&gt;這個部分與上文提到的arm64編譯當中的 &lt;a href=&quot;/4031fd987051444583b12198d453891b&quot;&gt;這一步&lt;/a&gt; 相同，如果是從上面操作下來的話，可以利用之前的安裝。&lt;/p&gt;
&lt;h2 id=&quot;building-ncnn-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#building-ncnn-1&quot; aria-label=&quot;building ncnn 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Building &lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這裏說明了在部署好&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;之後，對&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的編譯過程。請將&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的源碼放置在&lt;code class=&quot;language-text&quot;&gt;$GITHUB_WORKSPACE&lt;/code&gt;目錄下（當然，如果不的話也可以，修改相應路徑指向即可）。&lt;/p&gt;
&lt;h3 id=&quot;test-the-built-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#test-the-built-library&quot; aria-label=&quot;test the built library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Test the built library&lt;/h3&gt;
&lt;p&gt;這裏，按照CI的流程，可以選擇性測試一下所編譯的庫是否可用以及結果是否準確。需要安裝一個VulkanSDK的高級接口&lt;code class=&quot;language-text&quot;&gt;github:google/swiftbuffer&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# install google/swiftshader&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/google/swiftshader.git
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; swiftshader
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; submodule update --init --recursive
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p build&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build
cmake -DCMAKE_INSTALL_PREFIX&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;install -DSWIFTSHADER_BUILD_EGL&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
		  -DSWIFTSHADER_BUILD_GLESv2&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE -DSWIFTSHADER_BUILD_GLES_CM&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DSWIFTSHADER_BUILD_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TRUE -DSWIFTSHADER_BUILD_PVR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DSWIFTSHADER_BUILD_TESTS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE -DSWIFTSHADER_ENABLE_ASTC&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DSWIFTSHADER_WARNINGS_AS_ERRORS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE -DREACTOR_BACKEND&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Subzero &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DREACTOR_DEFAULT_OPT_LEVEL&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Default -DCMAKE_BUILD_TYPE&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Release &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/swiftshader-install
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; Darwin/* &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/swiftshader-install

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DYLD_LIBRARY_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS/lib&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$DYLD_LIBRARY_PATH&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VK_ICD_FILENAMES&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/swiftshader-install/vk_swiftshader_icd.json&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ctest --output-on-failure -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;build-the-shared-library-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-shared-library-1&quot; aria-label=&quot;build the shared library 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the shared library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon-shared&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; build-intel-shared &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-intel-shared
cmake -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_SHARED_LIB&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_ENABLE_LTO&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;build-as-an-universal-app-with-vulkan&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-as-an-universal-app-with-vulkan&quot; aria-label=&quot;build as an universal app with vulkan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build as an Universal app with &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;這裏說明了對Universal應用進行編譯的兩種方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通過&lt;code class=&quot;language-text&quot;&gt;lipo&lt;/code&gt;工具對不同架構下的可執行代碼進行融合；&lt;/li&gt;
&lt;li&gt;利用&lt;code class=&quot;language-text&quot;&gt;cmake&lt;/code&gt;生成可以自動化對兩種架構的可執行代碼融合的makefile；&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;use-lipo-to-fuse-different-libraries&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#use-lipo-to-fuse-different-libraries&quot; aria-label=&quot;use lipo to fuse different libraries permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Use &lt;code class=&quot;language-text&quot;&gt;lipo&lt;/code&gt; to fuse different libraries&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/lib
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/include

&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel/install/lib/*.a &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; -L &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;basename&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; -L &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; -I % &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;lipo -create &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel/install/lib/% \
    &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-silicon/install/lib/% \
    -o &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/lib/%&apos;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -r &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel/install/include/* &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/include/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;use-cmake-to-compile-a-universal-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#use-cmake-to-compile-a-universal-library&quot; aria-label=&quot;use cmake to compile a universal library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Use &lt;code class=&quot;language-text&quot;&gt;cmake&lt;/code&gt; to compile a Universal library&lt;/h2&gt;
&lt;h3 id=&quot;brew-install-protobuf-opencv3-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#brew-install-protobuf-opencv3-1&quot; aria-label=&quot;brew install protobuf opencv3 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Brew install &lt;code class=&quot;language-text&quot;&gt;protobuf&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;OpenCV@3&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;這個部分與上文提到的Intel編譯當中的 &lt;a href=&quot;/4031fd987051444583b12198d453891b&quot;&gt;這一步&lt;/a&gt; 相同，如果是從上面操作下來的話，可以利用之前的安裝。&lt;/p&gt;
&lt;h3 id=&quot;adding-openmp-and-vulkan-to-workspace-2&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#adding-openmp-and-vulkan-to-workspace-2&quot; aria-label=&quot;adding openmp and vulkan to workspace 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Adding &lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt; to workspace&lt;/h3&gt;
&lt;p&gt;這個部分與上文提到的arm64編譯當中的 &lt;a href=&quot;/4031fd987051444583b12198d453891b&quot;&gt;這一步&lt;/a&gt; 相同，如果是從上面操作下來的話，可以利用之前的安裝。&lt;/p&gt;
&lt;h3 id=&quot;compile-a-universal-library-directly&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#compile-a-universal-library-directly&quot; aria-label=&quot;compile a universal library directly permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Compile a Universal library directly&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
cmake -DCMAKE_CROSSCOMPILING&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DCMAKE_SYSTEM_PROCESSOR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;x86_64;arm64&quot;&lt;/span&gt; -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;x86_64;arm64&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_INCLUDE_DIR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/VulkanSDK/1.2.176.1/macOS/include &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/VulkanSDK/1.2.176.1/macOS/lib/libMoltenVK.dylib &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TOOLS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_BUILD_EXAMPLES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>