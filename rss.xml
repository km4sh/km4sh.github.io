<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Blog by er1yaaruma]]></title><description><![CDATA[Pellentesque odio nisi, euismod in, pharetra a, ultricies in, diam. Sed arcu.]]></description><link>https://lumen.netlify.com</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 31 May 2021 00:48:58 GMT</lastBuildDate><item><title><![CDATA[Catalyst：基於PyTorch的深度學習研發催化劑]]></title><description><![CDATA[翻译了一篇Scitator的博客。他是Catalyst团队Lead，开发了Catalyst这个基于PyTorch的深度学习研发框架。这篇文章简单介绍了这个框架的一些概念和思路。个人认为十分容易上手。]]></description><link>https://lumen.netlify.com/posts/61941d3c-0be0-4cc2-9e9c-fa0d784d8a29</link><guid isPermaLink="false">https://lumen.netlify.com/posts/61941d3c-0be0-4cc2-9e9c-fa0d784d8a29</guid><pubDate>Sun, 30 May 2021 09:12:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;譯者按&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;我平時在訓練神經網絡的時候，幾乎每次都要重新寫很多內容。倒也不是不能在之前的腳本上面改，主要是覺得改起來不如寫起來方便，況且不同的實驗也或多或少有不一樣的地方；就算改，每次或多或少都會遇到些問題，例如在某個不知名的角落裏寫死了一個變量。
一直都有個想寫個兼容各種實驗的代碼庫的想法，但是後來發現工作量不小，遂作罷。最近在網絡上發現了Catalyst這個庫，簡單看了下內容，發現與我之前的代碼庫思路比較一致，很多地方幫助我們造好了不錯的輪子。現在把前一段時間這個項目作者Lead寫在medium上面的一篇博客翻譯給大家，希望能幫助到有需要的人。&lt;/p&gt;
&lt;!--TOC--&gt;
&lt;blockquote&gt;
&lt;p&gt;Sergey Kolesnikov &lt;/p&gt;
&lt;p&gt;km4sh[譯]&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://medium.com/pytorch/catalyst-a-pytorch-framework-for-accelerated-deep-learning-r-d-ad9621e4ca88&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;medium.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在過去的十幾年當中，隨着深度學習的發展，各式各樣相關的開源項目和框架也逐漸被人所熟知。例如PyTorch就可以說是當中最被研究人員青睞的項目之一。得益於符合Python哲學的設計與良好的底層實現，許多研究團隊都選用Pytorch作爲工具。但是，能力愈強，責任愈大，由於涉及很多與底層密切相關的函數，PyTorch的用戶們常常在研究過程中會遇到不少Bug。另外，隨着硬件加速訓練的崛起，一個能夠在不同硬件平臺上適配的簡單API成爲了當下一個迫切的需要。&lt;/p&gt;
&lt;p&gt;最近三年，Catalyst-Team一直在研發Catalyst。這是一個基於PyTorch的深度學習研發框架。這個框架致力於改善實驗的可復現性、開發速度以及代碼重用率，因此，用戶們在設計新的實驗時可以把造輪子的時間用來實現一些新的想法。在Catalyst當中，你可以輕易的實現不同的度量函數、模型存檔、多種多樣的日誌方式以及分佈式訓練，並且可以極大避免翻來覆去都差不多的代碼和根本不知所云的底層Bug。&lt;/p&gt;
&lt;p&gt;在這篇文章當中，我將分享一些我們對於這種高級深度學習框架API的思考，並且利用各種各樣的例子來展示這個項目當前的开发进展。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;deep-learning-recap-深度學習覆盤&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#deep-learning-recap-%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E8%A6%86%E7%9B%A4&quot; aria-label=&quot;deep learning recap 深度學習覆盤 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deep Learning recap 深度學習覆盤&lt;/h1&gt;
&lt;p&gt;在我們開始之前，我們先來看看在我們用隨機梯度下降法訓練深度學習模型的時候，都在做些什麼：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/71c1d/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABI0lEQVQoz53Qz4qCQBwH8HmECArUSFNJVrq4ubkhrCdBD75Rf+gtOncuX6BbLyGoXewSHsSLXb/xG+oQrEvs4TMzDPP7N+x2u4FrHvtD0zRve76v6xrseDxiv9/jcDi8iOP4bfT+dDqhqiow78eDMTag6zoURcFoNOIkSeIGg8GfhsMhut0uoijC9XoFc2YOTOMD89kcX582HMeB67owTZMnfga1oSZ6vR7CMMT5fAazbRuCIGCsjzG1ppg736AinufxxJPJhAfKsvwrKtrv9xEEAdI0BbMsi1cQRIGPqKoqNE3jX0DoLIpiK5qg0+nA933keQ623W6x2WywXq+xWq2wXC6xWCxe0H0biqP43W6HoijAaKFWkyT5tyzLcLlcUJYl7tQQgAZyVHOjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/8ac56/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 240w,
/static/9c3ba3e018c50cd28559cf115880c00d/d3be9/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 480w,
/static/9c3ba3e018c50cd28559cf115880c00d/e46b2/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 960w,
/static/9c3ba3e018c50cd28559cf115880c00d/f992d/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 1440w,
/static/9c3ba3e018c50cd28559cf115880c00d/0abaa/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.webp 1536w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/8ff5a/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 240w,
/static/9c3ba3e018c50cd28559cf115880c00d/e85cb/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 480w,
/static/9c3ba3e018c50cd28559cf115880c00d/d9199/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 960w,
/static/9c3ba3e018c50cd28559cf115880c00d/07a9c/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 1440w,
/static/9c3ba3e018c50cd28559cf115880c00d/71c1d/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png 1536w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/9c3ba3e018c50cd28559cf115880c00d/d9199/cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
            alt=&quot;cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
            title=&quot;cc8aeb8f434ee5cf1ef56b78b659b9b6d4590362.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;當我們開始一個實驗的時候，可能先定義了一些訓練階段、Epoch數以及數據集的處理。在這之後，我們一遍又一遍的把數據採樣成Batch，然後推理，根據誤差函數算出距離，再利用梯度下降進行參數更新。沒錯，就是這麼簡單。但是，隨着項目的發展和更多Tricks的加入，例如加入了更多不同的誤差函數和更新策略，或者我們要在新的硬件加速平臺上進行訓練，代碼和邏輯可能就不如上面這樣直觀了。&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;catalyst&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#catalyst&quot; aria-label=&quot;catalyst permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Catalyst&lt;/h1&gt;
&lt;p&gt;爲了解決上面遇到的這類問題，我們創造了Catalyst，一個致力於改善實驗的可復現性、開發速度以及代碼復用的PyTorch深度學習研發框架。這個框架提供了一些在實驗過程當中實用的抽象概念：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt; 運行抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt; 推理引擎抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt; 回調函數抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt; 度量抽象&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Logger&lt;/code&gt; 日誌抽象&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;runner-運行抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#runner-%E9%81%8B%E8%A1%8C%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;runner 運行抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt; 運行抽象&lt;/h2&gt;
&lt;p&gt;第一個要介紹的抽象就是&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt; ，在這個抽象當中，包含了一切你所需要的實驗邏輯：數據集、模型、每個Batch的預處理以及後處理、誤差函數甚至包括監控系統的指定。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d3365c149e4465d2406b9c90419fcd14/5f78c/daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 155%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsSAAALEgHS3X78AAAEfklEQVRIx5VWy1LjVhT0DwSqeCS2JettvSXrZRuMsYdM5UvCkHwFWz5ggPwAu8mfABsMFCzYwIZiNrCDVaevjBnPDK8sTl3dKqnVp0+fc2/l9vYW9/f3eHh4eFr/T0x/c3d3h8rXrzf48uVffN7ewc7uP9jmur29/RQ7Ozuvxu7ubvne3t4erq+vUbm4uMDq4APmJQmqZ0JW6qhJNdTkKqr1KhYXFrGwsID5+fkyFuYXnvZiXVxcxOzsLIIgwOnpKSrHx8dYW1uDommIWz4jgBeF8HwXURzCtV3ougaNUa7a96HrOmRZRp7nODw8RGU0OsJwOIRqNVF0W2WEeYKwyGHHAfzYQ5GGSGMfnmvBsQy4pgFTN6CrOhqNBur1OpIkwf7+/hhwMBhAcyJ8WOvh97UldPuryPofES/34acpev0h+r0+8ixDt9NBN+8giiIEXoCmaUGqS1OAR2OGkqIiYspR5MILPNh+AJu6GI4NJ0rg8DkIQziuC5/PIWURoL7nQ1f0b4BHj4CyqhDI4cs23MBFkxo2uVoiTVtH6FtwHZGqCtvQuOrQFK3Ur1ar/QA4GKKhqQioVxA5cEMfDgHNZhOaYcDm2jRMGKIQqgpDFKh81qBy/4yGLIodYEj9Pv7RRyb0WlpGe2UVBfVLO0tI0h5CviORkSjEJH4CnKQsqQbSLEKWxUw5ghu1yDSG38qgN5m+SwtZTgmiKMpTvAhYk2SEFLvdySl4QrtkiBJaKOYzgRsNieykMTMCvcmwWq3B8xykaYQ4jqlljBZfCghoUUODWmoshErdplk+ryEB67KCdtpCErr0l1u2UhwGyFsxmXtIInYQLaIZ1uuA31Ju0FOsMq1iO7SLJViZaDBNRQCUKcplKK+mPBoRcMBBIMFPCvR6PSwv99Bpt5EmKTLqaJrmT8WYgL6sYa0OyxEMffi+TxM7NLTN1jKfiiDLj3Z5tM6rKddltaxou9tG0emW7CIWpjR106aZda4mdMpgsn9FkV5gOBoz/O1XtllMqxRYXelxAGRIWAzBVgBalslpQ10ta7x/lOHlopChx3SFbbyAQ4CFEex0pVH2q8QBXKfOYpVfS3n0yLBGDb0gQZK3WZQlZBxbYRjRLiEM04bteqULPIYYqm9qWK1WYdj8iC2XM92s1YLTtJiawQ9VqFMTWuzfLkqDRWER8iJFnGRkFzL8kpXD3rY5TA2bGvIHBnt70jEvpiwYhmGGVr5UTvB+bxmZOFOYqksw0TkuwQVLwfBdPjRtDljfIzA/pgdFygJAFGJ6ZE3iHT7kIcWUi4KTJhQjntOGFW+WOirv65TRaMqHPKjCtI0Vtl9BY/tMVwyHpvV9670xbUbludzgkRim1JBRZAk6SQyPKQt2phhdmvZsTJ/LJaA46NscBL/MzPJDB7rplC+q/Pscbwdzc3NlTG4OP4a4PczMzMCm5gcHB+OryNbWFjY+fcLfG39hY2MD6+vr+JMhnt8bm5ubODs7Q+Xm5gZXV1c4Pz/HyclJGeKOImKyfysE0OXlZXlZ+g+7VnTCowp8MAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/d3365c149e4465d2406b9c90419fcd14/8ac56/daefec0b6c5a30c9490eb453411410fd12078795.webp 240w,
/static/d3365c149e4465d2406b9c90419fcd14/d3be9/daefec0b6c5a30c9490eb453411410fd12078795.webp 480w,
/static/d3365c149e4465d2406b9c90419fcd14/e46b2/daefec0b6c5a30c9490eb453411410fd12078795.webp 960w,
/static/d3365c149e4465d2406b9c90419fcd14/f992d/daefec0b6c5a30c9490eb453411410fd12078795.webp 1440w,
/static/d3365c149e4465d2406b9c90419fcd14/0ace6/daefec0b6c5a30c9490eb453411410fd12078795.webp 1606w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/d3365c149e4465d2406b9c90419fcd14/8ff5a/daefec0b6c5a30c9490eb453411410fd12078795.png 240w,
/static/d3365c149e4465d2406b9c90419fcd14/e85cb/daefec0b6c5a30c9490eb453411410fd12078795.png 480w,
/static/d3365c149e4465d2406b9c90419fcd14/d9199/daefec0b6c5a30c9490eb453411410fd12078795.png 960w,
/static/d3365c149e4465d2406b9c90419fcd14/07a9c/daefec0b6c5a30c9490eb453411410fd12078795.png 1440w,
/static/d3365c149e4465d2406b9c90419fcd14/5f78c/daefec0b6c5a30c9490eb453411410fd12078795.png 1606w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/d3365c149e4465d2406b9c90419fcd14/d9199/daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
            alt=&quot;daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
            title=&quot;daefec0b6c5a30c9490eb453411410fd12078795.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;是最重要的一個抽象，因爲它鏈接了所有其他的接口，並且畢竟整個實驗的邏輯都寫在這裏面了。最重要的是，這個抽象並不強迫你按照Catalyst庫中預設的實驗邏輯來部署。它提供了一個靈活的方式來決定你要從這個框架的high-level API當中自定義到哪個程度。&lt;/p&gt;
&lt;p&gt;我們提供了幾個例子，供大家參考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;利用&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt;定義一切：&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;ML - 多分類任務&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;利用Catalyst的循環裝飾器自定義推理與反向傳播：&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;自定義&lt;/a&gt;&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;- PyTorch for循環解構&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;對不同方法的融合：&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;CV - MNIST GAN&lt;/a&gt; / &lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;CV - MNIST VAE&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另外指的一提的是，Runner的結構並不依賴於PyTorch，我們也提供了如何兼容Tensorflow2和JAX的一些思路。&lt;/p&gt;
&lt;p&gt;支持的&lt;code class=&quot;language-text&quot;&gt;Runner&lt;/code&gt;都列在文檔中Runner API一章的下面了。&lt;/p&gt;
&lt;h2 id=&quot;engine-推理引擎抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#engine-%E6%8E%A8%E7%90%86%E5%BC%95%E6%93%8E%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;engine 推理引擎抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt; 推理引擎抽象&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt; 推理抽象是 Runner 的主要組成部分。這個部分定義了硬件之間的通訊邏輯。例如分佈式訓練和混合精度訓練之類的訓練方法也是在這裏進行定義的。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/5f78c/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 143.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsSAAALEgHS3X78AAAD3ElEQVRIx51WS1IbSxDUDWxAws/MjObf0z0/CWz0dCM4A1vOAIR3LO1bQLBEsCEgYAnBApasgFU6q2fgyVjwsBcZPSOms7Oqsqrp3N3d4eHhAY/Ew/29ff4bPD4+Qrg6Nzc3+P79B7Z2drDz7Ru2t7f/GFtbW9jd3cX19TU6Z2dn+DoaY2HJgZOE+PTPZ/QWF9Ht9bDQ7T6jS/T420ss8tv5+XlEUYTJZILO8fExxuN/4fUDrC4PMaxr5LmGyRTyNIFRKYosRZbECAIfvv8rgiCA53nck+Pg4ACdyeEhRqMRXNdDoQ3iKEQcxwjDkAgQ2E2yuY9+fzYcx4HWGvv7+ySctIRUuFyXVFig4GmaqpI4QsYD0hYJIQSi6CVhlmXY29tD5/BJoedjWJUo88yepk0OQ2JTVPaAXGc2DdNET8QzCR3HxXJZIUtjKOYuY+40P0qS1OZRcigQApdE0ypnK/RDVKVBWTbqsrxARqVFUSCV3PKQwnBlXgX+/yqkbWpT8GPJVYSIq0BRVcpcSrF0KiojKL5Lsd4klKJUhWFRclRV3qgUq3Cj67p2s6ziBsGrIYttVker/KiPQVFCq5jJp//4geQzbJW8hpmEotDzA3wZlrRO3qgsS+SsqtjFSKgMU1OxhCu/ybMgpLGffPgih0vcmKHfnixJ99uQ7LPfwBp9CtItr1ZZTP1luUZB+xiGX1Y1qsEQVT3gBg2lcx7mvh3ydJVLboijwFZaQrFtGDYdYt9pl/d3ChWuDCuqNKxySTUGOVWKurzkwBA/ZgZ+GL2TkFUeshBGJU0fJwnStOkWWVWq7NDwg3DmcPitytLLX4c1avay+FE+kB62fcyuMayiIrEodJ2l1pPuW8b2ScTNRsEY9rCiMhaiQWZTIM+JIvgsEcRx0hCS+Hfb0P0rlXiPPasVJ3BsFYkXZdJUuWEva0sUUKUMVrGRRzKxnFUo8/CZkCGX3GR0apEq1ahk5WWNOHUi+jRmLhMWR96T9m/9kJ3FVp2hsGpySIiaXOZi1jyLWilOJNOcoQYcILKGjESuD800/FqUdmKXRYaaY0wxX1qKQcRst4TvQRy1ZAlDdWy4YqHnkPf2/yMUhQN6zdAyOXOYJqJI2Zw190uEvm01mtsPZt4pjUJefePxmHmIMVoZYnWl4jpAPRhgQCjdXAkJB4E/3ccsyhOEVG49e0kdHR2xGyp8/PABvuNhkXftJ4uuXXtyLy8s2Ht5FuRunpubs6SW8OLiApubm1hfX8fa2toU2nf+vv4ObGxs4OTkBJ3b21tcXV1BiOW/iNPT0z/G+fk5Li8vIf/W/ATnOR6ALPbzDwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/8ac56/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 240w,
/static/a7fab129f6c6739e597e80c8d46c6f21/d3be9/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 480w,
/static/a7fab129f6c6739e597e80c8d46c6f21/e46b2/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 960w,
/static/a7fab129f6c6739e597e80c8d46c6f21/f992d/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 1440w,
/static/a7fab129f6c6739e597e80c8d46c6f21/0ace6/76d6052d7a10b69fea8d7afc907b2b0456f8c787.webp 1606w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/8ff5a/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 240w,
/static/a7fab129f6c6739e597e80c8d46c6f21/e85cb/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 480w,
/static/a7fab129f6c6739e597e80c8d46c6f21/d9199/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 960w,
/static/a7fab129f6c6739e597e80c8d46c6f21/07a9c/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 1440w,
/static/a7fab129f6c6739e597e80c8d46c6f21/5f78c/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png 1606w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/a7fab129f6c6739e597e80c8d46c6f21/d9199/76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
            alt=&quot;76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
            title=&quot;76d6052d7a10b69fea8d7afc907b2b0456f8c787.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;得益於Engine的這個抽象，我們可以直接將模型訓練的Pipeline在不同的硬件平臺上進行部署。比如說PyTorch的DDP分佈式、Apex混合精度、AMP混合精度等訓練方法。也可以在例如DeepSpeed、Horovod以及TPU等平臺上進行訓練。&lt;/p&gt;
&lt;p&gt;可以在文檔中Engine API章節下面看到各&lt;code class=&quot;language-text&quot;&gt;Engine&lt;/code&gt;的開發進展。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;callback-回調函數抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#callback-%E5%9B%9E%E8%AA%BF%E5%87%BD%E6%95%B8%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;callback 回調函數抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Callback&lt;/code&gt; 回調函數抽象&lt;/h2&gt;
&lt;p&gt;Callback 是一個定義Pipeline邏輯的地方。上面提到過，我們可以利用Catalyst作爲一個For循環的裝飾器來實現任何原生的PyTorch功能。但有了Callback之後，我們在利用例如數據增強、複雜損失函數計算等方法的時候就更加容易了。在下面的例子當中，定義所需要的誤差度量函數就變得非常簡便：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/61941d3c0be04cc29e9cfa0d784d8a29&quot;&gt;ML - 多分類任務&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/catalyst-team/catalyst#minimal-examples&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;ML – 推薦系統&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Callback API在train循環當中不斷運行如下這些小的函數：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fe3d1024880194cf0c148a894aa3651b/7e21b/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 95.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACkElEQVQ4y5WUO0/cQBSFt6VBArz2bszanvfY+0S00AA/hodokJaNkoYuiSj5TVCFjodACAmogAYa2O7kzjiQLRIFF0dT7M7nc86dmdrz8zPG41e8vpJeXsq1osbjsV+fnp5Qu7m5wbfvPzAcfcbo6xcMd3cxHA7/ql0n+n1So9EIOzs7ODg4wP39PWrHxz9hiw5mogZinqIZNxGFdYRRhCCMUCdF9QAhKahHmJsLMDs7Q5r1CoIAU1NTWF5extXVFWpHR0cYLAzAucJiv49223rZdhvaFrB5jsIoGK0hdA7GBbIsexfnHM1mE2trazg9PUXt8PAQPQIlGUev04YxEpI2c6nAlYYRDJIzZFIjzRharXkkSfKuNE0RhiFWVlZwcnLyB5gygYV+D9ZKcmbJjSGRUymgBCe4of9wArY+BkzSDJ0ih9YCUkpwobxL504yikdR3UcrABm6rjcCKlXCOMXU5E4RlAmJrAowdR12O7DUoTYUVxkf20juIzNZMbL7+kLPdUgxXX8mp+iKOuQQNElGH0hoc8XIhQcqN2XnkLp0kYWPrH3PlYCdovAdCuqQuQ6F8P1xRseGhlTJoeuw320jzzUUdSgpshtO7iL7Y2OrAwfdLgxFFqqMLMmhO9iMl0NJCPYGfFv/47CDotB03QyUzf2UFfVonEM6NoyO0STsn8DBYED3kv8+hzQITZMml86ppJuiPVDQYJQHTIpRv41GA6urqyXQPQ6WrlrUjGEJxOnFadE057PyzPFWjDiO8SlhiOgFcm4m5WDT09NYWloqH4ezszPs7e1ha3MT21vbWF9fx8bGxoe1Sfvcur+/j+vra9QeHh5we3uLi4sLOPj5+XllXV5e4u7uDo+Pj/gFf8TZUtRHbgoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/fe3d1024880194cf0c148a894aa3651b/8ac56/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 240w,
/static/fe3d1024880194cf0c148a894aa3651b/d3be9/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 480w,
/static/fe3d1024880194cf0c148a894aa3651b/e46b2/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 960w,
/static/fe3d1024880194cf0c148a894aa3651b/f992d/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 1440w,
/static/fe3d1024880194cf0c148a894aa3651b/4dd3a/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.webp 1626w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/fe3d1024880194cf0c148a894aa3651b/8ff5a/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 240w,
/static/fe3d1024880194cf0c148a894aa3651b/e85cb/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 480w,
/static/fe3d1024880194cf0c148a894aa3651b/d9199/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 960w,
/static/fe3d1024880194cf0c148a894aa3651b/07a9c/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 1440w,
/static/fe3d1024880194cf0c148a894aa3651b/7e21b/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png 1626w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/fe3d1024880194cf0c148a894aa3651b/d9199/d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
            alt=&quot;d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
            title=&quot;d1fd0b21dcf54ae86e21544d58b35afc44cf55d2.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;你可以在文檔當中Callback API章節下面找到所有支持的回調函數。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;metric-度量抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#metric-%E5%BA%A6%E9%87%8F%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;metric 度量抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt; 度量抽象&lt;/h2&gt;
&lt;p&gt;除了對訓練邏輯和方法等可復用內容的抽象，Catalyst也提供了在實驗中可以幫助誤差計算的&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt;抽象。它的API非常簡單：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3960ba562733b9a50d006dc2fd447725/dca52/f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAC50lEQVQ4y5VUy07bQBTNng2VQh5OHL8942cch4QSNggQfwRJ/oAmQa3EhmVbic9BbBCJBBILWCDYsAJ2p3fGhGcp6eLoeq49x+fOuXNzt7e3uL+/l7i7u5OYrmfFw8ODjIIrd3V1hZ+/fmMw2sXujx/4ThgOhxgMvmE4GDximEXKv8VoNMLOzg4ODg5wc3OD3GQ8xtLXDr6UFKiWDtM0USorKCoVFCkWiiUsFAsyFgoF5PP5VxC5ubk5rK2t4fz8HLmjoyOsrHRQUTV4QYS0maKeNlFvtpAsttFotRE26rCZB8O0oGkadF1/gmEYKJVK2NzcxMnJCXKHh4dYXl6WhPU4RBzH8DwfjPswtBosQ4dNmyydiGhdq72G+IFQubGxgePj42fCMpUXewEcy4RtGgSTCDWYpEKSUk6ndbWqQlVVSSbilHB9ff01YaWmI01CRHEEzw/h+wGiJAX3PIS+B4sIBbHAlOylwneECpmQBCG4Y0uVzKZoW/LZpejaImdJpTMRVklhox4iCJgEo3N0BbgHHsZwXAbOGNQXZP8sWSmXsRQHqHsuEp8h5i4aPkfiMaQBR8QcuKRW+8CUvxAq8F3+zsVsU6amUq3+nymLDerDNIFPpcaBLxUJE4TTDp2dWIszNSn36RmWqeSIZyRZ2xhPLWQ+ts0Uhj4DoVAYxz61jEuN7YIFAUybzo2M0Mhxg1MkoiqVPVPJQmEr8qQJAsKUZuhJMzKTHHiOJSuYEn5iShkh4/K6Ceg1VcIQoGs3VfSS7MOr1+l0ZB+GVKbLORy6glw0Od0YJkBliyHwlmg6KIrF4jOhmDatVgv5hQI5G8JiAcKkiVa7DZ8aOmosopmmsCyLFNN00QxJJEjElFEUBfPz81hdXcWYRmHu7OwMe3t76HW76BK2t7tPz1tbW7TeRq/XQ7/fR7/XzyJB5LuP34n3+/v72Ty8vr7GxcUFTk9PMZlMPoT4u4yT8bt3QtTl5aWc2H8A3KEIzCwkjTgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/3960ba562733b9a50d006dc2fd447725/8ac56/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 240w,
/static/3960ba562733b9a50d006dc2fd447725/d3be9/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 480w,
/static/3960ba562733b9a50d006dc2fd447725/e46b2/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 960w,
/static/3960ba562733b9a50d006dc2fd447725/f992d/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 1440w,
/static/3960ba562733b9a50d006dc2fd447725/eb054/f156f0464248d8c45c0669500a3f22c1998e6ffd.webp 1550w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/3960ba562733b9a50d006dc2fd447725/8ff5a/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 240w,
/static/3960ba562733b9a50d006dc2fd447725/e85cb/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 480w,
/static/3960ba562733b9a50d006dc2fd447725/d9199/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 960w,
/static/3960ba562733b9a50d006dc2fd447725/07a9c/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 1440w,
/static/3960ba562733b9a50d006dc2fd447725/dca52/f156f0464248d8c45c0669500a3f22c1998e6ffd.png 1550w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/3960ba562733b9a50d006dc2fd447725/d9199/f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
            alt=&quot;f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
            title=&quot;f156f0464248d8c45c0669500a3f22c1998e6ffd.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;你可以在文檔中Metric API章節下面找到所有支持的&lt;code class=&quot;language-text&quot;&gt;Metric&lt;/code&gt;方法。&lt;/p&gt;
&lt;p&gt;Catalyst的Metric API中所有的誤差函數都支持更新和計算key-value形式的誤差結果。這種形式在訓練過程中會讓各種Loss的含義表達非常明確，並且也提供了一種可以存儲你想在日誌當中記錄任意數量Loss或者狀態值的規則。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;logger-日誌抽象&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#logger-%E6%97%A5%E8%AA%8C%E6%8A%BD%E8%B1%A1&quot; aria-label=&quot;logger 日誌抽象 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Logger&lt;/code&gt; 日誌抽象&lt;/h2&gt;
&lt;p&gt;最後，日誌系統。在Catalyst 21版本的Release當中，我們把各種監控系統的API整合到了一個類當中。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ac03af545f3101b796b2f294ec4799e/71c1d/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACKklEQVQ4y52TSW4aQRiF+wJBCmDopqGbnukB2sTJJVDAvgxDFmbacARW8Y7bIFgiMWwYhAQskGLYvvxVxHESOUjJ4qmquur/6lXVa+F4POJ0OuFMev72zPv/qvP5zMVYwuFwwNenJ1TrDXxpPqLeaKBWraJWq/1U/VfV668tqUHrq7S+1+thu91CWK1W+Fyu4N37G2QsHWlFhihJSEoyKQWJ+glRxI0kIpFMIpFI0DiFeDyOWCzG20gkAsdxMJlMIMxmMzw83BMkhbtCAZ9uA4R5H4Hv45bGd4UAlm0haxrQmXQduuUgq2nIZrPQqJVlGcViEaPRCMJ0OkWlUkZSlODmXNrJgm6Y0HQDKi3WTAuGYcC2LF6sEiRLc4qiIpPJQFVVfooCbT4cDl+BCQKGQYCP5DDve/BcF4HnwPd8mASzbRs6c8U3saGo14DlC5BBHNuEYZrcpWE75E7nRRdnJodk0mneKopyHcgdhnR3dIdhPkBA48BzEZLTHDnUDItDXnTVIXvRAgF814GTy8E0L3eZ/uHmT2fXHVYqFAkRgeshT24ccuM5NkHN3xy9pTeB9wSU5AzFJI8P7FFokj2G5bhUcCn6m1h0WGzCMLwA5/M5SqUSD6etUVxUOhotUNMyUizgFOZrEin00WgUObqm8XgMYblcYjAYoNvtotVq47HZRPNFrRZ9u652u41Op4N+vw/2kwj7/R6bzQaLxQLs+P8jdsr1eo3dbofvqalAfFt6XmcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/2ac03af545f3101b796b2f294ec4799e/8ac56/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 240w,
/static/2ac03af545f3101b796b2f294ec4799e/d3be9/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 480w,
/static/2ac03af545f3101b796b2f294ec4799e/e46b2/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 960w,
/static/2ac03af545f3101b796b2f294ec4799e/f992d/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 1440w,
/static/2ac03af545f3101b796b2f294ec4799e/0abaa/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.webp 1536w&quot;
              sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/2ac03af545f3101b796b2f294ec4799e/8ff5a/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 240w,
/static/2ac03af545f3101b796b2f294ec4799e/e85cb/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 480w,
/static/2ac03af545f3101b796b2f294ec4799e/d9199/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 960w,
/static/2ac03af545f3101b796b2f294ec4799e/07a9c/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 1440w,
/static/2ac03af545f3101b796b2f294ec4799e/71c1d/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png 1536w&quot;
            sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/2ac03af545f3101b796b2f294ec4799e/d9199/4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
            alt=&quot;4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
            title=&quot;4ee00b65e77f6154ecabbbd7352c47f5e6e9a2cf.png&quot;
            loading=&quot;lazy&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在這樣一個簡單的API下，我們已經提供了對MLFlow以及Tensorboard的整合。例如Neptune和WandB這種高級的Logger，我們團隊也正在開發當中。&lt;/p&gt;
&lt;p&gt;所有當下支持的&lt;code class=&quot;language-text&quot;&gt;Logger&lt;/code&gt;可以在文檔當中Logger API章節下找到。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apple語境中x86_64/arm64以及Universal的ncnn編譯]]></title><description><![CDATA[macOS上对App的编译自从Xcode 12以来就默认要求Universal了。但是我在使用ncnn的时候发现了一些可能会出错的前置库架构，所以根据ncnn的Github Workflow改了一下编译流程，在此记录。]]></description><link>https://lumen.netlify.com/posts/4031fd98-7051-4445-83b1-2198d453891b</link><guid isPermaLink="false">https://lumen.netlify.com/posts/4031fd98-7051-4445-83b1-2198d453891b</guid><pubDate>Sun, 30 May 2021 09:07:00 GMT</pubDate><content:encoded>&lt;p&gt;自從Apple Silicon的M1芯片搭載到新型Mac電腦上以來，我們在基於Intel的Mac上面所編譯的程序則需要通過Rosetta工具來轉譯實現在Apple Silicon平臺上的運行。Xcode自從12版本以來，從底層的工具鏈到macOS應用的默認架構，都顯示出對Apple Silicion + Intel多架構編譯的友好支持。爲了避免轉譯造成的兼容性以及性能的影響，我們要更多的讓應用本地運行，而非依賴轉譯。而一個通用的二進制包含了在ARM（Apple Silicon）和x86_64（Intel）上都可本地運行的可執行代碼。&lt;/p&gt;
&lt;p&gt;這裏記錄的是對於深度學習庫&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的編譯。包括了單獨編譯可本地運行的x86&lt;em&gt;64、arm64以及Universal（x86&lt;/em&gt;64 + arm64）版本的三種不同的庫。當然，如果只需要某一種編譯的話，可以直接編譯相應版本。&lt;/p&gt;
&lt;p&gt;最後的Universal部分有可直接編譯的方法，大家可以根據自己需求進行編譯。&lt;/p&gt;
&lt;p&gt;這個編譯過程是根據ncnn的Github CI流程來實現的。其中聲明了幾個CI風格的環境變量，但並沒有更改變量名稱。編譯後期需要注意區分其含義。&lt;/p&gt;
&lt;p&gt;在這一切之前，相對推薦將代碼庫切換至本文所寫時的版本。&lt;/p&gt;
&lt;p&gt;可以通過在&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;代碼庫下使用下述指令來實現：&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git checkout 20210507&lt;/code&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;adding-openmp-and-vulkan-to-workspace&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#adding-openmp-and-vulkan-to-workspace&quot; aria-label=&quot;adding openmp and vulkan to workspace permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Adding &lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt; to workspace&lt;/h2&gt;
&lt;p&gt;這裏寫明了編譯安裝OpenMP以及下載VulkanSDK的過程。注意，請修改&lt;code class=&quot;language-text&quot;&gt;GITHUB_WORKSPACE&lt;/code&gt;指向你的工作路徑。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GITHUB_WORKSPACE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your_workspace&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DEVELOPER_DIR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/Applications/Xcode.app/Contents/Developer/

&lt;span class=&quot;token comment&quot;&gt;# openmp&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://github.com/llvm/llvm-project/releases/download/llvmorg-11.0.0/openmp-11.0.0.src.tar.xz
&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; -xf openmp-11.0.0.src.tar.xz
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; openmp-11.0.0.src
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;/.size __kmp_unnamed_critical_addr/d&apos;&lt;/span&gt; runtime/src/z_Linux_asm.S
&lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; -i&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; -e &lt;span class=&quot;token string&quot;&gt;&apos;s/__kmp_unnamed_critical_addr/___kmp_unnamed_critical_addr/g&apos;&lt;/span&gt; runtime/src/z_Linux_asm.S
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p build &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build
cmake -DCMAKE_BUILD_TYPE&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Release -DCMAKE_INSTALL_PREFIX&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;install -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;x86_64;arm64&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DLIBOMP_ENABLE_SHARED&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DLIBOMP_OMPT_SUPPORT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DLIBOMP_USE_HWLOC&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -r install/* &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install

&lt;span class=&quot;token comment&quot;&gt;# install openmp&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install/include/* &lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/openmp-install/lib/libomp.a &lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib

&lt;span class=&quot;token comment&quot;&gt;# vulkansdk&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# change dir to a more accurate path.&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://sdk.lunarg.com/sdk/download/1.2.162.0/mac/vulkansdk-macos-1.2.162.0.dmg?Human&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true -O vulkansdk-macos-1.2.162.0.dmg
hdiutil attach vulkansdk-macos-1.2.162.0.dmg
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -r /Volumes/vulkansdk-macos-1.2.162.0 &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf vulkansdk-macos-1.2.162.0/Applications
&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; vulkansdk-macos-1.2.162.0 -type f &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; -v -E &lt;span class=&quot;token string&quot;&gt;&apos;vulkan|glslang|MoltenVK&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt;
hdiutil detach /Volumes/vulkansdk-macos-1.2.162.0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;macos-on-apple-silicon-with-vulkan&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#macos-on-apple-silicon-with-vulkan&quot; aria-label=&quot;macos on apple silicon with vulkan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;macOS on &lt;em&gt;Apple Silicon&lt;/em&gt; with &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;這裏寫明了對搭載了Apple M1處理器的Mac計算機，並且開啓Vulkan支持，繼而進行編譯ncnn的過程。&lt;/p&gt;
&lt;p&gt;這部分內容參考的是如下CI所用的yaml文件：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Tencent/ncnn/blob/master/.github/workflows/macos-arm64-gpu.yml&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Tencent/ncnn&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;building-ncnn&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#building-ncnn&quot; aria-label=&quot;building ncnn permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Building &lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這裏說明了在部署好&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;之後，對&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的編譯過程。請將&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的源碼放置在&lt;code class=&quot;language-text&quot;&gt;$GITHUB_WORKSPACE&lt;/code&gt;目錄下（當然，如果不的話也可以，修改相應路徑指向即可）。&lt;/p&gt;
&lt;h3 id=&quot;build-the-static-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-static-library&quot; aria-label=&quot;build the static library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the static library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p build-silicon &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-silicon  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;build&quot; to &quot;build-silicon&quot;&lt;/span&gt;
cmake -DCMAKE_CROSSCOMPILING&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DCMAKE_SYSTEM_PROCESSOR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_INCLUDE_DIR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/include &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/dylib/macOS/libMoltenVK.dylib &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TOOLS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_BUILD_EXAMPLES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;build-the-shared-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-shared-library&quot; aria-label=&quot;build the shared library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the shared library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon-shared&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; build-silicon-shared &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-silicon-shared  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;build-shared&quot; to &quot;build-silicon-shared&quot;&lt;/span&gt;
cmake -DCMAKE_CROSSCOMPILING&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DCMAKE_SYSTEM_PROCESSOR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_INCLUDE_DIR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/include &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/MoltenVK/dylib/macOS/libMoltenVK.dylib &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TOOLS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_BUILD_EXAMPLES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_SHARED_LIB&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_ENABLE_LTO&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;macos-on-intel-with-vulkan&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#macos-on-intel-with-vulkan&quot; aria-label=&quot;macos on intel with vulkan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;macOS on &lt;em&gt;Intel&lt;/em&gt; with &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;這裏寫明了對搭載了Intel處理器的Mac計算機，並且開啓Vulkan支持，繼而進行編譯ncnn的過程。&lt;/p&gt;
&lt;p&gt;這部分內容參考的是如下CI所用的yaml文件：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/Tencent/ncnn/blob/master/.github/workflows/macos-x64-gpu.yml&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Tencent/ncnn&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;build-the-static-library-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-static-library-1&quot; aria-label=&quot;build the static library 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the static library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; build-intel &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-intel
cmake -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TESTS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;brew-install-protobuf-opencv3&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#brew-install-protobuf-opencv3&quot; aria-label=&quot;brew install protobuf opencv3 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Brew install &lt;code class=&quot;language-text&quot;&gt;protobuf&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;OpenCV@3&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這是和 &lt;strong&gt;arm64&lt;/strong&gt; 架構編譯不同的地方。我們需要利用&lt;code class=&quot;language-text&quot;&gt;brew&lt;/code&gt;安裝Protocol Buffer和OpenCV 3。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GITHUB_WORKSPACE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your_workspace&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DEVELOPER_DIR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/Applications/Xcode.app/Contents/Developer/

&lt;span class=&quot;token comment&quot;&gt;# install protobuf and opencv@3&lt;/span&gt;
brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; protobuf opencv3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;adding-openmp-and-vulkan-to-workspace-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#adding-openmp-and-vulkan-to-workspace-1&quot; aria-label=&quot;adding openmp and vulkan to workspace 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Adding &lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt; to workspace&lt;/h2&gt;
&lt;p&gt;這個部分與上文提到的arm64編譯當中的 &lt;a href=&quot;/4031fd987051444583b12198d453891b&quot;&gt;這一步&lt;/a&gt; 相同，如果是從上面操作下來的話，可以利用之前的安裝。&lt;/p&gt;
&lt;h2 id=&quot;building-ncnn-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#building-ncnn-1&quot; aria-label=&quot;building ncnn 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Building &lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;這裏說明了在部署好&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;VulkanSDK&lt;/code&gt;之後，對&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的編譯過程。請將&lt;code class=&quot;language-text&quot;&gt;ncnn&lt;/code&gt;的源碼放置在&lt;code class=&quot;language-text&quot;&gt;$GITHUB_WORKSPACE&lt;/code&gt;目錄下（當然，如果不的話也可以，修改相應路徑指向即可）。&lt;/p&gt;
&lt;h3 id=&quot;test-the-built-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#test-the-built-library&quot; aria-label=&quot;test the built library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Test the built library&lt;/h3&gt;
&lt;p&gt;這裏，按照CI的流程，可以選擇性測試一下所編譯的庫是否可用以及結果是否準確。需要安裝一個VulkanSDK的高級接口&lt;code class=&quot;language-text&quot;&gt;github:google/swiftbuffer&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# install google/swiftshader&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/google/swiftshader.git
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; swiftshader
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; submodule update --init --recursive
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p build&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build
cmake -DCMAKE_INSTALL_PREFIX&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;install -DSWIFTSHADER_BUILD_EGL&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
		  -DSWIFTSHADER_BUILD_GLESv2&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE -DSWIFTSHADER_BUILD_GLES_CM&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DSWIFTSHADER_BUILD_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TRUE -DSWIFTSHADER_BUILD_PVR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DSWIFTSHADER_BUILD_TESTS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE -DSWIFTSHADER_ENABLE_ASTC&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DSWIFTSHADER_WARNINGS_AS_ERRORS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;FALSE -DREACTOR_BACKEND&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Subzero &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      -DREACTOR_DEFAULT_OPT_LEVEL&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Default -DCMAKE_BUILD_TYPE&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Release &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/swiftshader-install
&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; Darwin/* &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/swiftshader-install

&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DYLD_LIBRARY_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS/lib&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$DYLD_LIBRARY_PATH&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VK_ICD_FILENAMES&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/swiftshader-install/vk_swiftshader_icd.json&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ctest --output-on-failure -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;build-the-shared-library-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-the-shared-library-1&quot; aria-label=&quot;build the shared library 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build the shared library&lt;/h3&gt;
&lt;p&gt;這裏，與原始CI流程不同的是，將&lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt;的路徑指向重新定義了一下。並且將編譯工作路徑重命名爲&lt;code class=&quot;language-text&quot;&gt;build-silicon-shared&lt;/code&gt;以區分對不同運行架構的編譯工作。會在代碼中通過備註來表明與之不同位置。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; build-intel-shared &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; build-intel-shared
cmake -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;x86_64 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_SHARED_LIB&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_ENABLE_LTO&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;build-as-an-universal-app-with-vulkan&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-as-an-universal-app-with-vulkan&quot; aria-label=&quot;build as an universal app with vulkan permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Build as an Universal app with &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;這裏說明了對Universal應用進行編譯的兩種方法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通過&lt;code class=&quot;language-text&quot;&gt;lipo&lt;/code&gt;工具對不同架構下的可執行代碼進行融合；&lt;/li&gt;
&lt;li&gt;利用&lt;code class=&quot;language-text&quot;&gt;cmake&lt;/code&gt;生成可以自動化對兩種架構的可執行代碼融合的makefile；&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;use-lipo-to-fuse-different-libraries&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#use-lipo-to-fuse-different-libraries&quot; aria-label=&quot;use lipo to fuse different libraries permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Use &lt;code class=&quot;language-text&quot;&gt;lipo&lt;/code&gt; to fuse different libraries&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/lib
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/include

&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel/install/lib/*.a &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; -L &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;basename&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; -L &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; -I % &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;lipo -create &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel/install/lib/% \
    &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-silicon/install/lib/% \
    -o &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/lib/%&apos;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -r &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-intel/install/include/* &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn/build-lipo/include/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;use-cmake-to-compile-a-universal-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#use-cmake-to-compile-a-universal-library&quot; aria-label=&quot;use cmake to compile a universal library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Use &lt;code class=&quot;language-text&quot;&gt;cmake&lt;/code&gt; to compile a Universal library&lt;/h2&gt;
&lt;h3 id=&quot;brew-install-protobuf-opencv3-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#brew-install-protobuf-opencv3-1&quot; aria-label=&quot;brew install protobuf opencv3 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Brew install &lt;code class=&quot;language-text&quot;&gt;protobuf&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;OpenCV@3&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;這個部分與上文提到的Intel編譯當中的 &lt;a href=&quot;/4031fd987051444583b12198d453891b&quot;&gt;這一步&lt;/a&gt; 相同，如果是從上面操作下來的話，可以利用之前的安裝。&lt;/p&gt;
&lt;h3 id=&quot;adding-openmp-and-vulkan-to-workspace-2&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#adding-openmp-and-vulkan-to-workspace-2&quot; aria-label=&quot;adding openmp and vulkan to workspace 2 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Adding &lt;code class=&quot;language-text&quot;&gt;OpenMP&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Vulkan&lt;/code&gt; to workspace&lt;/h3&gt;
&lt;p&gt;這個部分與上文提到的arm64編譯當中的 &lt;a href=&quot;/4031fd987051444583b12198d453891b&quot;&gt;這一步&lt;/a&gt; 相同，如果是從上面操作下來的話，可以利用之前的安裝。&lt;/p&gt;
&lt;h3 id=&quot;compile-a-universal-library-directly&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#compile-a-universal-library-directly&quot; aria-label=&quot;compile a universal library directly permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Compile a Universal library directly&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/ncnn
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;VULKAN_SDK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/vulkansdk-macos-1.2.162.0/macOS  &lt;span class=&quot;token comment&quot;&gt;# changed here from &quot;`pwd`&quot; to &quot;$GITHUB_WORKSPACE&quot;&lt;/span&gt;
cmake -DCMAKE_CROSSCOMPILING&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DCMAKE_SYSTEM_PROCESSOR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;x86_64;arm64&quot;&lt;/span&gt; -DCMAKE_OSX_ARCHITECTURES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;x86_64;arm64&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; -DOpenMP_CXX_FLAGS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-Xclang -fopenmp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_C_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; -DOpenMP_CXX_LIB_NAMES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;libomp&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DOpenMP_libomp_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$DEVELOPER_DIR&lt;/span&gt;/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib/libomp.a&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_INCLUDE_DIR&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/VulkanSDK/1.2.176.1/macOS/include &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DVulkan_LIBRARY&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$GITHUB_WORKSPACE&lt;/span&gt;/VulkanSDK/1.2.176.1/macOS/lib/libMoltenVK.dylib &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -DNCNN_VULKAN&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ON -DNCNN_BUILD_TOOLS&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF -DNCNN_BUILD_EXAMPLES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OFF &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -j &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
cmake --build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; --target &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>