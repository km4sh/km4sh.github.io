<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.08b6f1b92a40a3f4c705.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="Blog by er1yaaruma" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-73379983-2"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-73379983-2', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=72dfeeca5278ea240ea18d28272031a8" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=72dfeeca5278ea240ea18d28272031a8"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=72dfeeca5278ea240ea18d28272031a8"/><title data-react-helmet="true">如何下載AudioSet數據集的音頻文件 - Blog by er1yaaruma</title><meta data-react-helmet="true" name="description" content="如何利用Python下載龐大的AudioSet數據集，並且進行數據驗證於後處理。"/><meta data-react-helmet="true" property="og:site_name" content="如何下載AudioSet數據集的音頻文件 - Blog by er1yaaruma"/><meta data-react-helmet="true" property="og:image" content="https://lumen.netlify.com/photo.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="如何下載AudioSet數據集的音頻文件 - Blog by er1yaaruma"/><meta data-react-helmet="true" name="twitter:description" content="如何利用Python下載龐大的AudioSet數據集，並且進行數據驗證於後處理。"/><meta data-react-helmet="true" name="twitter:image" content="https://lumen.netlify.com/photo.png"/><link as="script" rel="preload" href="/webpack-runtime-9e14da4f4b41e7a8f978.js"/><link as="script" rel="preload" href="/framework-1e331b2e9d55ebef6dec.js"/><link as="script" rel="preload" href="/532a2f07-549094fa347c85980056.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-5954f1f1c3eead9a6f74.js"/><link as="script" rel="preload" href="/app-e815b53f2e11d3d25400.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-69626fa07c736046dbe7.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-32a004a3619ef9011e8d.js"/><link as="fetch" rel="preload" href="/page-data/posts/550ee3f0-7653-4036-9568-b221dcc2e733/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">如何下載AudioSet數據集的音頻文件</h1><div class="Content-module--content__body--2TrQ-"><h1 id="寫在前面" style="position:relative;"><a href="#%E5%AF%AB%E5%9C%A8%E5%89%8D%E9%9D%A2" aria-label="寫在前面 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>寫在前面</h1>
<h2 id="涉及的技術點" style="position:relative;"><a href="#%E6%B6%89%E5%8F%8A%E7%9A%84%E6%8A%80%E8%A1%93%E9%BB%9E" aria-label="涉及的技術點 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>涉及的技術點</h2>
<ul>
<li>youtube-dl的使用方法</li>
<li>利用FFmpeg進行轉碼的方法</li>
<li>利用sox剪輯你喜歡的音頻的方法</li>
<li>利用Numpy編輯音頻的方法</li>
<li>在Python中執行Shell命令的方法和編程習慣</li>
</ul>
<p>這裏只挑選幾個值得一說的點來寫，剩下的都在完整代碼中有所涉及。</p>
<h2 id="終端輸出樣例" style="position:relative;"><a href="#%E7%B5%82%E7%AB%AF%E8%BC%B8%E5%87%BA%E6%A8%A3%E4%BE%8B" aria-label="終端輸出樣例 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>終端輸出樣例</h2>
<p>下面這個樣例是執行程序時終端的輸出，也代表了下載的整體流程。</p>
<p>其中<code class="language-text">mP0bdHdXLyo_1000</code>裏面的<code class="language-text">mP0bdHdXLyo</code>代表YouTube的VideoID，<code class="language-text">1000</code>代表是從第1000毫秒開始，往後10秒的音頻片段。</p>
<p>下載過程中會產生視頻文件<code class="language-text">mP0bdHdXLyo_1000.m4a</code>，完整的音頻文件<code class="language-text">mP0bdHdXLyo_1000_temp.wav</code>，剪切好的音頻文件<code class="language-text">mP0bdHdXLyo_1000.wav</code>。</p>
<p>如果不足十秒，例如這裏檢查相差<code class="language-text">6892</code>個樣點，我選擇對其補零處理，當然根據需要也可以不這麼做。</p>
<p>爲了統計那些文件是補零過的，我們把補過零的文件放到了單獨的<code class="language-text">strong_label_train_padded</code>文件夾。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">12</span> @<span class="token number">35396</span> INFO     <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>mP0bdHdXLyo_1000<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">12</span> @<span class="token number">35396</span> INFO      <span class="token operator">></span> download_video
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Downloaded<span class="token punctuation">:</span> 	mP0bdHdXLyo_1000<span class="token punctuation">.</span>m4a
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Duration<span class="token punctuation">:</span> 	converted audio<span class="token punctuation">:</span> 11s
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO      <span class="token operator">></span> convert_to_audio
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Converted<span class="token punctuation">:</span> 	mP0bdHdXLyo_1000<span class="token punctuation">.</span>m4a to mP0bdHdXLyo_1000_temp<span class="token punctuation">.</span>wav
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> WARNING  Removed<span class="token punctuation">:</span> 	mP0bdHdXLyo_1000<span class="token punctuation">.</span>m4a
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Duration<span class="token punctuation">:</span> 	converted audio<span class="token punctuation">:</span> 11s
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO      <span class="token operator">></span> trim_audio
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Trimmed<span class="token punctuation">:</span> 	mP0bdHdXLyo_1000_temp<span class="token punctuation">.</span>wav to mP0bdHdXLyo_1000<span class="token punctuation">.</span>wav
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> WARNING  Removed<span class="token punctuation">:</span> 	mP0bdHdXLyo_1000_temp<span class="token punctuation">.</span>wav
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> WARNING   <span class="token operator">></span> padding
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> WARNING  Diff<span class="token punctuation">:</span> <span class="token number">6892</span>
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> WARNING  Removed<span class="token punctuation">:</span> 	<span class="token operator">/</span>AudioSet<span class="token operator">/</span>strong_label_train<span class="token operator">/</span>mP0bdHdXLyo_1000<span class="token punctuation">.</span>wav
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO      <span class="token operator">></span> checking
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Checking<span class="token punctuation">:</span> 	<span class="token operator">/</span>AudioSet<span class="token operator">/</span>strong_label_train_padded<span class="token operator">/</span>mP0bdHdXLyo_1000<span class="token punctuation">.</span>wav
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Checking<span class="token punctuation">:</span> 	channels<span class="token punctuation">:</span>	<span class="token number">1</span>
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Checking<span class="token punctuation">:</span> 	samplerate<span class="token punctuation">:</span>	<span class="token number">44100</span>
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Checking<span class="token punctuation">:</span> 	precision<span class="token punctuation">:</span>	<span class="token number">16</span><span class="token operator">-</span>bit
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Checking<span class="token punctuation">:</span> 	duration<span class="token punctuation">:</span>	<span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">10.00</span>
July <span class="token number">06</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">20</span> @<span class="token number">35396</span> INFO     Finished<span class="token punctuation">:</span> 	mP0bdHdXLyo_1000</code></pre></div>
<h2 id="總體流程" style="position:relative;"><a href="#%E7%B8%BD%E9%AB%94%E6%B5%81%E7%A8%8B" aria-label="總體流程 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>總體流程</h2>
<p>所有代碼都在github.com/km4sh/fetch-audioset這個repo中。</p>
<ul>
<li>scripts文件夾當中包含了下載用的py文件，也有生成下載報告和清理臨時文件的腳本；</li>
<li>tsv文件夾包含了Google放出的AudioSet(Strong Label)數據集的tsv文件（一種以Tab作爲分隔符的文件）；</li>
<li>info文件夾當中</li>
</ul>
<p><a href="https://github.com/km4sh/fetch-audioset" target="_blank" rel="nofollow noopener noreferrer">GitHub - km4sh/fetch-audioset</a></p>
<p>下載AudioSet主要用的是下載神器<code class="language-text">youtube-dl</code>來實現的。最核心的代碼在我Github的Repo當中，可以<a href="https://github.com/km4sh/fetch-audioset/blob/development/scripts/download_audioset.py" target="_blank" rel="nofollow noopener noreferrer">點擊這裏</a>直達。由於接口原因，貌似沒有可以直接下載音頻的方式，所以需要先下載視頻，再提取音頻。所以主要流程如下：</p>
<ul>
<li><code class="language-text">split_samplename()</code> 將輸入參數處理爲視頻ID <code class="language-text">ytid</code> 和開始時間 <code class="language-text">start</code> ；</li>
<li><code class="language-text">download_video()</code> 利用ytid將整段視頻下載下來；</li>
<li><code class="language-text">convert_to_audio()</code> 利用FFmpeg將視頻中的音頻提取出來，順便完成通道壓縮（僅單通道）、採樣率調整（統一44100Hz）以及格式轉換（WAV）等任務。</li>
<li>
<p><code class="language-text">trim_audio()</code> 利用sox工具進行音頻剪切。</p>
<ul>
<li>剪切也可以在上一步利用FFmpeg一同完成，不過我個人覺得sox進行剪切更準確一些。</li>
</ul>
</li>
<li><code class="language-text">padding_zeros()</code> [<em>Optianal</em>]如上一步的說明，如果有一些樣本不足十秒，則補零到十秒。這一步可以根據自己的需求選用。</li>
<li><code class="language-text">checking()</code> 檢查當前文件是否符合要求，主要檢查通道數、採樣率、採樣深度、採樣時間、總樣點數。也是利用sox來獲取的文檔信息，確保準確可讀。</li>
</ul>
<p>對於下載當中由於網絡等原因出現下載失敗的情況，我們可以用<a href="https://github.com/km4sh/fetch-audioset/blob/development/scripts/clean.py" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">clean.py</code></a>來清理一下臨時文件，以及不符合我們設定格式的文件。</p>
<h2 id="下載audioset的幾個問題" style="position:relative;"><a href="#%E4%B8%8B%E8%BC%89audioset%E7%9A%84%E5%B9%BE%E5%80%8B%E5%95%8F%E9%A1%8C" aria-label="下載audioset的幾個問題 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>下載AudioSet的幾個問題</h2>
<ul>
<li>
<p>來自YouTube的問題</p>
<ul>
<li>訪問次數限制</li>
<li>視頻下架</li>
<li>視頻地區限制</li>
<li>視頻年齡限制</li>
</ul>
</li>
<li>
<p>來自AudioSet的問題</p>
<ul>
<li>數據量較大</li>
<li>10s時長問題</li>
<li>音頻格式、通道數、採樣率以及採樣位數</li>
</ul>
</li>
</ul>
<h1 id="解決方案" style="position:relative;"><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88" aria-label="解決方案 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解決方案</h1>
<h2 id="來自youtube的問題" style="position:relative;"><a href="#%E4%BE%86%E8%87%AAyoutube%E7%9A%84%E5%95%8F%E9%A1%8C" aria-label="來自youtube的問題 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>來自YouTube的問題</h2>
<p>來自YouTube的問題基本上都是源於YouTube用戶使用協議產生的。這裏僅對此進行技術討論，且目的僅限於進行學術活動。作者並不鼓勵任何違反協議的行爲。</p>
<h3 id="訪問次數限制" style="position:relative;"><a href="#%E8%A8%AA%E5%95%8F%E6%AC%A1%E6%95%B8%E9%99%90%E5%88%B6" aria-label="訪問次數限制 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>訪問次數限制</h3>
<p>對於訪問次數的限制，可以通過直連節點代理的方式來規避。具體方法可以利用youtube-dl內的proxy相關參數來實現；也可以通過終端內對當前shell的環境變量進行設置來實現，這意味着整個運行過程都通過這個代理來下載。</p>
<p>如果利用代理之後依然會出現訪問次數限制，請嘗試：</p>
<ul>
<li>使用不那麼擁擠的代理</li>
<li>每隔一段時間就更換一下代理</li>
<li>下載慢一點</li>
</ul>
<p>由於我不需要頻繁切換代理，即可以保證穩定下載，所以我利用如下命令設置了環境變量：</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span>http://127.0.0.1:8234<span class="token punctuation">;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">http_proxy</span><span class="token operator">=</span>http://127.0.0.1:8234<span class="token punctuation">;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">all_proxy</span><span class="token operator">=</span>socks5://127.0.0.1:8235<span class="token punctuation">;</span></code></pre></div>
<p>這裏的具體IP和端口請根據自己的網絡情況和代理服務器信息進行設置，在此不做過多討論。</p>
<p>如果需要頻繁切換代理的話，利用<code class="language-text">youtube-dl</code>的option來設置proxy或許更好，因爲這樣可以讓每次調用<code class="language-text">youtube-dl</code>的時候都用不同的proxy。</p>
<h2 id="視頻下架" style="position:relative;"><a href="#%E8%A6%96%E9%A0%BB%E4%B8%8B%E6%9E%B6" aria-label="視頻下架 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>視頻下架</h2>
<p>請聯繫作者，或者學術社區內其他在視頻還健在的時候下載過的人。</p>
<h2 id="地區限制" style="position:relative;"><a href="#%E5%9C%B0%E5%8D%80%E9%99%90%E5%88%B6" aria-label="地區限制 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>地區限制</h2>
<p>利用訪問次數限制這裏提到的方法，選取一個出口地點爲可用的地區/國家的代理。我的做法是，選取一個較穩定的代理進行下載之後，再用幾個不同的位置的代理對之前未能下載的列表進行嘗試。</p>
<p>具體去哪裡弄這些代理，請聯繫身邊有經驗的人。</p>
<h2 id="年齡限制" style="position:relative;"><a href="#%E5%B9%B4%E9%BD%A1%E9%99%90%E5%88%B6" aria-label="年齡限制 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>年齡限制</h2>
<p>解決年齡限制的問題，需要登錄Google帳號來讓YouTube確認你的年齡。youtube-dl提供兩種登錄方式：帳號密碼和Cookie。我比較習慣提供Cookie給軟件使用。當然，如果覺得OK的話提供帳號密碼也可以，請參考youtube-dl的文檔。</p>
<p>Cookie文件的獲取可以利用瀏覽器的插件很方便的進行。我用的是EditThisCookie這個插件，可以在Chrome Web Store獲取。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/243dde66e47c91582a2eb7c5482b4238/218a4/5583f90dc8244dc99aff56094538ff91df055ef1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQY042PXU6DQBSFWZFLdAe+uBZffDFugAcE2thYGgVKRf7lp8wwfA4kJZqQ2JN8OZMzNyf3Giwa+U/jOP7xNRn753tK3yLJSkzTxHFcbNthu91w8DxeLAvXdRiVWsourJUbj7c3vD7c0QjYbFyiKCIII3aej/cestt/8HYIaDo53/C7cA3jZD/RphFiUKRpSlHkVLr9WEBcwWcJWQNFrbhGxuVRVZXe7qS3C+fipq74LnPqTuAngkBzTCVhJmnaljj+0nOZ9pg8z0mSlLbrMJQapjuQUtLpYAr7XiCE1GiXivas6RVnMTEyDIOe6ef/xTVT/gPCT82L4AGXGwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/243dde66e47c91582a2eb7c5482b4238/8ac56/5583f90dc8244dc99aff56094538ff91df055ef1.webp 240w,
/static/243dde66e47c91582a2eb7c5482b4238/d3be9/5583f90dc8244dc99aff56094538ff91df055ef1.webp 480w,
/static/243dde66e47c91582a2eb7c5482b4238/e46b2/5583f90dc8244dc99aff56094538ff91df055ef1.webp 960w,
/static/243dde66e47c91582a2eb7c5482b4238/c18de/5583f90dc8244dc99aff56094538ff91df055ef1.webp 1052w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/243dde66e47c91582a2eb7c5482b4238/8ff5a/5583f90dc8244dc99aff56094538ff91df055ef1.png 240w,
/static/243dde66e47c91582a2eb7c5482b4238/e85cb/5583f90dc8244dc99aff56094538ff91df055ef1.png 480w,
/static/243dde66e47c91582a2eb7c5482b4238/d9199/5583f90dc8244dc99aff56094538ff91df055ef1.png 960w,
/static/243dde66e47c91582a2eb7c5482b4238/218a4/5583f90dc8244dc99aff56094538ff91df055ef1.png 1052w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/243dde66e47c91582a2eb7c5482b4238/d9199/5583f90dc8244dc99aff56094538ff91df055ef1.png"
            alt="5583f90dc8244dc99aff56094538ff91df055ef1.png"
            title="5583f90dc8244dc99aff56094538ff91df055ef1.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>不過需要注意的是，youtube-dl需要滿足Netscape格式的Cookie文件。在插件選項當中設置一下即可（我這裏默認的是JSON）。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/62ed8b7e48e75b7720b72374889e2cbc/7960f/649e60721f3e49b54cbe8d784fb936554471b3dc.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7klEQVQoz5VRSQqEQBDr/7/HV+hV0Jvgvu8LrhlSUDA3ZwqC6bY6nUqb4zjQti2KokDTNCjLElVVCbjfdR3u+wbreZ5XmH3f5XCapiKaZRniOJY1vxT8p8y2bRjHEcuyYJ5n4dM0YV1X8N95nriuSzin0TW5gqY4BfcNReiQQjqyig7DIA7J2aOcUXAC9uZ5LlNxn5caKvMgxQg2K6dA3/eIogie5yFJEomBa8ajF6oRyfCXXIIggGVZcBwHtm0LXNeF7/sIwxB1XYtTjm7eXo1FB3RIdzysoCs6ZGx0Kxm+uVNRlgb/DT4SH4ac9QFv4me+RQ6coQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/62ed8b7e48e75b7720b72374889e2cbc/8ac56/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 240w,
/static/62ed8b7e48e75b7720b72374889e2cbc/d3be9/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 480w,
/static/62ed8b7e48e75b7720b72374889e2cbc/e46b2/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 960w,
/static/62ed8b7e48e75b7720b72374889e2cbc/15a27/649e60721f3e49b54cbe8d784fb936554471b3dc.webp 1274w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/62ed8b7e48e75b7720b72374889e2cbc/8ff5a/649e60721f3e49b54cbe8d784fb936554471b3dc.png 240w,
/static/62ed8b7e48e75b7720b72374889e2cbc/e85cb/649e60721f3e49b54cbe8d784fb936554471b3dc.png 480w,
/static/62ed8b7e48e75b7720b72374889e2cbc/d9199/649e60721f3e49b54cbe8d784fb936554471b3dc.png 960w,
/static/62ed8b7e48e75b7720b72374889e2cbc/7960f/649e60721f3e49b54cbe8d784fb936554471b3dc.png 1274w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/62ed8b7e48e75b7720b72374889e2cbc/d9199/649e60721f3e49b54cbe8d784fb936554471b3dc.png"
            alt="649e60721f3e49b54cbe8d784fb936554471b3dc.png"
            title="649e60721f3e49b54cbe8d784fb936554471b3dc.png"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h1 id="來自audioset的問題" style="position:relative;"><a href="#%E4%BE%86%E8%87%AAaudioset%E7%9A%84%E5%95%8F%E9%A1%8C" aria-label="來自audioset的問題 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>來自AudioSet的問題</h1>
<h2 id="數據量較大" style="position:relative;"><a href="#%E6%95%B8%E6%93%9A%E9%87%8F%E8%BC%83%E5%A4%A7" aria-label="數據量較大 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>數據量較大</h2>
<p>我們可以利用多進程來加速數據下載。</p>
<p>多進程的第一步就是拆分任務，讀tsv文件進入Python之後，對列表進行拆分。我下載的是Strong Label的子集，所以tsv文件當中對同一樣本也進行了多個不同標註，所以還需要去重一下。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool

<span class="token comment"># 讀取tsv到列表</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>tsv_file<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    meta <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
meta <span class="token operator">=</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> meta<span class="token punctuation">]</span>

<span class="token comment"># 去重</span>
meta <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 設置進程數</span>
num_proc <span class="token operator">=</span> <span class="token number">8</span>

<span class="token comment"># 切分列表</span>
split_input <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span>
        meta<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span> <span class="token operator">//</span> num_proc <span class="token punctuation">:</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span> <span class="token operator">//</span> num_proc<span class="token punctuation">]</span><span class="token punctuation">,</span>
        save_dir<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_proc<span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># 啓動進程池</span>
<span class="token keyword">with</span> Pool<span class="token punctuation">(</span>num_proc<span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>starmap<span class="token punctuation">(</span>
        download_tsv<span class="token punctuation">,</span>
        star_input<span class="token punctuation">,</span>
    <span class="token punctuation">)</span></code></pre></div>
<h2 id="10秒時長的問題" style="position:relative;"><a href="#10%E7%A7%92%E6%99%82%E9%95%B7%E7%9A%84%E5%95%8F%E9%A1%8C" aria-label="10秒時長的問題 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10秒時長的問題</h2>
<p>無論AudioSet弱標籤數據集還是強標籤數據集，都有一部分樣本是不足十秒的。對於這部分樣本，我們採用補零處理。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">samplerate <span class="token operator">=</span> <span class="token number">44100</span>
duration <span class="token operator">=</span> <span class="token number">10</span>

waveform<span class="token punctuation">,</span> samplerate <span class="token operator">=</span> soundfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
diff <span class="token operator">=</span> samplerate <span class="token operator">*</span> duration <span class="token operator">-</span> waveform<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
waveform <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">(</span>waveform<span class="token punctuation">,</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>diff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    soundfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>f<span class="token punctuation">,</span> waveform<span class="token punctuation">,</span> samplerate<span class="token punctuation">)</span></code></pre></div>
<h2 id="音頻格式、通道數、採樣率以及採樣位數" style="position:relative;"><a href="#%E9%9F%B3%E9%A0%BB%E6%A0%BC%E5%BC%8F%E3%80%81%E9%80%9A%E9%81%93%E6%95%B8%E3%80%81%E6%8E%A1%E6%A8%A3%E7%8E%87%E4%BB%A5%E5%8F%8A%E6%8E%A1%E6%A8%A3%E4%BD%8D%E6%95%B8" aria-label="音頻格式、通道數、採樣率以及採樣位數 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>音頻格式、通道數、採樣率以及採樣位數</h2>
<p>因爲我採用的方法是將視頻轉換爲音頻，所以目標格式就是常用的wav，避免進一步的編碼損失。但是源數據可能是雙通道，導致轉換後的數據集混雜了兩種通道數的數據。對於聲事件檢測任務，我認爲雙通道意義並不很明確。所以在轉換時都使其變爲單通道。對於採樣率，我這裏統一設置了比較高的44.1kHz，基本可以覆蓋全部的YouTube視頻中的音頻頻段。</p>
<p>我們可以利用FFmpeg進行轉換。在Python當中，執行Shell中的命令可以利用os.system()或者os.popen()。下面代碼示例的寫法，方便進行不同參數的調試、增刪與順序調整。不過需要注意參數之前的空格。</p>
<p>F-strings的寫法可以方便的傳入參數的值，我比較推薦。這個方法是由PEP 498引入的，需要Python≥3.6。</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">ffmpeg_command <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"ffmpeg -i </span><span class="token interpolation"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token string"> -hide_banner"</span></span>
ffmpeg_command <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" -acodec </span><span class="token interpolation"><span class="token punctuation">{</span>codec<span class="token punctuation">}</span></span><span class="token string">"</span></span>
ffmpeg_command <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" -ac </span><span class="token interpolation"><span class="token punctuation">{</span>num_channels<span class="token punctuation">}</span></span><span class="token string">"</span></span>
ffmpeg_command <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" -ar </span><span class="token interpolation"><span class="token punctuation">{</span>sampelrate<span class="token punctuation">}</span></span><span class="token string">"</span></span>
ffmpeg_command <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f" </span><span class="token interpolation"><span class="token punctuation">{</span>output_file<span class="token punctuation">}</span></span><span class="token string">"</span></span>
<span class="token keyword">if</span> silent<span class="token punctuation">:</span>
    ffmpeg_command <span class="token operator">+=</span> <span class="token string">" 2> /dev/null"</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>ffmpeg_command<span class="token punctuation">)</span></code></pre></div>
<p>這裏的<code class="language-text">filename</code>、<code class="language-text">codec</code>、<code class="language-text">num_channels</code>、<code class="language-text">samplerate</code>、<code class="language-text">output_file</code>的值在完整代碼中都有提前定義，如果<code class="language-text">silent</code>的值爲True的話，會把所有準備發送到<code class="language-text">/dev/stdout</code>和<code class="language-text">/dev/stderr</code>的數據通通丟給<code class="language-text">/dev/null</code>來實現無輸出。</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Aug 13, 2021</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/dataset/">Dataset</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/parse/">Parse</a></li></ul></div><div class="Author-module--author--2Yefr"><p>† 少女祈禱中 †<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/" rel="noopener noreferrer" target="_blank"><strong>km4sh</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/550ee3f0-7653-4036-9568-b221dcc2e733";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-8de6de3a6555a9e76093.js"],"app":["/app-e815b53f2e11d3d25400.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-6a4ccb9f4a6261541e29.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-fdd8536acd3c57081720.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-658f4507169e2836a377.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-d8aeb4e67f2e8af3e6cd.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-32a004a3619ef9011e8d.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-6f77d5f667fd901ff51f.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-8de6de3a6555a9e76093.js" nomodule=""></script><script src="/component---src-templates-post-template-js-32a004a3619ef9011e8d.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-69626fa07c736046dbe7.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-e815b53f2e11d3d25400.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-5954f1f1c3eead9a6f74.js" async=""></script><script src="/532a2f07-549094fa347c85980056.js" async=""></script><script src="/framework-1e331b2e9d55ebef6dec.js" async=""></script><script src="/webpack-runtime-9e14da4f4b41e7a8f978.js" async=""></script></body></html>